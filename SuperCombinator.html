<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Combinator v12 Pro</title>
    <!-- Favicon - Lightning bolt icon matching the app branding -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%238b5cf6'/%3E%3Cstop offset='100%25' style='stop-color:%236366f1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='32' height='32' rx='6' fill='url(%23g)'/%3E%3Cpath d='M17.5 6L10 17h5.5l-1 9L22 15h-5.5l1-9z' fill='white'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Netlify Identity Widget for Authentication -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: ['class', '[data-mode="dark"]'],
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    colors: {
                        brand: {
                            50: '#ecfeff',
                            100: '#cffafe',
                            400: '#22d3ee',
                            500: '#06b6d4', // Cyan/Teal primary
                            600: '#0891b2',
                            700: '#0e7490',
                        },
                        accent: {
                            400: '#a3e635', // Lime/Chartreuse
                            500: '#84cc16',
                            600: '#65a30d',
                        },
                        gold: {
                            400: '#fed16a', // Golden Tainoi
                            500: '#fbbf24',
                        },
                        teal: {
                            500: '#075b5e', // Deep Sea Green
                            600: '#0d9488',
                        },
                        dark: {
                            bg: '#0c0c0c', // Cod Gray inspired
                            surface: '#141414',
                            border: '#252525'
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #a78bfa;
            border-radius: 3px;
        }

        [data-mode="dark"] ::-webkit-scrollbar-thumb {
            background: rgba(99, 110, 138, 0.5);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LIGHT MODE - VIBRANT PURPLE THEME
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Soft lavender background */
        body {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 50%, #f0f9ff 100%) !important;
        }

        /* Sidebar - soft white with purple tint */
        #sidebar {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(245, 243, 255, 0.9) 100%) !important;
            border-color: rgba(167, 139, 250, 0.2) !important;
        }

        /* Header - clean with subtle shadow */
        header {
            background: rgba(255, 255, 255, 0.9) !important;
            border-color: rgba(167, 139, 250, 0.15) !important;
            box-shadow: 0 2px 12px -2px rgba(139, 92, 246, 0.08);
        }

        /* Glassmorphism - Light Mode Enhanced */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(167, 139, 250, 0.15);
            box-shadow: 0 4px 24px -4px rgba(139, 92, 246, 0.1);
        }

        .glass-panel:hover {
            border-color: rgba(139, 92, 246, 0.3);
            box-shadow: 0 8px 32px -4px rgba(139, 92, 246, 0.15);
        }

        /* Nav items - purple active state */
        .nav-item.active {
            background: linear-gradient(90deg, rgba(139, 92, 246, 0.12) 0%, rgba(139, 92, 246, 0.05) 100%) !important;
            border-left: 3px solid #8b5cf6 !important;
        }

        .nav-item:hover {
            background: rgba(139, 92, 246, 0.08) !important;
        }

        /* Buttons - vibrant purple gradient */
        #genBtn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(139, 92, 246, 0.4);
        }

        #genBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px -4px rgba(139, 92, 246, 0.5);
        }

        #hdrNewPack {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;
            color: white !important;
            box-shadow: 0 4px 12px -2px rgba(139, 92, 246, 0.3);
        }

        /* Chips - purple when active */
        .chip.on {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa) !important;
            color: white !important;
            box-shadow: 0 4px 12px -2px rgba(139, 92, 246, 0.4);
        }

        /* Result cards - subtle hover glow */
        #resContainer>div>div {
            transition: all 0.2s ease;
        }

        #resContainer>div>div:hover {
            border-color: rgba(139, 92, 246, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(139, 92, 246, 0.2);
            transform: translateY(-2px);
        }

        /* Pack cards hover */
        #packsGrid>div:hover {
            border-color: rgba(139, 92, 246, 0.4) !important;
            box-shadow: 0 12px 32px -8px rgba(139, 92, 246, 0.2);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COLORFUL PACK CARDS THEME
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Orange Theme - Vibrant Orange (#FF5B04) */
        .pack-card-orange {
            background: linear-gradient(135deg, #FF5B04 0%, #ff7e3a 50%, #FF5B04 100%) !important;
            border: none !important;
            color: white !important;
        }

        .pack-card-orange h3,
        .pack-card-orange p,
        .pack-card-orange span,
        .pack-card-orange button {
            color: white !important;
        }

        .pack-card-orange .icon-bg {
            background: rgba(255, 255, 255, 0.25) !important;
            color: white !important;
        }

        .pack-card-orange:hover {
            box-shadow: 0 16px 48px -8px rgba(255, 91, 4, 0.5) !important;
            transform: translateY(-6px) !important;
        }

        .pack-card-orange .border-t {
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        /* Teal Theme - Deep Sea Green (#075B5E) */
        .pack-card-teal {
            background: linear-gradient(135deg, #075B5E 0%, #0a7a7e 50%, #075B5E 100%) !important;
            border: none !important;
            color: white !important;
        }

        .pack-card-teal h3,
        .pack-card-teal p,
        .pack-card-teal span,
        .pack-card-teal button {
            color: white !important;
        }

        .pack-card-teal .icon-bg {
            background: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }

        .pack-card-teal:hover {
            box-shadow: 0 16px 48px -8px rgba(7, 91, 94, 0.5) !important;
            transform: translateY(-6px) !important;
        }

        .pack-card-teal .border-t {
            border-color: rgba(255, 255, 255, 0.15) !important;
        }

        /* Gold Theme - Golden Tainoi (#FED16A) */
        .pack-card-gold {
            background: linear-gradient(135deg, #FED16A 0%, #ffe59a 50%, #FED16A 100%) !important;
            border: none !important;
            color: #1a1a2e !important;
        }

        .pack-card-gold h3,
        .pack-card-gold p,
        .pack-card-gold span,
        .pack-card-gold button {
            color: #1a1a2e !important;
        }

        .pack-card-gold .icon-bg {
            background: rgba(0, 0, 0, 0.1) !important;
            color: #1a1a2e !important;
        }

        .pack-card-gold:hover {
            box-shadow: 0 16px 48px -8px rgba(254, 209, 106, 0.6) !important;
            transform: translateY(-6px) !important;
        }

        .pack-card-gold .border-t {
            border-color: rgba(0, 0, 0, 0.1) !important;
        }

        /* Coral/Pink Theme - Soft Coral */
        .pack-card-coral {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 50%, #ff6b6b 100%) !important;
            border: none !important;
            color: white !important;
        }

        .pack-card-coral h3,
        .pack-card-coral p,
        .pack-card-coral span,
        .pack-card-coral button {
            color: white !important;
        }

        .pack-card-coral .icon-bg {
            background: rgba(255, 255, 255, 0.25) !important;
            color: white !important;
        }

        .pack-card-coral:hover {
            box-shadow: 0 16px 48px -8px rgba(255, 107, 107, 0.5) !important;
            transform: translateY(-6px) !important;
        }

        .pack-card-coral .border-t {
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        /* Purple Theme - Lavender */
        .pack-card-purple {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 50%, #8b5cf6 100%) !important;
            border: none !important;
            color: white !important;
        }

        .pack-card-purple h3,
        .pack-card-purple p,
        .pack-card-purple span,
        .pack-card-purple button {
            color: white !important;
        }

        .pack-card-purple .icon-bg {
            background: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }

        .pack-card-purple:hover {
            box-shadow: 0 16px 48px -8px rgba(139, 92, 246, 0.5) !important;
            transform: translateY(-6px) !important;
        }

        .pack-card-purple .border-t {
            border-color: rgba(255, 255, 255, 0.15) !important;
        }

        /* Mint/Green Theme - Fresh Lime */
        .pack-card-lime {
            background: linear-gradient(135deg, #22c55e 0%, #4ade80 50%, #22c55e 100%) !important;
            border: none !important;
            color: white !important;
        }

        .pack-card-lime h3,
        .pack-card-lime p,
        .pack-card-lime span,
        .pack-card-lime button {
            color: white !important;
        }

        .pack-card-lime .icon-bg {
            background: rgba(255, 255, 255, 0.25) !important;
            color: white !important;
        }

        .pack-card-lime:hover {
            box-shadow: 0 16px 48px -8px rgba(34, 197, 94, 0.5) !important;
            transform: translateY(-6px) !important;
        }

        .pack-card-lime .border-t {
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        /* Blue Theme - Ocean Blue */
        .pack-card-blue {
            background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 50%, #3b82f6 100%) !important;
            border: none !important;
            color: white !important;
        }

        .pack-card-blue h3,
        .pack-card-blue p,
        .pack-card-blue span,
        .pack-card-blue button {
            color: white !important;
        }

        .pack-card-blue .icon-bg {
            background: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }

        .pack-card-blue:hover {
            box-shadow: 0 16px 48px -8px rgba(59, 130, 246, 0.5) !important;
            transform: translateY(-6px) !important;
        }

        .pack-card-blue .border-t {
            border-color: rgba(255, 255, 255, 0.15) !important;
        }

        /* Rose/Pink Theme */
        .pack-card-rose {
            background: linear-gradient(135deg, #ec4899 0%, #f472b6 50%, #ec4899 100%) !important;
            border: none !important;
            color: white !important;
        }

        .pack-card-rose h3,
        .pack-card-rose p,
        .pack-card-rose span,
        .pack-card-rose button {
            color: white !important;
        }

        .pack-card-rose .icon-bg {
            background: rgba(255, 255, 255, 0.25) !important;
            color: white !important;
        }

        .pack-card-rose:hover {
            box-shadow: 0 16px 48px -8px rgba(236, 72, 153, 0.5) !important;
            transform: translateY(-6px) !important;
        }

        .pack-card-rose .border-t {
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        /* Pack card base transitions */
        #packsGrid>div {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }

        /* Inputs - purple focus ring */
        input:focus,
        textarea:focus,
        select:focus {
            border-color: rgba(139, 92, 246, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15) !important;
        }

        /* Step number badges - colorful */
        .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa) !important;
            color: white !important;
        }

        /* Stats badge */
        #resCount,
        #kwCount {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa) !important;
            color: white !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PREMIUM DARK MODE OVERRIDES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Deep dark background - Cod Gray inspired */
        [data-mode="dark"] body {
            background: linear-gradient(135deg, #0c0c0c 0%, #111111 50%, #0c0c0c 100%) !important;
        }

        /* Glassmorphism - Dark Mode Premium */
        [data-mode="dark"] .glass-panel {
            background: rgba(14, 14, 14, 0.7) !important;
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.04) !important;
            box-shadow: 0 8px 32px -8px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.02);
        }

        /* Dark mode sidebar */
        [data-mode="dark"] #sidebar {
            background: rgba(10, 10, 10, 0.95) !important;
            border-color: rgba(255, 255, 255, 0.03) !important;
        }

        /* Dark mode header */
        [data-mode="dark"] header {
            background: rgba(10, 10, 10, 0.9) !important;
            border-color: rgba(255, 255, 255, 0.03) !important;
        }

        /* Dark mode main content area */
        [data-mode="dark"] main {
            background: transparent !important;
        }

        /* Dark mode inputs */
        [data-mode="dark"] input,
        [data-mode="dark"] textarea,
        [data-mode="dark"] select {
            background: rgba(18, 18, 18, 0.8) !important;
            border-color: rgba(255, 255, 255, 0.06) !important;
            color: #e2e8f0 !important;
        }

        [data-mode="dark"] input::placeholder,
        [data-mode="dark"] textarea::placeholder {
            color: rgba(148, 163, 184, 0.5) !important;
        }

        [data-mode="dark"] input:focus,
        [data-mode="dark"] textarea:focus {
            border-color: rgba(163, 230, 53, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(163, 230, 53, 0.1) !important;
        }

        /* Dark mode buttons */
        [data-mode="dark"] button {
            transition: all 0.2s ease;
        }

        [data-mode="dark"] .bg-slate-100,
        [data-mode="dark"] .dark\\:bg-slate-800 {
            background: rgba(20, 20, 20, 0.6) !important;
        }

        [data-mode="dark"] .dark\\:bg-slate-700 {
            background: rgba(30, 30, 30, 0.5) !important;
        }

        /* Dark mode nav items */
        [data-mode="dark"] .nav-item:hover {
            background: rgba(163, 230, 53, 0.08) !important;
        }

        [data-mode="dark"] .nav-item.active {
            background: rgba(163, 230, 53, 0.12) !important;
            border-left: 3px solid #a3e635;
        }

        /* Dark borders - more subtle */
        [data-mode="dark"] .border-slate-200,
        [data-mode="dark"] .dark\\:border-slate-700,
        [data-mode="dark"] .dark\\:border-dark-border {
            border-color: rgba(255, 255, 255, 0.06) !important;
        }

        /* Results cards in dark mode */
        [data-mode="dark"] #resContainer>div>div {
            background: rgba(18, 18, 18, 0.7) !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        [data-mode="dark"] #resContainer>div>div:hover {
            background: rgba(25, 25, 25, 0.8) !important;
            border-color: rgba(163, 230, 53, 0.4) !important;
            box-shadow: 0 4px 20px -4px rgba(163, 230, 53, 0.2);
        }

        /* Pack cards in dark mode */
        [data-mode="dark"] #packsGrid>div {
            background: rgba(18, 18, 18, 0.7) !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        [data-mode="dark"] #packsGrid>div:hover {
            background: rgba(25, 25, 25, 0.8) !important;
            border-color: rgba(163, 230, 53, 0.3) !important;
            transform: translateY(-4px);
            box-shadow: 0 12px 40px -12px rgba(0, 0, 0, 0.6);
        }

        /* Tables in dark mode */
        [data-mode="dark"] thead {
            background: rgba(15, 23, 42, 0.6) !important;
        }

        [data-mode="dark"] tbody tr:hover {
            background: rgba(56, 189, 248, 0.05) !important;
        }

        /* Search Dropdown */
        .search-dropdown-glass {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(16px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
        }

        [data-mode="dark"] .search-dropdown-glass {
            background: rgba(20, 29, 47, 0.95) !important;
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px -15px rgba(0, 0, 0, 0.6);
        }

        /* Modals in dark mode */
        [data-mode="dark"] #editModal>div,
        [data-mode="dark"] #bulkModal>div,
        [data-mode="dark"] #multModal>div,
        [data-mode="dark"] #catModal>div,
        [data-mode="dark"] #modal-clear>div {
            background: rgba(15, 23, 42, 0.95) !important;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 32px 64px -16px rgba(0, 0, 0, 0.5);
        }

        /* Toast in dark mode */
        [data-mode="dark"] .toast {
            background: #a3e635 !important;
            color: #0c0c0c !important;
            box-shadow: 0 16px 48px -12px rgba(163, 230, 53, 0.3);
        }

        /* Generate button - Lime glow effect */
        #genBtn {
            background: linear-gradient(135deg, #06b6d4, #0891b2) !important;
        }

        [data-mode="dark"] #genBtn {
            background: linear-gradient(135deg, #a3e635, #84cc16) !important;
            color: #0c0c0c !important;
            box-shadow: 0 8px 32px -8px rgba(163, 230, 53, 0.5);
        }

        [data-mode="dark"] #genBtn:hover {
            box-shadow: 0 12px 40px -8px rgba(163, 230, 53, 0.7);
            transform: translateY(-2px);
        }

        /* New Pack button - Lime accent */
        [data-mode="dark"] #hdrNewPack {
            background: #a3e635 !important;
            color: #0c0c0c !important;
        }

        [data-mode="dark"] #hdrNewPack:hover {
            background: #84cc16 !important;
        }

        /* Chip tags */
        .chip.on {
            background: linear-gradient(135deg, #06b6d4, #0891b2) !important;
        }

        [data-mode="dark"] .chip.on {
            background: linear-gradient(135deg, #a3e635, #65a30d) !important;
            color: #0c0c0c !important;
            box-shadow: 0 4px 16px -4px rgba(163, 230, 53, 0.4);
        }

        /* Drop zone */
        [data-mode="dark"] #csvDropZone {
            border-color: rgba(163, 230, 53, 0.2) !important;
            background: rgba(20, 20, 20, 0.5);
        }

        [data-mode="dark"] #csvDropZone:hover {
            border-color: rgba(56, 189, 248, 0.4) !important;
            background: rgba(56, 189, 248, 0.05);
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid currentColor;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        [data-mode="dark"] .spinner {
            border-color: rgba(255, 255, 255, 0.15);
            border-top-color: white;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Toast Animation */
        .toast {
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Modal Transitions */
        #editModal,
        #bulkModal,
        #multModal,
        #catModal,
        #modal-clear,
        #winnerModal {
            transition: opacity 0.2s ease-out;
        }

        #editModal>div,
        #bulkModal>div,
        #multModal>div,
        #catModal>div,
        #modal-clear>div,
        #winnerModal>div {
            transition: transform 0.2s ease-out, opacity 0.2s ease-out;
        }

        .opacity-0>div {
            transform: scale(0.95);
        }

        /* Hide elements by default */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeUp 0.3s ease-out;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COLOR THEME VARIATIONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Theme option active state */
        .theme-option.active {
            border-color: currentColor !important;
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.15);
            transform: scale(1.02);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PURPLE THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        [data-theme="purple"] #genBtn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(139, 92, 246, 0.4);
        }

        [data-theme="purple"] #hdrNewPack {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;
            box-shadow: 0 4px 12px -2px rgba(139, 92, 246, 0.3);
        }

        [data-theme="purple"] .chip.on {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa) !important;
            color: white !important;
        }

        [data-theme="purple"] .nav-item.active {
            background: linear-gradient(90deg, rgba(139, 92, 246, 0.12) 0%, rgba(139, 92, 246, 0.05) 100%) !important;
            border-left: 3px solid #8b5cf6 !important;
        }

        [data-theme="purple"] .nav-item:hover {
            background: rgba(139, 92, 246, 0.08) !important;
        }

        [data-theme="purple"] input:focus,
        [data-theme="purple"] textarea:focus,
        [data-theme="purple"] select:focus {
            border-color: rgba(139, 92, 246, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15) !important;
        }

        [data-theme="purple"] .theme-option.active {
            border-color: #8b5cf6 !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TEAL THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        [data-theme="teal"] #genBtn {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 50%, #0f766e 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(20, 184, 166, 0.4);
        }

        [data-theme="teal"] #hdrNewPack {
            background: linear-gradient(135deg, #14b8a6, #0d9488) !important;
            box-shadow: 0 4px 12px -2px rgba(20, 184, 166, 0.3);
        }

        [data-theme="teal"] .chip.on {
            background: linear-gradient(135deg, #14b8a6, #2dd4bf) !important;
            color: white !important;
        }

        [data-theme="teal"] .nav-item.active {
            background: linear-gradient(90deg, rgba(20, 184, 166, 0.12) 0%, rgba(20, 184, 166, 0.05) 100%) !important;
            border-left: 3px solid #14b8a6 !important;
        }

        [data-theme="teal"] .nav-item:hover {
            background: rgba(20, 184, 166, 0.08) !important;
        }

        [data-theme="teal"] input:focus,
        [data-theme="teal"] textarea:focus,
        [data-theme="teal"] select:focus {
            border-color: rgba(20, 184, 166, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.15) !important;
        }

        [data-theme="teal"] .theme-option.active {
            border-color: #14b8a6 !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ORANGE THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        [data-theme="orange"] #genBtn {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 50%, #c2410c 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(249, 115, 22, 0.4);
        }

        [data-theme="orange"] #hdrNewPack {
            background: linear-gradient(135deg, #f97316, #ea580c) !important;
            box-shadow: 0 4px 12px -2px rgba(249, 115, 22, 0.3);
        }

        [data-theme="orange"] .chip.on {
            background: linear-gradient(135deg, #f97316, #fb923c) !important;
            color: white !important;
        }

        [data-theme="orange"] .nav-item.active {
            background: linear-gradient(90deg, rgba(249, 115, 22, 0.12) 0%, rgba(249, 115, 22, 0.05) 100%) !important;
            border-left: 3px solid #f97316 !important;
        }

        [data-theme="orange"] .nav-item:hover {
            background: rgba(249, 115, 22, 0.08) !important;
        }

        [data-theme="orange"] input:focus,
        [data-theme="orange"] textarea:focus,
        [data-theme="orange"] select:focus {
            border-color: rgba(249, 115, 22, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.15) !important;
        }

        [data-theme="orange"] .theme-option.active {
            border-color: #f97316 !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ROSE THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        [data-theme="rose"] #genBtn {
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 50%, #be123c 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(244, 63, 94, 0.4);
        }

        [data-theme="rose"] #hdrNewPack {
            background: linear-gradient(135deg, #f43f5e, #e11d48) !important;
            box-shadow: 0 4px 12px -2px rgba(244, 63, 94, 0.3);
        }

        [data-theme="rose"] .chip.on {
            background: linear-gradient(135deg, #f43f5e, #fb7185) !important;
            color: white !important;
        }

        [data-theme="rose"] .nav-item.active {
            background: linear-gradient(90deg, rgba(244, 63, 94, 0.12) 0%, rgba(244, 63, 94, 0.05) 100%) !important;
            border-left: 3px solid #f43f5e !important;
        }

        [data-theme="rose"] .nav-item:hover {
            background: rgba(244, 63, 94, 0.08) !important;
        }

        [data-theme="rose"] input:focus,
        [data-theme="rose"] textarea:focus,
        [data-theme="rose"] select:focus {
            border-color: rgba(244, 63, 94, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(244, 63, 94, 0.15) !important;
        }

        [data-theme="rose"] .theme-option.active {
            border-color: #f43f5e !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GOLD THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        [data-theme="gold"] #genBtn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(245, 158, 11, 0.4);
        }

        [data-theme="gold"] #hdrNewPack {
            background: linear-gradient(135deg, #f59e0b, #d97706) !important;
            box-shadow: 0 4px 12px -2px rgba(245, 158, 11, 0.3);
        }

        [data-theme="gold"] .chip.on {
            background: linear-gradient(135deg, #f59e0b, #fbbf24) !important;
            color: #1a1a2e !important;
        }

        [data-theme="gold"] .nav-item.active {
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.12) 0%, rgba(245, 158, 11, 0.05) 100%) !important;
            border-left: 3px solid #f59e0b !important;
        }

        [data-theme="gold"] .nav-item:hover {
            background: rgba(245, 158, 11, 0.08) !important;
        }

        [data-theme="gold"] input:focus,
        [data-theme="gold"] textarea:focus,
        [data-theme="gold"] select:focus {
            border-color: rgba(245, 158, 11, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.15) !important;
        }

        [data-theme="gold"] .theme-option.active {
            border-color: #f59e0b !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LIME THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        [data-theme="lime"] #genBtn {
            background: linear-gradient(135deg, #84cc16 0%, #65a30d 50%, #4d7c0f 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(132, 204, 22, 0.4);
        }

        [data-theme="lime"] #hdrNewPack {
            background: linear-gradient(135deg, #84cc16, #65a30d) !important;
            box-shadow: 0 4px 12px -2px rgba(132, 204, 22, 0.3);
        }

        [data-theme="lime"] .chip.on {
            background: linear-gradient(135deg, #84cc16, #a3e635) !important;
            color: #1a1a2e !important;
        }

        [data-theme="lime"] .nav-item.active {
            background: linear-gradient(90deg, rgba(132, 204, 22, 0.12) 0%, rgba(132, 204, 22, 0.05) 100%) !important;
            border-left: 3px solid #84cc16 !important;
        }

        [data-theme="lime"] .nav-item:hover {
            background: rgba(132, 204, 22, 0.08) !important;
        }

        [data-theme="lime"] input:focus,
        [data-theme="lime"] textarea:focus,
        [data-theme="lime"] select:focus {
            border-color: rgba(132, 204, 22, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(132, 204, 22, 0.15) !important;
        }

        [data-theme="lime"] .theme-option.active {
            border-color: #84cc16 !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BLUE THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        [data-theme="blue"] #genBtn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(59, 130, 246, 0.4);
        }

        [data-theme="blue"] #hdrNewPack {
            background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
            box-shadow: 0 4px 12px -2px rgba(59, 130, 246, 0.3);
        }

        [data-theme="blue"] .chip.on {
            background: linear-gradient(135deg, #3b82f6, #60a5fa) !important;
            color: white !important;
        }

        [data-theme="blue"] .nav-item.active {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.12) 0%, rgba(59, 130, 246, 0.05) 100%) !important;
            border-left: 3px solid #3b82f6 !important;
        }

        [data-theme="blue"] .nav-item:hover {
            background: rgba(59, 130, 246, 0.08) !important;
        }

        [data-theme="blue"] input:focus,
        [data-theme="blue"] textarea:focus,
        [data-theme="blue"] select:focus {
            border-color: rgba(59, 130, 246, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15) !important;
        }

        [data-theme="blue"] .theme-option.active {
            border-color: #3b82f6 !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CORAL THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        [data-theme="coral"] #genBtn {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 50%, #dc2626 100%) !important;
            box-shadow: 0 8px 24px -4px rgba(248, 113, 113, 0.4);
        }

        [data-theme="coral"] #hdrNewPack {
            background: linear-gradient(135deg, #f87171, #ef4444) !important;
            box-shadow: 0 4px 12px -2px rgba(248, 113, 113, 0.3);
        }

        [data-theme="coral"] .chip.on {
            background: linear-gradient(135deg, #f87171, #fca5a5) !important;
            color: white !important;
        }

        [data-theme="coral"] .nav-item.active {
            background: linear-gradient(90deg, rgba(248, 113, 113, 0.12) 0%, rgba(248, 113, 113, 0.05) 100%) !important;
            border-left: 3px solid #f87171 !important;
        }

        [data-theme="coral"] .nav-item:hover {
            background: rgba(248, 113, 113, 0.08) !important;
        }

        [data-theme="coral"] input:focus,
        [data-theme="coral"] textarea:focus,
        [data-theme="coral"] select:focus {
            border-color: rgba(248, 113, 113, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.15) !important;
        }

        [data-theme="coral"] .theme-option.active {
            border-color: #f87171 !important;
        }

        /* Result card hover effects for each theme */
        [data-theme="purple"] #resContainer>div>div:hover {
            border-color: rgba(139, 92, 246, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(139, 92, 246, 0.2);
        }

        [data-theme="teal"] #resContainer>div>div:hover {
            border-color: rgba(20, 184, 166, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(20, 184, 166, 0.2);
        }

        [data-theme="orange"] #resContainer>div>div:hover {
            border-color: rgba(249, 115, 22, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(249, 115, 22, 0.2);
        }

        [data-theme="rose"] #resContainer>div>div:hover {
            border-color: rgba(244, 63, 94, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(244, 63, 94, 0.2);
        }

        [data-theme="gold"] #resContainer>div>div:hover {
            border-color: rgba(245, 158, 11, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(245, 158, 11, 0.2);
        }

        [data-theme="lime"] #resContainer>div>div:hover {
            border-color: rgba(132, 204, 22, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(132, 204, 22, 0.2);
        }

        [data-theme="blue"] #resContainer>div>div:hover {
            border-color: rgba(59, 130, 246, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(59, 130, 246, 0.2);
        }

        [data-theme="coral"] #resContainer>div>div:hover {
            border-color: rgba(248, 113, 113, 0.4) !important;
            box-shadow: 0 8px 24px -8px rgba(248, 113, 113, 0.2);
        }

        /* Pack card hover effects for each theme */
        [data-theme="purple"] #packsGrid>div:not([class*="pack-card-"]):hover {
            border-color: rgba(139, 92, 246, 0.4) !important;
        }

        [data-theme="teal"] #packsGrid>div:not([class*="pack-card-"]):hover {
            border-color: rgba(20, 184, 166, 0.4) !important;
        }

        [data-theme="orange"] #packsGrid>div:not([class*="pack-card-"]):hover {
            border-color: rgba(249, 115, 22, 0.4) !important;
        }

        [data-theme="rose"] #packsGrid>div:not([class*="pack-card-"]):hover {
            border-color: rgba(244, 63, 94, 0.4) !important;
        }

        [data-theme="gold"] #packsGrid>div:not([class*="pack-card-"]):hover {
            border-color: rgba(245, 158, 11, 0.4) !important;
        }

        [data-theme="lime"] #packsGrid>div:not([class*="pack-card-"]):hover {
            border-color: rgba(132, 204, 22, 0.4) !important;
        }

        [data-theme="blue"] #packsGrid>div:not([class*="pack-card-"]):hover {
            border-color: rgba(59, 130, 246, 0.4) !important;
        }

        [data-theme="coral"] #packsGrid>div:not([class*="pack-card-"]):hover {
            border-color: rgba(248, 113, 113, 0.4) !important;
        }

        /* Stats badges for each theme */
        [data-theme="purple"] #resCount,
        [data-theme="purple"] #kwCount {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa) !important;
        }

        [data-theme="teal"] #resCount,
        [data-theme="teal"] #kwCount {
            background: linear-gradient(135deg, #14b8a6, #2dd4bf) !important;
        }

        [data-theme="orange"] #resCount,
        [data-theme="orange"] #kwCount {
            background: linear-gradient(135deg, #f97316, #fb923c) !important;
        }

        [data-theme="rose"] #resCount,
        [data-theme="rose"] #kwCount {
            background: linear-gradient(135deg, #f43f5e, #fb7185) !important;
        }

        [data-theme="gold"] #resCount,
        [data-theme="gold"] #kwCount {
            background: linear-gradient(135deg, #f59e0b, #fbbf24) !important;
            color: #1a1a2e !important;
        }

        [data-theme="lime"] #resCount,
        [data-theme="lime"] #kwCount {
            background: linear-gradient(135deg, #84cc16, #a3e635) !important;
            color: #1a1a2e !important;
        }

        [data-theme="blue"] #resCount,
        [data-theme="blue"] #kwCount {
            background: linear-gradient(135deg, #3b82f6, #60a5fa) !important;
        }

        [data-theme="coral"] #resCount,
        [data-theme="coral"] #kwCount {
            background: linear-gradient(135deg, #f87171, #fca5a5) !important;
        }

        /* Step number badges for each theme */
        [data-theme="purple"] .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa) !important;
        }

        [data-theme="teal"] .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #14b8a6, #2dd4bf) !important;
        }

        [data-theme="orange"] .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #f97316, #fb923c) !important;
        }

        [data-theme="rose"] .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #f43f5e, #fb7185) !important;
        }

        [data-theme="gold"] .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #f59e0b, #fbbf24) !important;
        }

        [data-theme="lime"] .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #84cc16, #a3e635) !important;
        }

        [data-theme="blue"] .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #3b82f6, #60a5fa) !important;
        }

        [data-theme="coral"] .glass-panel h3 span:first-child {
            background: linear-gradient(135deg, #f87171, #fca5a5) !important;
        }
    </style>
</head>

<body
    class="bg-slate-50 text-slate-900 dark:bg-dark-bg dark:text-slate-100 transition-colors duration-300 font-sans h-screen flex overflow-hidden"
    data-theme="default" data-mode="light">

    <!-- BACKGROUND EFFECTS -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none opacity-50 dark:opacity-20"
        id="bgEffects">
        <!-- Light mode: Purple/violet gradient orbs -->
        <div
            class="dark:hidden absolute top-[-10%] left-[-10%] w-[45%] h-[45%] rounded-full bg-gradient-to-br from-violet-400/40 to-purple-500/30 blur-[100px] animate-pulse">
        </div>
        <div class="dark:hidden absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full bg-gradient-to-tr from-indigo-400/30 to-blue-400/20 blur-[100px] animate-pulse"
            style="animation-delay: 2s;"></div>
        <div class="dark:hidden absolute top-[40%] right-[10%] w-[30%] h-[30%] rounded-full bg-fuchsia-400/15 blur-[80px] animate-pulse"
            style="animation-delay: 3s;"></div>
        <!-- Dark mode: Subtle lime and teal glows -->
        <div
            class="hidden dark:block absolute top-[10%] left-[5%] w-[35%] h-[35%] rounded-full bg-gradient-to-br from-lime-500/15 to-green-600/10 blur-[100px] animate-pulse">
        </div>
        <div class="hidden dark:block absolute bottom-[5%] right-[5%] w-[40%] h-[40%] rounded-full bg-gradient-to-tr from-teal-600/15 to-cyan-500/10 blur-[100px] animate-pulse"
            style="animation-delay: 1.5s;"></div>
        <div class="hidden dark:block absolute top-[50%] right-[30%] w-[25%] h-[25%] rounded-full bg-lime-400/5 blur-[80px] animate-pulse"
            style="animation-delay: 3s;"></div>
    </div>

    <!-- SIDEBAR -->
    <aside
        class="w-64 bg-white/80 dark:bg-dark-surface/80 backdrop-blur-xl border-r border-slate-200 dark:border-dark-border flex flex-col z-50 transition-transform duration-300 absolute md:relative h-full -translate-x-full md:translate-x-0"
        id="sidebar">
        <div class="p-6 border-b border-slate-100 dark:border-dark-border">
            <div class="flex items-center gap-3 font-extrabold text-xl tracking-tight text-slate-900 dark:text-white">
                <div
                    class="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-500 to-indigo-600 flex items-center justify-center text-white shadow-lg shadow-brand-500/30">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>
                SC v12
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto p-4 space-y-1">
            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-3 mt-2">Main</div>
            <a href="#"
                class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 active"
                data-pg="generator">
                <span>âœ¨</span> Generator
            </a>
            <a href="#"
                class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400"
                data-pg="automation">
                <span>ğŸ¤–</span> Automation
                <span
                    class="ml-auto bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded">AI</span>
            </a>
            <a href="#"
                class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400"
                data-pg="packs">
                <span>ğŸ“¦</span> Packs
                <span
                    class="ml-auto bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-bold px-2 py-0.5 rounded-full"
                    id="packCountBadge">0</span>
            </a>
            <a href="#"
                class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400"
                data-pg="winners">
                <span>ğŸ†</span> Winners
            </a>
            <a href="#"
                class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400"
                data-pg="favorites">
                <span>â­</span> Favorites
            </a>

            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-3 mt-6">Tools</div>
            <a href="tools/comp-analyzer.html" target="_blank"
                class="flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400">
                <span>ğŸ¯</span> Comp Analyzer
                <svg class="w-3 h-3 ml-auto opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
            </a>

            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-3 mt-6">System</div>
            <a href="#"
                class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400"
                data-pg="library">
                <span>ğŸ“š</span> Library
            </a>
            <a href="#"
                class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400"
                data-pg="settings">
                <span>âš™ï¸</span> Settings
            </a>
        </nav>

        <div class="p-4 border-t border-slate-100 dark:border-dark-border">
            <button id="darkToggle"
                class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                <span id="darkIco">ğŸŒ™</span> <span id="themeText">Dark Mode</span>
            </button>
        </div>
    </aside>

    <!-- MOBILE TOGGLE -->
    <button id="mobMenu"
        class="md:hidden fixed bottom-6 right-6 w-14 h-14 bg-brand-600 text-white rounded-full shadow-xl flex items-center justify-center z-50 text-2xl hover:scale-105 transition-transform">â˜°</button>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col min-w-0 bg-white/50 dark:bg-dark-bg/50">

        <!-- HEADER -->
        <header
            class="h-16 border-b border-slate-200 dark:border-dark-border bg-white/80 dark:bg-dark-surface/80 backdrop-blur-md flex items-center justify-between px-4 md:px-8 z-40 sticky top-0">
            <div class="search-wrap relative flex-1 max-w-lg group">
                <div
                    class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-brand-500 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <input type="text" id="gSearch"
                    class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl pl-10 pr-12 py-2 text-sm focus:ring-2 focus:ring-brand-500 transition-all placeholder-slate-500 dark:text-slate-200"
                    placeholder="Search... (Ctrl+K)" autocomplete="off">
                <div class="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1 pointer-events-none">
                    <kbd
                        class="hidden md:inline-block px-1.5 py-0.5 text-[10px] font-bold text-slate-500 bg-white dark:bg-slate-700 rounded border border-slate-200 dark:border-slate-600">ESC</kbd>
                </div>
                <!-- Search Dropdown -->
                <div id="gSearchDrop"
                    class="search-dropdown-glass absolute top-full mt-2 left-0 w-full rounded-xl hidden p-1 z-50 text-slate-800 dark:text-slate-100">
                </div>
            </div>

            <div class="flex items-center gap-4 ml-4">
                <div
                    class="hidden md:flex items-center gap-3 text-xs font-medium text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-800 px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700">
                    <span>Packs: <b id="hdrPacks" class="text-brand-600 dark:text-brand-400">0</b></span>
                    <span class="w-px h-3 bg-slate-300 dark:bg-slate-600"></span>
                    <span>Words: <b id="hdrWords" class="text-brand-600 dark:text-brand-400">0</b></span>
                </div>

                <!-- Auth UI -->
                <div id="authContainer" class="flex items-center gap-2">
                    <!-- Logged Out State -->
                    <button id="loginBtn" onclick="netlifyIdentity.open('login')"
                        class="px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                        </svg>
                        Login
                    </button>

                    <!-- Logged In State (hidden by default) -->
                    <div id="userInfo" class="hidden flex items-center gap-2">
                        <div
                            class="text-xs font-medium text-slate-500 dark:text-slate-400 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 px-3 py-1.5 rounded-full border border-green-200 dark:border-green-800 flex items-center gap-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            <span id="userEmail">user@email.com</span>
                        </div>
                        <button id="logoutBtn" onclick="netlifyIdentity.logout()"
                            class="px-3 py-1.5 text-xs font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors">
                            Logout
                        </button>
                    </div>
                </div>

                <button id="hdrNewPack"
                    class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 hover:bg-slate-800 dark:hover:bg-slate-200 px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-slate-900/10 transition-all hover:-translate-y-0.5 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    New Pack
                </button>
            </div>
        </header>

        <!-- SCROLLABLE CONTENT AREA -->
        <div class="flex-1 overflow-y-auto p-4 md:p-8 relative" id="mainScroll">

            <!-- ======== GENERATOR PAGE ======== -->
            <div class="page active max-w-7xl mx-auto h-full" id="pg-generator">
                <div class="flex flex-col md:flex-row justify-between items-end mb-4 gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-900 dark:text-white tracking-tight">Generator</h1>
                        <p class="text-slate-500 dark:text-slate-400">Mix keywords to find your perfect domain.</p>
                    </div>
                    <button id="clearInputsBtn"
                        class="text-slate-500 hover:text-red-500 dark:text-slate-400 dark:hover:text-red-400 text-sm font-medium flex items-center gap-1.5 px-3 py-1.5 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                        Clear Inputs
                    </button>
                </div>

                <div class="flex flex-col lg:flex-row gap-6 h-[calc(100%-4rem)]">
                    <!-- Config Column - Fixed/Sticky -->
                    <div class="lg:w-[380px] lg:flex-shrink-0 space-y-4 lg:overflow-y-auto lg:max-h-full lg:pr-2">
                        <!-- Step 1 -->
                        <div class="glass-panel p-5 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2">
                                    <span
                                        class="w-6 h-6 rounded bg-brand-100 text-brand-600 dark:bg-brand-900 dark:text-brand-300 text-xs flex items-center justify-center">1</span>
                                    Anchor Word
                                </h3>
                            </div>
                            <div class="space-y-3">
                                <div class="flex gap-2">
                                    <input type="text" id="mainKw"
                                        class="flex-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 outline-none"
                                        placeholder="e.g. flow">
                                    <button id="pickMultBtn"
                                        class="bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 px-3 rounded-lg text-lg"
                                        title="Pick from Library">ğŸ“¦</button>
                                </div>
                                <div id="selectedMultInfo"
                                    class="text-xs text-brand-600 dark:text-brand-400 font-medium h-4"></div>

                                <div class="bg-slate-100 dark:bg-slate-800 p-1 rounded-lg flex" id="posGroup">
                                    <button
                                        class="tog flex-1 py-1.5 text-xs font-semibold rounded-md transition-all shadow-sm bg-white dark:bg-slate-600 text-brand-600 dark:text-brand-300 on"
                                        data-v="prefix">Prefix</button>
                                    <button
                                        class="tog flex-1 py-1.5 text-xs font-medium rounded-md transition-all text-slate-500 hover:text-slate-900 dark:text-slate-400"
                                        data-v="suffix">Suffix</button>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2 -->
                        <div class="glass-panel p-5 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2">
                                    <span
                                        class="w-6 h-6 rounded bg-accent-100 text-accent-600 dark:bg-accent-900 dark:text-accent-300 text-xs flex items-center justify-center">2</span>
                                    Bulk Keywords
                                </h3>
                                <span id="kwCount"
                                    class="text-xs font-mono bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded text-slate-500">0</span>
                            </div>

                            <button id="insertPackBtn"
                                class="w-full mb-3 bg-brand-50 text-brand-700 dark:bg-brand-900/30 dark:text-brand-300 hover:bg-brand-100 dark:hover:bg-brand-900/50 py-2 rounded-lg text-xs font-bold transition-colors border border-brand-200 dark:border-brand-800/50">
                                + Insert Category Pack
                            </button>
                            <div id="insertedList" class="flex flex-wrap gap-2 mb-2 min-h-[4px]"></div>

                            <textarea id="bulkKw"
                                class="w-full h-40 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-3 text-sm focus:ring-2 focus:ring-brand-500 outline-none resize-none font-mono"
                                placeholder="Paste list..."></textarea>

                            <div class="flex gap-2 mt-3">
                                <button id="dedupBtn"
                                    class="flex-1 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 py-1.5 rounded-lg text-xs font-medium text-slate-600 dark:text-slate-300">Clean</button>
                                <button id="sortKwBtn"
                                    class="flex-1 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 py-1.5 rounded-lg text-xs font-medium text-slate-600 dark:text-slate-300">Sort
                                    A-Z</button>
                                <button id="cleanBtn"
                                    class="flex-1 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 py-1.5 rounded-lg text-xs font-medium text-slate-600 dark:text-slate-300">Dedupe</button>
                                <button id="removeNumsKwBtn"
                                    class="flex-1 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 py-1.5 rounded-lg text-xs font-medium text-slate-600 dark:text-slate-300">No
                                    #</button>
                            </div>
                        </div>

                        <!-- Availability Model -->
                        <div class="glass-panel p-5 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-3">
                                <h3
                                    class="font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2 text-sm uppercase tracking-wider">
                                    Availability Check
                                </h3>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="genCheckEnabled"
                                        class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                    <span class="text-xs font-normal text-slate-500">Enable</span>
                                </label>
                            </div>

                            <div id="genCheckSettings"
                                class="grid grid-cols-2 gap-3 opacity-50 pointer-events-none transition-opacity">
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Target</label>
                                    <input type="number" id="genTargetResults" value="50" min="1" max="200"
                                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-sm outline-none focus:ring-1 focus:ring-brand-500">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Max Checks</label>
                                    <input type="number" id="genMaxChecks" value="500" min="50" max="4000"
                                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-sm outline-none focus:ring-1 focus:ring-brand-500">
                                </div>
                            </div>
                        </div>

                        <!-- Action -->
                        <div class="glass-panel p-5 rounded-2xl shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex flex-wrap gap-2 mb-4" id="extChips">
                                <div class="chip on px-3 py-1 bg-brand-500 text-white rounded-full text-xs font-bold cursor-pointer border border-transparent shadow-sm"
                                    data-ext=".com">.com</div>
                                <div class="chip px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-500 rounded-full text-xs font-medium cursor-pointer border border-slate-200 dark:border-slate-700 hover:border-brand-500"
                                    data-ext=".io">.io</div>
                                <div class="chip px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-500 rounded-full text-xs font-medium cursor-pointer border border-slate-200 dark:border-slate-700 hover:border-brand-500"
                                    data-ext=".ai">.ai</div>
                                <div class="chip px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-500 rounded-full text-xs font-medium cursor-pointer border border-slate-200 dark:border-slate-700 hover:border-brand-500"
                                    data-ext=".co">.co</div>
                                <div class="chip px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-500 rounded-full text-xs font-medium cursor-pointer border border-slate-200 dark:border-slate-700 hover:border-brand-500"
                                    data-ext=".app">.app</div>
                            </div>
                            <button id="genBtn"
                                class="w-full bg-gradient-to-r from-brand-600 to-indigo-600 hover:from-brand-500 hover:to-indigo-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-brand-500/25 transition-all transform active:scale-95 flex items-center justify-center gap-2">
                                <span id="genBtnText">âœ¨ Generate Results</span>
                                <div id="genSpinner" class="spinner hidden text-white border-white/30"></div>
                            </button>
                        </div>
                    </div>

                    <!-- Results Column - Scrollable -->
                    <div class="flex-1 flex flex-col min-h-0">
                        <!-- Progress Bar for Generator -->
                        <div id="genProgressArea"
                            class="hidden mb-4 bg-white/80 dark:bg-slate-800/80 backdrop-blur rounded-xl border border-slate-200 dark:border-slate-700 p-4 shadow-sm mx-4 md:mx-0">
                            <div class="flex justify-between text-xs font-semibold uppercase text-slate-500 mb-2">
                                <span>Checking Availability...</span>
                                <span id="genProgressText">0 / 0</span>
                            </div>
                            <div class="h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden mb-2">
                                <div id="genProgressBar"
                                    class="h-full bg-gradient-to-r from-brand-500 to-indigo-500 w-0 transition-all duration-300">
                                </div>
                            </div>
                            <div class="flex gap-4 text-xs items-center">
                                <span class="text-green-600 dark:text-green-400 font-bold">Available: <span
                                        id="genCountAvail">0</span></span>
                                <span class="text-slate-500">Checked: <span id="genCountChecked">0</span></span>
                                <button id="genStopBtn"
                                    class="ml-auto text-red-500 hover:text-red-700 font-bold uppercase tracking-wider px-2 py-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors"
                                    onclick="S.cancelGenCheck=true">Stop</button>
                            </div>
                        </div>

                        <div
                            class="glass-panel flex-1 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col overflow-hidden min-h-0">
                            <!-- Results Header -->
                            <div
                                class="p-4 border-b border-slate-100 dark:border-slate-700 bg-white/50 dark:bg-slate-800/50 flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <h3 class="font-bold text-slate-800 dark:text-slate-100">Results</h3>
                                    <span id="resCount"
                                        class="text-xs font-mono bg-brand-100 dark:bg-brand-900/30 text-brand-700 dark:text-brand-300 px-2 py-0.5 rounded-md">(0)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button class="p-1.5 text-slate-400 hover:text-brand-500 transition-colors"
                                        id="sortResAlpha" title="Sort A-Z">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12" />
                                        </svg>
                                    </button>
                                    <button class="p-1.5 text-slate-400 hover:text-brand-500 transition-colors"
                                        id="sortResLen" title="Sort Length">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 6h16M4 12h16M4 18h7" />
                                        </svg>
                                    </button>
                                    <div class="h-4 w-px bg-slate-300 dark:bg-slate-600 mx-1"></div>
                                    <button id="copyAllBtn"
                                        class="text-xs font-medium px-3 py-1.5 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors">Copy</button>
                                    <button id="exportResBtn"
                                        class="text-xs font-medium px-3 py-1.5 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors">Export</button>
                                </div>
                            </div>

                            <!-- AI Scoring Controls -->
                            <div id="aiScoringPanel"
                                class="p-3 border-b border-slate-100 dark:border-slate-700 bg-gradient-to-r from-purple-50/50 to-indigo-50/50 dark:from-purple-900/10 dark:to-indigo-900/10">
                                <div class="flex flex-wrap items-center gap-3">
                                    <!-- Score Button -->
                                    <button id="aiScoreBtn"
                                        class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white text-xs font-bold px-4 py-2 rounded-lg shadow-md shadow-purple-500/20 transition-all flex items-center gap-2">
                                        <span id="aiScoreBtnIcon">ğŸ¤–</span>
                                        <span id="aiScoreBtnText">Score with AI</span>
                                        <div id="aiScoreSpinner"
                                            class="hidden w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin">
                                        </div>
                                    </button>

                                    <!-- Preset Dropdown -->
                                    <select id="aiPreset"
                                        class="text-xs bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 outline-none">
                                        <option value="brandable">ğŸ¨ General Brandable</option>
                                        <option value="lenders">ğŸ¦ Lenders / Finance</option>
                                        <option value="payments">ğŸ’³ Payments / Fintech</option>
                                        <option value="ads">ğŸ“¢ Ads / Marketing</option>
                                    </select>

                                    <div class="h-4 w-px bg-slate-300 dark:bg-slate-600"></div>

                                    <!-- Filter Buttons -->
                                    <div class="flex gap-1" id="aiFilterBtns">
                                        <button id="showAllBtn"
                                            class="text-xs px-3 py-1.5 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">All</button>
                                        <button id="showActionableBtn"
                                            class="text-xs px-3 py-1.5 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 font-medium">Actionable</button>
                                        <button id="showTop50Btn"
                                            class="text-xs px-3 py-1.5 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">Top
                                            50</button>
                                        <button id="showTop100Btn"
                                            class="text-xs px-3 py-1.5 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">Top
                                            100</button>
                                    </div>

                                    <div class="h-4 w-px bg-slate-300 dark:bg-slate-600"></div>

                                    <!-- Export Scored -->
                                    <button id="exportScoredBtn"
                                        class="text-xs font-medium px-3 py-1.5 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        CSV
                                    </button>
                                </div>

                                <!-- Status Area -->
                                <div id="aiStatusArea" class="hidden mt-3 text-xs">
                                    <div class="flex items-center gap-2">
                                        <div id="aiProgressBar"
                                            class="flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                                            <div id="aiProgressFill"
                                                class="h-full bg-gradient-to-r from-purple-500 to-indigo-500 transition-all duration-300"
                                                style="width: 0%"></div>
                                        </div>
                                        <span id="aiProgressText" class="text-slate-500 font-mono">0/0</span>
                                    </div>
                                    <div id="aiErrorMsg"
                                        class="hidden mt-2 text-red-500 bg-red-50 dark:bg-red-900/20 px-3 py-2 rounded-lg">
                                    </div>
                                </div>
                            </div>

                            <!-- Results Grid -->
                            <div class="flex-1 overflow-y-auto p-4 bg-slate-50/50 dark:bg-slate-900/20"
                                id="resContainer">
                                <div class="empty flex flex-col items-center justify-center h-full text-slate-400">
                                    <div
                                        class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mb-4 text-2xl">
                                        ğŸ¯</div>
                                    <h3 class="text-lg font-bold text-slate-700 dark:text-slate-300">Ready to Generate
                                    </h3>
                                    <p class="text-sm mt-1">Configure your keywords and click the button.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======== AUTOMATION PAGE ======== -->
            <div class="page hidden max-w-7xl mx-auto" id="pg-automation">
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-900 dark:text-white flex items-center gap-3">
                            ğŸ¤– Automation
                            <span
                                class="bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-xs font-bold px-2 py-1 rounded-full">AI</span>
                        </h1>
                        <p class="text-slate-500 dark:text-slate-400">Configure packs, templates, and let AI score your
                            domains.</p>
                    </div>
                    <div class="flex gap-2">
                        <button id="autoSavePreset"
                            class="text-xs font-medium px-3 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">ğŸ’¾
                            Save Preset</button>
                        <button id="autoLoadPreset"
                            class="text-xs font-medium px-3 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">ğŸ“‚
                            Load Preset</button>
                        <button id="autoResetPreset"
                            class="text-xs font-medium px-3 py-2 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800 hover:bg-red-100 transition-colors">ğŸ—‘ï¸
                            Reset</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Left Column: Pack Manager -->
                    <div class="lg:col-span-2 space-y-4">
                        <!-- Pack Manager -->
                        <div
                            class="glass-panel rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-5">
                            <h2 class="font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2">
                                ğŸ“¦ Pack Manager
                                <span class="text-xs font-normal text-slate-400">Enter words (comma or newline
                                    separated)</span>
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-bold text-slate-600 dark:text-slate-300 mb-2">Pack
                                        A</label>
                                    <textarea id="autoPackA" rows="4"
                                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none font-mono"
                                        placeholder="trust&#10;secure&#10;verify"></textarea>
                                    <div class="flex gap-2 mt-2">
                                        <label class="flex items-center gap-1 text-xs text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="autoPackAPlural"
                                                class="rounded border-slate-300 text-purple-500 focus:ring-purple-500">
                                            Plurals
                                        </label>
                                        <label class="flex items-center gap-1 text-xs text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="autoPackATense"
                                                class="rounded border-slate-300 text-purple-500 focus:ring-purple-500">
                                            Tenses
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-slate-600 dark:text-slate-300 mb-2">Pack
                                        B</label>
                                    <textarea id="autoPackB" rows="4"
                                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none font-mono"
                                        placeholder="yield&#10;flow&#10;hub"></textarea>
                                    <div class="flex gap-2 mt-2">
                                        <label class="flex items-center gap-1 text-xs text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="autoPackBPlural"
                                                class="rounded border-slate-300 text-purple-500 focus:ring-purple-500">
                                            Plurals
                                        </label>
                                        <label class="flex items-center gap-1 text-xs text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="autoPackBTense"
                                                class="rounded border-slate-300 text-purple-500 focus:ring-purple-500">
                                            Tenses
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-slate-600 dark:text-slate-300 mb-2">Pack
                                        C</label>
                                    <textarea id="autoPackC" rows="4"
                                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none font-mono"
                                        placeholder="pro&#10;hq&#10;app"></textarea>
                                    <div class="flex gap-2 mt-2">
                                        <label class="flex items-center gap-1 text-xs text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="autoPackCPlural"
                                                class="rounded border-slate-300 text-purple-500 focus:ring-purple-500">
                                            Plurals
                                        </label>
                                        <label class="flex items-center gap-1 text-xs text-slate-500 cursor-pointer">
                                            <input type="checkbox" id="autoPackCTense"
                                                class="rounded border-slate-300 text-purple-500 focus:ring-purple-500">
                                            Tenses
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Multipliers -->
                            <h3 class="font-bold text-slate-700 dark:text-slate-200 mt-6 mb-3 text-sm">Multipliers</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Prefixes</label>
                                    <textarea id="autoPrefixes" rows="2"
                                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none font-mono"
                                        placeholder="get, my, the"></textarea>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Suffixes</label>
                                    <textarea id="autoSuffixes" rows="2"
                                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none font-mono"
                                        placeholder="hq, io, app, ly"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Results Area -->
                        <div
                            class="glass-panel rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
                            <!-- Results Header -->
                            <div
                                class="p-4 border-b border-slate-100 dark:border-slate-700 bg-white/50 dark:bg-slate-800/50 flex flex-wrap items-center justify-between gap-3">
                                <div class="flex items-center gap-3">
                                    <h3 class="font-bold text-slate-800 dark:text-slate-100">Results</h3>
                                    <span id="autoResCount"
                                        class="text-xs font-mono bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded-md">(0)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <!-- Bucket Filters -->
                                    <div class="flex gap-1" id="autoBucketFilters">
                                        <button data-bucket="FAST-FLIP"
                                            class="bucket-filter text-xs px-2 py-1 rounded-lg bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 font-medium">FAST-FLIP</button>
                                        <button data-bucket="HOLD"
                                            class="bucket-filter text-xs px-2 py-1 rounded-lg bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 font-medium">HOLD</button>
                                        <button data-bucket="PASS"
                                            class="bucket-filter hidden-bucket text-xs px-2 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-400">PASS</button>
                                    </div>
                                    <div class="h-4 w-px bg-slate-300 dark:bg-slate-600"></div>
                                    <button id="autoTop50Btn"
                                        class="text-xs px-2 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-slate-200 transition-colors">Top
                                        50</button>
                                    <button id="autoTop100Btn"
                                        class="text-xs px-2 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-slate-200 transition-colors">Top
                                        100</button>
                                    <button id="autoCopyBtn"
                                        class="text-xs px-2 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-slate-200 transition-colors">Copy</button>
                                    <button id="autoExportBtn"
                                        class="text-xs px-2 py-1 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 font-medium flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        CSV
                                    </button>
                                </div>
                            </div>

                            <!-- Progress Bar -->
                            <div id="autoProgressArea"
                                class="hidden p-3 border-b border-slate-100 dark:border-slate-700 bg-purple-50/50 dark:bg-purple-900/10">
                                <div class="flex items-center gap-3">
                                    <div class="flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                                        <div id="autoProgressFill"
                                            class="h-full bg-gradient-to-r from-purple-500 to-indigo-500 transition-all duration-300"
                                            style="width: 0%"></div>
                                    </div>
                                    <span id="autoProgressText" class="text-xs text-slate-500 font-mono w-20">0 /
                                        0</span>
                                    <button id="autoCancelBtn"
                                        class="text-xs px-2 py-1 rounded bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 transition-colors">Cancel</button>
                                </div>
                                <div id="autoErrorMsg"
                                    class="hidden mt-2 text-xs text-red-500 bg-red-50 dark:bg-red-900/20 px-3 py-2 rounded-lg">
                                </div>
                            </div>

                            <!-- Results Table -->
                            <div class="overflow-x-auto max-h-[500px] overflow-y-auto" id="autoResultsContainer">
                                <div class="empty flex flex-col items-center justify-center py-16 text-slate-400">
                                    <div
                                        class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mb-4 text-2xl">
                                        ğŸ¤–</div>
                                    <h3 class="text-lg font-bold text-slate-700 dark:text-slate-300">Ready to Generate
                                    </h3>
                                    <p class="text-sm mt-1">Configure packs & templates, then click Generate.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Controls -->
                    <div class="space-y-4">
                        <!-- Templates -->
                        <div
                            class="glass-panel rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-5">
                            <h2 class="font-bold text-slate-800 dark:text-slate-100 mb-4">ğŸ“ Templates</h2>
                            <div class="space-y-2">
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer hover:text-purple-600">
                                    <input type="checkbox" id="tplAB" checked
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> A + B
                                </label>
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer hover:text-purple-600">
                                    <input type="checkbox" id="tplBA"
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> B + A
                                </label>
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer hover:text-purple-600">
                                    <input type="checkbox" id="tplABC"
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> A + B +
                                    C
                                </label>
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer hover:text-purple-600">
                                    <input type="checkbox" id="tplPrefixAB"
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> prefix +
                                    A + B
                                </label>
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer hover:text-purple-600">
                                    <input type="checkbox" id="tplABSuffix"
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> A + B +
                                    suffix
                                </label>
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer hover:text-purple-600">
                                    <input type="checkbox" id="tplPrefixABSuffix"
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> prefix +
                                    A + B + suffix
                                </label>
                            </div>
                        </div>

                        <!-- Constraints -->
                        <div
                            class="glass-panel rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-5">
                            <h2 class="font-bold text-slate-800 dark:text-slate-100 mb-4">âš™ï¸ Constraints</h2>

                            <div class="mb-4">
                                <label class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-2">
                                    Max Length: <span id="autoMaxLenValue" class="font-bold text-purple-600">12</span>
                                </label>
                                <input type="range" id="autoMaxLen" min="6" max="16" value="12"
                                    class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
                            </div>

                            <div class="space-y-2">
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer">
                                    <input type="checkbox" id="autoNoHyphens" checked
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> No
                                    hyphens
                                </label>
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer">
                                    <input type="checkbox" id="autoNoNumbers" checked
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> No
                                    numbers
                                </label>
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer">
                                    <input type="checkbox" id="autoDedupe" checked
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500">
                                    De-duplicate
                                </label>
                                <label
                                    class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300 cursor-pointer">
                                    <input type="checkbox" id="autoAvoidUgly" checked
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500"> Avoid
                                    ugly clusters
                                </label>
                            </div>

                            <div class="mt-4">
                                <label class="block text-xs font-medium text-slate-500 mb-1">Banned Substrings (one per
                                    line)</label>
                                <textarea id="autoBanned" rows="2"
                                    class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-xs focus:ring-2 focus:ring-purple-500 outline-none resize-none font-mono"
                                    placeholder="sex&#10;xxx&#10;spam"></textarea>
                            </div>
                        </div>

                        <!-- Presets & Actions -->
                        <div
                            class="glass-panel rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-5">
                            <h2 class="font-bold text-slate-800 dark:text-slate-100 mb-4">ğŸ“‹ Presets</h2>

                            <!-- Preset Dropdown -->
                            <select id="autoPresetSelect"
                                class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none mb-3">
                                <option value="">â€” Select a preset â€”</option>
                            </select>

                            <!-- Preset Buttons -->
                            <div class="flex gap-2 mb-4">
                                <button id="autoManagePresetsBtn"
                                    class="flex-1 text-xs font-medium px-3 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center justify-center gap-1">
                                    âš™ï¸ Manage Presets
                                </button>
                                <button id="autoSaveAsPresetBtn"
                                    class="flex-1 text-xs font-medium px-3 py-2 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 border border-purple-200 dark:border-purple-800 hover:bg-purple-200 transition-colors flex items-center justify-center gap-1">
                                    ğŸ’¾ Save Current
                                </button>
                            </div>

                            <!-- Availability Settings -->
                            <div class="mb-4 pt-4 border-t border-slate-100 dark:border-slate-700">
                                <h3 class="font-bold text-xs text-slate-500 mb-3 uppercase tracking-wider">Availability
                                    Check</h3>
                                <div class="grid grid-cols-2 gap-3 mb-3">
                                    <div>
                                        <label class="block text-xs font-medium text-slate-500 mb-1">Target
                                            Results</label>
                                        <input type="number" id="autoTargetResults" value="50" min="1" max="200"
                                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-slate-500 mb-1">Max Checks</label>
                                        <input type="number" id="autoMaxChecks" value="500" min="50" max="4000"
                                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none">
                                    </div>
                                </div>
                                <label class="flex items-center gap-2 text-xs text-slate-500 cursor-pointer">
                                    <input type="checkbox" id="autoShowProgress" checked
                                        class="rounded border-slate-300 text-purple-500 focus:ring-purple-500">
                                    Show checking progress
                                </label>
                            </div>

                            <div class="space-y-3">
                                <button id="autoGenerateBtn"
                                    class="w-full bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 text-white font-bold py-3 rounded-xl shadow-lg transition-all flex items-center justify-center gap-2">
                                    ğŸš€ Auto Generate
                                </button>
                                <button id="autoScoreBtn"
                                    class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-purple-500/25 transition-all flex items-center justify-center gap-2">
                                    <span id="autoScoreIcon">ğŸ¤–</span>
                                    <span id="autoScoreText">AI Score & Shortlist</span>
                                    <div id="autoScoreSpinner"
                                        class="hidden w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin">
                                    </div>
                                </button>
                                <button id="autoAgentBtn"
                                    class="w-full bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-emerald-500/25 transition-all flex items-center justify-center gap-2">
                                    <span id="autoAgentIcon">âš¡</span>
                                    <span id="autoAgentText">Run AI Agent</span>
                                    <div id="autoAgentSpinner"
                                        class="hidden w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin">
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Automation Results -->
                <div class="mt-8 mb-12 animate-fade-in-up">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2">
                            <span>âœ¨ Results</span>
                            <span id="autoResCount"
                                class="text-sm font-medium text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full">0</span>
                        </h2>
                        <div class="flex gap-2">
                            <button id="autoCopyBtn"
                                class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                                ğŸ“‹ Copy Available
                            </button>
                            <button id="autoExportBtn"
                                class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                                ğŸ“¥ CSV
                            </button>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div id="autoProgressArea"
                        class="hidden mb-6 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm">
                        <div class="flex justify-between text-xs font-semibold uppercase text-slate-500 mb-2">
                            <span>Checking Availability...</span>
                            <span id="autoProgressText">0 / 0</span>
                        </div>
                        <div class="h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden">
                            <div id="autoProgressBar"
                                class="h-full bg-gradient-to-r from-purple-500 to-indigo-500 w-0 transition-all duration-300">
                            </div>
                        </div>
                        <div class="flex gap-4 mt-2 text-xs">
                            <span class="text-green-600 dark:text-green-400">Available: <b
                                    id="autoCountAvail">0</b></span>
                            <span class="text-slate-500">Checked: <b id="autoCountChecked">0</b></span>
                            <button id="autoStopBtn" class="ml-auto text-red-500 hover:text-red-700 font-bold"
                                onclick="S.cancelCheck=true">STOP</button>
                        </div>
                    </div>

                    <!-- Results Grid -->
                    <div id="autoResultsGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3">
                        <!-- Filled by JS -->
                        <div class="col-span-full py-12 text-center text-slate-400">
                            Generated domains will appear here...
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======== WINNERS PAGE ======== -->
            <div class="page max-w-7xl mx-auto" id="pg-winners">
                <!-- Auth Required Overlay (shown when not logged in) -->
                <div id="winnersAuthOverlay"
                    class="glass-panel rounded-2xl border border-slate-200 dark:border-slate-700 p-12 text-center mb-6">
                    <div
                        class="w-20 h-20 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl shadow-lg shadow-purple-500/30">
                        ğŸ”’
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-3">Authentication Required</h2>
                    <p class="text-slate-500 dark:text-slate-400 mb-6 max-w-md mx-auto">
                        Winners are protected. Please log in with your authorized account to view your domain portfolio.
                    </p>
                    <button onclick="netlifyIdentity.open('login')"
                        class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold px-8 py-3 rounded-xl shadow-lg shadow-purple-500/25 transition-all transform hover:scale-105 flex items-center gap-2 mx-auto">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                        </svg>
                        Login to View Winners
                    </button>
                </div>

                <!-- Winners Content (hidden until authenticated) -->
                <div id="winnersContent" class="hidden">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4">
                        <div>
                            <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Winners</h1>
                            <p class="text-slate-500 dark:text-slate-400">Track domains you want to buy, own, or have
                                sold.
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <button id="addWinnerBtn"
                                class="bg-gradient-to-r from-violet-500 to-purple-600 hover:from-violet-600 hover:to-purple-700 text-white dark:from-lime-400 dark:to-green-500 dark:text-slate-900 px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-purple-500/25 dark:shadow-lime-500/25 transition-all flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                                Add Domain
                            </button>
                            <div class="relative">
                                <button id="exportWinDropBtn"
                                    class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-4 py-2 rounded-lg text-sm font-medium shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-2">
                                    Export
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                                <div id="exportWinDrop"
                                    class="hidden absolute right-0 mt-2 w-40 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden">
                                    <button onclick="exportWinnersCSV()"
                                        class="w-full px-4 py-2.5 text-left text-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">Export
                                        CSV</button>
                                    <button onclick="exportWinnersTXT()"
                                        class="w-full px-4 py-2.5 text-left text-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">Export
                                        TXT</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="glass-panel rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
                        <!-- Filters -->
                        <div
                            class="p-4 border-b border-slate-100 dark:border-slate-700 flex flex-wrap gap-4 items-center">
                            <input type="text" id="winSearch" placeholder="Search domains..."
                                class="bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2 text-sm w-64 focus:ring-2 focus:ring-accent-500 outline-none">
                            <div class="flex gap-2" id="winStatusFilters">
                                <button
                                    class="status-filter active text-xs px-3 py-1.5 rounded-full font-medium bg-slate-900 text-white dark:bg-white dark:text-slate-900"
                                    data-status="all">All</button>
                                <button
                                    class="status-filter text-xs px-3 py-1.5 rounded-full font-medium bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400 hover:bg-slate-200"
                                    data-status="Want">Want</button>
                                <button
                                    class="status-filter text-xs px-3 py-1.5 rounded-full font-medium bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400 hover:bg-slate-200"
                                    data-status="Watching">Watching</button>
                                <button
                                    class="status-filter text-xs px-3 py-1.5 rounded-full font-medium bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400 hover:bg-slate-200"
                                    data-status="Owned">Owned</button>
                                <button
                                    class="status-filter text-xs px-3 py-1.5 rounded-full font-medium bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400 hover:bg-slate-200"
                                    data-status="Sold">Sold</button>
                            </div>
                            <span id="winCountBadge"
                                class="ml-auto text-xs font-mono bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded text-slate-500">0
                                domains</span>
                        </div>

                        <!-- Table -->
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead
                                    class="bg-slate-50 dark:bg-slate-800/50 text-xs font-bold text-slate-500 uppercase">
                                    <tr>
                                        <th class="px-6 py-4">Domain</th>
                                        <th class="px-6 py-4">Category</th>
                                        <th class="px-6 py-4">Status</th>
                                        <th class="px-6 py-4">Price</th>
                                        <th class="px-6 py-4">Notes</th>
                                        <th class="px-6 py-4">Date</th>
                                        <th class="px-6 py-4 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="winnersTable"
                                    class="divide-y divide-slate-100 dark:divide-slate-800 text-sm">
                                </tbody>
                            </table>
                            <div id="winEmpty" class="hidden p-12 text-center text-slate-400">
                                <div
                                    class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mb-4 mx-auto text-2xl">
                                    â­</div>
                                <h3 class="font-bold text-slate-600 dark:text-slate-300">No winners yet</h3>
                                <p class="text-sm mt-1">Save domains from results or add them manually.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- End pg-winners -->

            <!-- ======== PACKS PAGE ======== -->
            <div class="page max-w-7xl mx-auto" id="pg-packs">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Pack Manager</h1>
                        <p class="text-slate-500 dark:text-slate-400">Organize your keyword collections.</p>
                    </div>
                    <div class="flex gap-2">
                        <button id="importPackBtn"
                            class="px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 transition-colors">Import</button>
                        <button id="exportPacksBtn"
                            class="px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 transition-colors">Export
                            All</button>
                        <button id="newPackBtn2"
                            class="bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-brand-500/20 transition-all">+
                            Create Pack</button>
                    </div>
                </div>

                <div class="mb-6">
                    <input type="text" id="packSearch" placeholder="Search your packs..."
                        class="w-full max-w-md bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 focus:ring-2 focus:ring-brand-500 outline-none">
                </div>

                <div id="csvDropZone"
                    class="border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-8 text-center text-slate-400 mb-8 hover:border-brand-500 hover:bg-brand-50/50 dark:hover:bg-brand-900/10 transition-all cursor-pointer">
                    <p class="font-medium">Drag & drop CSV files here to create packs instantly</p>
                </div>

                <div id="packsGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </div>

            <!-- ======== FAVORITES PAGE ======== -->
            <div class="page max-w-7xl mx-auto" id="pg-favorites">
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">Favorite Packs</h1>
                <p class="text-slate-500 dark:text-slate-400 mb-8">Quick access to your most used collections.</p>
                <div id="favsGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </div>

            <!-- ======== LIBRARY PAGE ======== -->
            <div class="page max-w-7xl mx-auto" id="pg-library">
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">Library</h1>
                <p class="text-slate-500 dark:text-slate-400 mb-8">All unique keywords across all packs.</p>
                <div class="glass-panel p-6 rounded-2xl border border-slate-200 dark:border-slate-700">
                    <input type="text" id="libSearch" placeholder="Filter keywords..."
                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2 mb-6 focus:ring-2 focus:ring-brand-500 outline-none">
                    <div id="libChips" class="flex flex-wrap gap-2 max-h-[60vh] overflow-y-auto"></div>
                </div>
            </div>

            <!-- ======== SETTINGS PAGE ======== -->
            <div class="page max-w-4xl mx-auto" id="pg-settings">
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">Settings</h1>
                <p class="text-slate-500 dark:text-slate-400 mb-8">Customize your experience with themes and data
                    options.</p>

                <div class="space-y-6">
                    <!-- Appearance / Theme Section -->
                    <div class="glass-panel p-6 rounded-2xl border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center gap-3 mb-6">
                            <div
                                class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center text-white text-lg">
                                ğŸ¨</div>
                            <div>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white">Color Themes</h3>
                                <p class="text-sm text-slate-500 dark:text-slate-400">Choose your favorite accent
                                    color
                                </p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4" id="themeGrid">
                            <!-- Purple Theme -->
                            <div class="theme-option cursor-pointer p-4 rounded-xl border-2 border-transparent bg-white dark:bg-slate-800 hover:shadow-lg transition-all group"
                                data-theme="purple">
                                <div class="flex gap-2 mb-3">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 shadow-lg shadow-purple-500/30">
                                    </div>
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-pink-400 to-fuchsia-500 shadow-lg shadow-pink-500/30">
                                    </div>
                                </div>
                                <div class="font-bold text-sm text-slate-700 dark:text-slate-200">Purple</div>
                                <div class="text-xs text-slate-400">Elegant & Modern</div>
                            </div>
                            <!-- Teal Theme -->
                            <div class="theme-option cursor-pointer p-4 rounded-xl border-2 border-transparent bg-white dark:bg-slate-800 hover:shadow-lg transition-all group"
                                data-theme="teal">
                                <div class="flex gap-2 mb-3">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-teal-500 to-cyan-600 shadow-lg shadow-teal-500/30">
                                    </div>
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-emerald-400 to-green-500 shadow-lg shadow-emerald-500/30">
                                    </div>
                                </div>
                                <div class="font-bold text-sm text-slate-700 dark:text-slate-200">Teal</div>
                                <div class="text-xs text-slate-400">Fresh & Clean</div>
                            </div>
                            <!-- Orange Theme -->
                            <div class="theme-option cursor-pointer p-4 rounded-xl border-2 border-transparent bg-white dark:bg-slate-800 hover:shadow-lg transition-all group"
                                data-theme="orange">
                                <div class="flex gap-2 mb-3">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-orange-500 to-red-500 shadow-lg shadow-orange-500/30">
                                    </div>
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-amber-400 to-yellow-500 shadow-lg shadow-amber-500/30">
                                    </div>
                                </div>
                                <div class="font-bold text-sm text-slate-700 dark:text-slate-200">Orange</div>
                                <div class="text-xs text-slate-400">Bold & Energetic</div>
                            </div>
                            <!-- Rose Theme -->
                            <div class="theme-option cursor-pointer p-4 rounded-xl border-2 border-transparent bg-white dark:bg-slate-800 hover:shadow-lg transition-all group"
                                data-theme="rose">
                                <div class="flex gap-2 mb-3">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-rose-500 to-pink-600 shadow-lg shadow-rose-500/30">
                                    </div>
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-red-400 to-rose-500 shadow-lg shadow-red-500/30">
                                    </div>
                                </div>
                                <div class="font-bold text-sm text-slate-700 dark:text-slate-200">Rose</div>
                                <div class="text-xs text-slate-400">Warm & Vibrant</div>
                            </div>
                            <!-- Gold Theme -->
                            <div class="theme-option cursor-pointer p-4 rounded-xl border-2 border-transparent bg-white dark:bg-slate-800 hover:shadow-lg transition-all group"
                                data-theme="gold">
                                <div class="flex gap-2 mb-3">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-amber-400 to-yellow-500 shadow-lg shadow-amber-500/30">
                                    </div>
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-orange-400 to-amber-500 shadow-lg shadow-orange-500/30">
                                    </div>
                                </div>
                                <div class="font-bold text-sm text-slate-700 dark:text-slate-200">Gold</div>
                                <div class="text-xs text-slate-400">Luxurious & Rich</div>
                            </div>
                            <!-- Lime Theme -->
                            <div class="theme-option cursor-pointer p-4 rounded-xl border-2 border-transparent bg-white dark:bg-slate-800 hover:shadow-lg transition-all group"
                                data-theme="lime">
                                <div class="flex gap-2 mb-3">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-lime-500 to-green-500 shadow-lg shadow-lime-500/30">
                                    </div>
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 shadow-lg shadow-emerald-500/30">
                                    </div>
                                </div>
                                <div class="font-bold text-sm text-slate-700 dark:text-slate-200">Lime</div>
                                <div class="text-xs text-slate-400">Fresh & Natural</div>
                            </div>
                            <!-- Blue Theme -->
                            <div class="theme-option cursor-pointer p-4 rounded-xl border-2 border-transparent bg-white dark:bg-slate-800 hover:shadow-lg transition-all group"
                                data-theme="blue">
                                <div class="flex gap-2 mb-3">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 shadow-lg shadow-blue-500/30">
                                    </div>
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 shadow-lg shadow-cyan-500/30">
                                    </div>
                                </div>
                                <div class="font-bold text-sm text-slate-700 dark:text-slate-200">Blue</div>
                                <div class="text-xs text-slate-400">Classic & Trusted</div>
                            </div>
                            <!-- Coral Theme -->
                            <div class="theme-option cursor-pointer p-4 rounded-xl border-2 border-transparent bg-white dark:bg-slate-800 hover:shadow-lg transition-all group"
                                data-theme="coral">
                                <div class="flex gap-2 mb-3">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-red-400 to-orange-500 shadow-lg shadow-red-500/30">
                                    </div>
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-pink-400 to-red-400 shadow-lg shadow-pink-500/30">
                                    </div>
                                </div>
                                <div class="font-bold text-sm text-slate-700 dark:text-slate-200">Coral</div>
                                <div class="text-xs text-slate-400">Playful & Fun</div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Management Section -->
                    <div class="glass-panel p-6 rounded-2xl border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center gap-3 mb-6">
                            <div
                                class="w-10 h-10 rounded-xl bg-gradient-to-br from-slate-600 to-slate-800 flex items-center justify-center text-white text-lg">
                                ğŸ’¾</div>
                            <div>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white">Data Management</h3>
                                <p class="text-sm text-slate-500 dark:text-slate-400">Backup, restore, or reset your
                                    data</p>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-3">
                            <button id="settExportAll"
                                class="flex items-center gap-2 px-5 py-2.5 bg-slate-100 dark:bg-slate-800 rounded-xl text-sm font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-all hover:shadow-md">
                                <span>ğŸ“¤</span> Export All Data
                            </button>
                            <button id="settImport"
                                class="flex items-center gap-2 px-5 py-2.5 bg-slate-100 dark:bg-slate-800 rounded-xl text-sm font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-all hover:shadow-md">
                                <span>ğŸ“¥</span> Import Data
                            </button>
                            <button id="settClear"
                                class="flex items-center gap-2 px-5 py-2.5 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-xl text-sm font-medium hover:bg-red-100 dark:hover:bg-red-900/40 transition-all hover:shadow-md">
                                <span>ğŸ—‘ï¸</span> Reset Everything
                            </button>
                        </div>
                    </div>

                    <!-- About Section -->
                    <div class="glass-panel p-6 rounded-2xl border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center gap-3 mb-4">
                            <div
                                class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-indigo-600 flex items-center justify-center text-white text-lg">
                                âš¡</div>
                            <div>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white">Super Combinator v12
                                    Pro
                                </h3>
                                <p class="text-sm text-slate-500 dark:text-slate-400">Domain name generation made
                                    easy
                                </p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-500 dark:text-slate-400">Build powerful domain name
                            combinations
                            with keyword packs, multipliers, and smart generation tools.</p>
                    </div>
                </div>
            </div> <!-- End mainScroll -->
    </main>

    <!-- HIDDEN INPUTS -->
    <input type="file" class="hidden" id="fileImport" accept=".json">
    <input type="file" class="hidden" id="csvImport" accept=".csv,.txt">

    <!-- MODALS -->
    <!-- Clear Modal -->
    <div id="modal-clear"
        class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm opacity-0 transition-opacity duration-200 flex">
        <div
            class="bg-white dark:bg-slate-800 rounded-2xl p-6 w-full max-w-sm shadow-2xl scale-95 transition-transform">
            <h3 class="text-xl font-bold mb-2 text-slate-900 dark:text-white">Clear Inputs?</h3>
            <p class="text-slate-500 text-sm mb-6">This will reset main keyword and bulk list.</p>
            <label
                class="flex items-center gap-3 mb-6 p-3 rounded-xl border border-slate-200 dark:border-slate-700 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                <input type="checkbox" id="clear-res-check" class="w-5 h-5 text-brand-600 rounded focus:ring-brand-500"
                    checked>
                <span class="text-sm font-medium">Clear generated results too</span>
            </label>
            <div class="flex gap-3">
                <button onclick="closeModal('modal-clear')"
                    class="flex-1 py-2.5 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-700 transition-colors">Cancel</button>
                <button id="confirmClearBtn"
                    class="flex-1 py-2.5 rounded-xl text-sm font-bold text-white bg-red-600 hover:bg-red-700 shadow-lg shadow-red-500/30 transition-colors">Clear</button>
            </div>
        </div>
    </div>

    <!-- Edit Pack Modal -->
    <div id="editModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-2xl shadow-2xl flex flex-col max-h-[85vh]">
            <div class="p-5 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 class="text-lg font-bold" id="editTitle">Edit Pack</h3>
                <button
                    class="w-8 h-8 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center"
                    data-close="editModal">Ã—</button>
            </div>
            <div class="p-5 overflow-y-auto flex-1 space-y-4">
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-1">Name</label>
                    <input type="text" id="editName"
                        class="w-full bg-slate-50 dark:bg-slate-700 border-none rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-1">Type</label>
                    <div class="flex bg-slate-100 dark:bg-slate-700 p-1 rounded-lg" id="editTypeGrp">
                        <button
                            class="tog flex-1 py-1.5 text-xs font-bold rounded shadow-sm bg-white dark:bg-slate-600 text-brand-600 on"
                            data-v="multiplier">Multiplier</button>
                        <button class="tog flex-1 py-1.5 text-xs font-medium rounded text-slate-500"
                            data-v="keyword">Keyword</button>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2 pt-2">
                    <button
                        class="px-3 py-1.5 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-lg text-xs font-medium"
                        id="edAddWord">+ Add</button>
                    <button
                        class="px-3 py-1.5 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-lg text-xs font-medium"
                        id="edBulkAdd">Bulk Add</button>
                    <button
                        class="px-3 py-1.5 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-lg text-xs font-medium"
                        id="edDedup">Dedupe</button>
                    <button
                        class="px-3 py-1.5 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-lg text-xs font-medium"
                        id="edSort">Sort</button>
                </div>
                <div id="edWords" class="grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-60 overflow-y-auto"></div>
            </div>
            <div class="p-5 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3">
                <button class="px-4 py-2 rounded-lg text-sm font-medium hover:bg-slate-100 dark:hover:bg-slate-700"
                    data-close="editModal">Cancel</button>
                <button class="px-4 py-2 rounded-lg text-sm font-bold bg-brand-600 text-white hover:bg-brand-700"
                    id="edSave">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Bulk Add Modal -->
    <div id="bulkModal" class="fixed inset-0 z-[110] hidden items-center justify-center bg-black/60 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-lg p-6 shadow-2xl">
            <h3 class="font-bold mb-4">Bulk Add Words</h3>
            <textarea id="bulkInput"
                class="w-full h-48 bg-slate-50 dark:bg-slate-900 rounded-xl p-3 text-sm font-mono mb-4 resize-none"
                placeholder="Paste words..."></textarea>
            <div class="flex justify-end gap-3">
                <button class="px-4 py-2 rounded-lg text-sm hover:bg-slate-100 dark:hover:bg-slate-700"
                    data-close="bulkModal">Cancel</button>
                <button class="px-4 py-2 rounded-lg text-sm font-bold bg-brand-600 text-white" id="bulkConfirm">Add
                    Words</button>
            </div>
        </div>
    </div>

    <!-- Multiplier/Category Picker Modals (Reused structure) -->
    <div id="multModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-xl h-[80vh] flex flex-col shadow-2xl">
            <div class="p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 class="font-bold">Choose Multiplier</h3>
                <button class="w-8 h-8 rounded-full hover:bg-slate-100" data-close="multModal">Ã—</button>
            </div>
            <div class="p-4"><input id="multSearch"
                    class="w-full bg-slate-50 dark:bg-slate-900 border-none rounded-lg px-4 py-2"
                    placeholder="Search..."></div>
            <div id="multList" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
        </div>
    </div>

    <div id="catModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-3xl h-[80vh] flex flex-col shadow-2xl">
            <div class="p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 class="font-bold">Insert Pack</h3>
                <button class="w-8 h-8 rounded-full hover:bg-slate-100" data-close="catModal">Ã—</button>
            </div>
            <div class="p-4 flex gap-4">
                <div class="flex bg-slate-100 dark:bg-slate-700 p-1 rounded-lg w-40 shrink-0" id="insertModeGrp">
                    <button class="tog flex-1 text-xs font-bold py-1.5 rounded bg-white dark:bg-slate-600 shadow-sm on"
                        data-v="append">Append</button>
                    <button class="tog flex-1 text-xs font-medium py-1.5 rounded text-slate-500"
                        data-v="replace">Replace</button>
                </div>
                <input id="catSearch" class="flex-1 bg-slate-50 dark:bg-slate-900 border-none rounded-lg px-4 py-2"
                    placeholder="Search packs...">
            </div>
            <div id="catGrid" class="flex-1 overflow-y-auto p-4 grid grid-cols-2 gap-4"></div>
        </div>
    </div>

    <!-- WINNER EDIT MODAL -->
    <div id="winnerModal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4">
        <div
            class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-md border border-slate-200 dark:border-slate-700">
            <div class="flex items-center justify-between p-5 border-b border-slate-100 dark:border-slate-800">
                <h3 id="winnerModalTitle" class="font-bold text-lg text-slate-900 dark:text-white">Add Domain</h3>
                <button class="w-8 h-8 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-xl"
                    data-close="winnerModal">Ã—</button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Domain *</label>
                    <input type="text" id="winDomain"
                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none"
                        placeholder="example.com">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label
                            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Category</label>
                        <input type="text" id="winCategory"
                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none"
                            placeholder="AI, Crypto, etc.">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Status</label>
                        <select id="winStatus"
                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none">
                            <option value="Want">Want to Buy</option>
                            <option value="Watching">Watching</option>
                            <option value="Owned">Owned</option>
                            <option value="Sold">Sold</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Price</label>
                    <input type="text" id="winPrice"
                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none"
                        placeholder="$100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Notes</label>
                    <textarea id="winNotes" rows="3"
                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-accent-500 outline-none resize-none"
                        placeholder="Any notes about this domain..."></textarea>
                </div>
            </div>
            <div class="p-5 border-t border-slate-100 dark:border-slate-800 flex gap-3 justify-end">
                <button id="winnerCancelBtn"
                    class="px-4 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Cancel</button>
                <button id="winnerSaveBtn"
                    class="px-6 py-2 rounded-lg text-sm font-bold bg-accent-500 hover:bg-accent-600 text-white dark:bg-accent-400 dark:text-slate-900 dark:hover:bg-accent-500 transition-colors shadow-sm">Save</button>
            </div>
        </div>
    </div>

    <!-- PRESET MANAGER MODAL -->
    <div id="presetManagerModal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
        <div
            class="bg-white dark:bg-slate-900 rounded-2xl w-full max-w-3xl shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-700 max-h-[90vh] flex flex-col">
            <!-- Header -->
            <div class="p-5 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between shrink-0">
                <h2 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                    ğŸ“‹ Preset Manager
                </h2>
                <button id="presetManagerClose"
                    class="w-8 h-8 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center text-slate-400 hover:text-slate-600 transition-colors">Ã—</button>
            </div>

            <!-- Top Controls -->
            <div class="p-4 border-b border-slate-100 dark:border-slate-800 flex flex-wrap gap-2 shrink-0">
                <button id="presetNewBtn"
                    class="px-4 py-2 rounded-lg text-sm font-semibold bg-purple-500 hover:bg-purple-600 text-white transition-colors flex items-center gap-1">
                    â• New Preset
                </button>
                <button id="presetImportBtn"
                    class="px-3 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors flex items-center gap-1">
                    ğŸ“¥ Import
                </button>
                <button id="presetExportBtn"
                    class="px-3 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors flex items-center gap-1">
                    ğŸ“¤ Export
                </button>
                <button id="presetResetBtn"
                    class="px-3 py-2 rounded-lg text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors flex items-center gap-1">
                    ğŸ”„ Reset Defaults
                </button>
                <div class="flex-1"></div>
                <input type="text" id="presetSearchInput"
                    class="w-48 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none"
                    placeholder="ğŸ” Search presets...">
            </div>

            <!-- List View -->
            <div class="p-4 overflow-y-auto flex-1">
                <div id="presetListContainer" class="space-y-2">
                    <!-- Preset items rendered here -->
                </div>
                <div id="presetEmptyState" class="hidden text-center py-12 text-slate-400">
                    <div class="text-5xl mb-3">ğŸ“‹</div>
                    <p class="text-sm">No presets found. Create one to get started!</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="p-4 border-t border-slate-100 dark:border-slate-800 flex justify-end shrink-0">
                <button id="presetManagerDoneBtn"
                    class="px-6 py-2.5 rounded-lg text-sm font-bold bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300 transition-colors">Done</button>
            </div>
        </div>
    </div>
    <input type="file" id="presetImportInput" accept=".json" class="hidden">

    <!-- PRESET EDITOR MODAL -->
    <div id="presetEditorModal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[110] hidden items-center justify-center p-4">
        <div
            class="bg-white dark:bg-slate-900 rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-700 max-h-[90vh] flex flex-col">
            <!-- Header -->
            <div class="p-5 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between shrink-0">
                <h2 id="presetEditorTitle"
                    class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                    âœï¸ Edit Preset
                </h2>
                <button id="presetEditorClose"
                    class="w-8 h-8 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center text-slate-400 hover:text-slate-600 transition-colors">Ã—</button>
            </div>

            <!-- Editor Form -->
            <div class="p-5 space-y-5 overflow-y-auto flex-1">
                <!-- Name & Description -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Name <span
                                class="text-red-500">*</span></label>
                        <input type="text" id="editorPresetName"
                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none"
                            placeholder="e.g., Fintech Domains">
                    </div>
                    <div>
                        <label
                            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Description</label>
                        <input type="text" id="editorPresetDesc"
                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none"
                            placeholder="Short description...">
                    </div>
                </div>

                <!-- Templates -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Templates</label>
                    <div class="flex flex-wrap gap-2">
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorTplAB" class="accent-purple-500"> <span
                                class="text-sm">A+B</span>
                        </label>
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorTplBA" class="accent-purple-500"> <span
                                class="text-sm">B+A</span>
                        </label>
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorTplABC" class="accent-purple-500"> <span
                                class="text-sm">A+B+C</span>
                        </label>
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorTplPrefixAB" class="accent-purple-500"> <span
                                class="text-sm">prefix+A+B</span>
                        </label>
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorTplABSuffix" class="accent-purple-500"> <span
                                class="text-sm">A+B+suffix</span>
                        </label>
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorTplPrefixABSuffix" class="accent-purple-500"> <span
                                class="text-sm">prefix+A+B+suffix</span>
                        </label>
                    </div>
                </div>

                <!-- Constraints -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Constraints</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorNoHyphens" class="accent-purple-500" checked> <span
                                class="text-sm">No hyphens</span>
                        </label>
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorNoNumbers" class="accent-purple-500" checked> <span
                                class="text-sm">No numbers</span>
                        </label>
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorDedupe" class="accent-purple-500" checked> <span
                                class="text-sm">Dedupe</span>
                        </label>
                        <label
                            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                            <input type="checkbox" id="editorAvoidUgly" class="accent-purple-500" checked> <span
                                class="text-sm">Avoid ugly</span>
                        </label>
                    </div>
                    <div class="flex items-center gap-3">
                        <label class="text-sm text-slate-600 dark:text-slate-400">Max length:</label>
                        <input type="range" id="editorMaxLen" min="6" max="16" value="12"
                            class="flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
                        <span id="editorMaxLenValue"
                            class="text-sm font-bold text-purple-600 dark:text-purple-400 w-8 text-center">12</span>
                    </div>
                </div>

                <!-- Weights -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Weights (must sum to
                            10)</label>
                        <span id="weightsSumIndicator"
                            class="text-xs font-semibold px-2 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400">Sum:
                            10.0</span>
                    </div>
                    <div class="space-y-3 bg-slate-50 dark:bg-slate-800 p-4 rounded-lg">
                        <div class="flex items-center gap-3">
                            <label class="text-sm text-slate-600 dark:text-slate-400 w-28">Brandability</label>
                            <input type="range" id="editorWBrand" min="0" max="10" step="0.5" value="3.5"
                                data-weight-idx="0"
                                class="flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 weight-slider">
                            <span
                                class="text-sm font-bold text-purple-600 dark:text-purple-400 w-8 text-center weight-val">3.5</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <label class="text-sm text-slate-600 dark:text-slate-400 w-28">Pronunciation</label>
                            <input type="range" id="editorWPronun" min="0" max="10" step="0.5" value="2.0"
                                data-weight-idx="1"
                                class="flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 weight-slider">
                            <span
                                class="text-sm font-bold text-purple-600 dark:text-purple-400 w-8 text-center weight-val">2.0</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <label class="text-sm text-slate-600 dark:text-slate-400 w-28">Spelling</label>
                            <input type="range" id="editorWSpell" min="0" max="10" step="0.5" value="1.5"
                                data-weight-idx="2"
                                class="flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 weight-slider">
                            <span
                                class="text-sm font-bold text-purple-600 dark:text-purple-400 w-8 text-center weight-val">1.5</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <label class="text-sm text-slate-600 dark:text-slate-400 w-28">Native Meaning</label>
                            <input type="range" id="editorWMeaning" min="0" max="10" step="0.5" value="1.0"
                                data-weight-idx="3"
                                class="flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 weight-slider">
                            <span
                                class="text-sm font-bold text-purple-600 dark:text-purple-400 w-8 text-center weight-val">1.0</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <label class="text-sm text-slate-600 dark:text-slate-400 w-28">Buyer Intent</label>
                            <input type="range" id="editorWIntent" min="0" max="10" step="0.5" value="2.0"
                                data-weight-idx="4"
                                class="flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500 weight-slider">
                            <span
                                class="text-sm font-bold text-purple-600 dark:text-purple-400 w-8 text-center weight-val">2.0</span>
                        </div>
                    </div>
                </div>

                <!-- Banned / Prefixes / Suffixes -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Banned
                            Substrings</label>
                        <textarea id="editorBanned" rows="3"
                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none"
                            placeholder="One per line..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Recommended
                            Prefixes</label>
                        <textarea id="editorPrefixes" rows="3"
                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none"
                            placeholder="Comma or newline..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Recommended
                            Suffixes</label>
                        <textarea id="editorSuffixes" rows="3"
                            class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none"
                            placeholder="Comma or newline..."></textarea>
                    </div>
                </div>

                <!-- Notes -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Notes</label>
                    <textarea id="editorNotes" rows="2"
                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none resize-none"
                        placeholder="Optional notes..."></textarea>
                </div>
            </div>

            <!-- Footer -->
            <div class="p-4 border-t border-slate-100 dark:border-slate-800 flex gap-3 justify-end shrink-0">
                <button id="presetEditorCancelBtn"
                    class="px-4 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Cancel</button>
                <button id="presetEditorSaveBtn"
                    class="px-5 py-2 rounded-lg text-sm font-bold bg-purple-500 hover:bg-purple-600 text-white transition-colors">Save</button>
                <button id="presetEditorSaveApplyBtn"
                    class="px-5 py-2 rounded-lg text-sm font-bold bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white transition-colors">Save
                    & Apply</button>
            </div>
        </div>
    </div>

    <!-- QUICK SAVE PRESET MODAL (for Save Current as Preset) -->
    <div id="quickSavePresetModal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
        <div
            class="bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-700">
            <div class="p-5 border-b border-slate-100 dark:border-slate-800">
                <h2 class="text-lg font-bold text-slate-900 dark:text-white">ğŸ’¾ Save Current Settings as Preset</h2>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Preset Name <span
                            class="text-red-500">*</span></label>
                    <input type="text" id="quickSavePresetName"
                        class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-purple-500 outline-none"
                        placeholder="e.g., Fintech Domains">
                </div>
                <div class="text-xs text-slate-500 bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
                    <strong>Will save:</strong> Templates, constraints, weights, prefixes/suffixes, banned substrings
                    from current Automation settings
                </div>
            </div>
            <div class="p-5 border-t border-slate-100 dark:border-slate-800 flex gap-3 justify-end">
                <button id="quickSavePresetCancelBtn"
                    class="px-4 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Cancel</button>
                <button id="quickSavePresetConfirmBtn"
                    class="px-6 py-2 rounded-lg text-sm font-bold bg-purple-500 hover:bg-purple-600 text-white transition-colors">Save
                    Preset</button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast"
        class="fixed top-6 right-6 z-[200] bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-5 py-3 rounded-xl shadow-2xl font-semibold text-sm flex items-center gap-3 toast">
        <div class="toast-icon">âœ“</div>
        <div class="toast-msg">Action successful</div>
    </div>


    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js">
        function initIdentity() {
            if (!window.netlifyIdentity) {
                console.error("Netlify Identity widget not loaded. Check the script tag.");
                return;
            }

            window.netlifyIdentity.on("init", user => {
                // TODO: call your existing UI update function here
                // updateUI(user);
            });

            window.netlifyIdentity.on("login", user => {
                window.netlifyIdentity.close();
                // updateUI(user);
            });

            window.netlifyIdentity.on("logout", () => {
                // updateUI(null);
            });

            window.netlifyIdentity.init();
        }

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initIdentity);
        } else {
            initIdentity();
        }

    </script>




    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const S = {
            packs: [],
            favorites: [],
            winners: [],
            domains: [], // Generated results
            editing: null,
            editWords: [],
            insertMode: 'append',
            position: 'prefix',
            insertedPacks: [],
            multiplierPackId: null,
            // AI Scoring State
            aiScores: {},           // {domain: {score, bucket, reason, use_case}}
            aiScoreFilter: 'actionable', // 'all' | 'actionable' | 'top50' | 'top100'
            aiScoring: false,       // Is scoring in progress?
            aiScoredDomains: []     // Sorted list of scored domains
        };

        const DEFAULTS = [
            { id: 1, name: 'Evergreen Multipliers', type: 'multiplier', words: ['trust', 'secure', 'verify', 'identity', 'risk', 'audit', 'compliance', 'policy', 'protect', 'access', 'control', 'monitor', 'detect', 'guard', 'shield', 'validated', 'certified', 'reliable', 'quality', 'expert'] },
            { id: 2, name: 'Finance & Fintech', type: 'multiplier', words: ['yield', 'pricing', 'portfolio', 'cashflow', 'revenue', 'margin', 'profit', 'alpha', 'beta', 'liquidity', 'credit', 'loan', 'treasury', 'hedge', 'settlement', 'ledger', 'invoice', 'payroll', 'tax', 'insurance'] },
            { id: 3, name: 'AI Wave', type: 'multiplier', words: ['agent', 'neural', 'synthetic', 'copilot', 'assistant', 'rag', 'vector', 'embedding', 'eval', 'guardrails', 'orchestrator'] },
            { id: 4, name: 'Business Ops', type: 'keyword', words: ['billing', 'payments', 'invoice', 'subscription', 'checkout', 'wallet', 'pricing', 'refund', 'payroll', 'compliance', 'audit', 'risk', 'kyc', 'fraud', 'analytics', 'workflow', 'contract', 'governance', 'crm'] },
            { id: 5, name: 'DevOps & Cloud', type: 'keyword', words: ['deploy', 'pipeline', 'workflow', 'logs', 'trace', 'sre', 'platform', 'auto', 'cluster', 'serverless', 'api', 'gateway', 'edge', 'runtime', 'infra', 'gitops', 'finops'] },
            { id: 6, name: 'SaaS Suffixes', type: 'multiplier', words: ['hq', 'io', 'app', 'sys', 'ops', 'lab', 'base', 'hub', 'flow', 'kit', 'box', 'bot', 'mate', 'pro', 'go', 'up', 'now', 'net', 'web', 'zone'] }
        ];

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function init() {
            loadData();
            wireEvents();
            refreshAll();

            // Shortcuts
            document.addEventListener('keydown', e => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); $('gSearch').focus(); }
                if (e.key === 'Escape') {
                    if (!$('#modal-clear').classList.contains('hidden')) closeModal('modal-clear');
                    else if (document.activeElement.tagName === 'INPUT') document.activeElement.blur();
                }
            });

            // Theme check - apply stored or default theme
            const storedTheme = localStorage.getItem('dg_theme') || 'purple';
            const storedMode = localStorage.getItem('dg_mode') || 'light';
            setTheme(storedTheme, true); // silent on init
            setMode(storedMode);
        }

        function loadData() {
            S.packs = JSON.parse(localStorage.getItem('dg_packs') || JSON.stringify(DEFAULTS));
            S.favorites = JSON.parse(localStorage.getItem('dg_favs') || '[]');
            S.winners = JSON.parse(localStorage.getItem('dg_winners') || '[]');
            if (S.packs.length === 0) S.packs = JSON.parse(JSON.stringify(DEFAULTS)); // Restore if empty
        }

        function save() {
            localStorage.setItem('dg_packs', JSON.stringify(S.packs));
            localStorage.setItem('dg_favs', JSON.stringify(S.favorites));
            localStorage.setItem('dg_winners', JSON.stringify(S.winners));
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WIRING & EVENTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function wireEvents() {
            // Navigation
            $$('.nav-item[data-pg]').forEach(el => el.onclick = () => {
                $$('.nav-item').forEach(n => n.classList.remove('active', 'bg-brand-50', 'dark:bg-brand-900/20', 'text-brand-600', 'dark:text-brand-400'));
                el.classList.add('active', 'bg-brand-50', 'dark:bg-brand-900/20', 'text-brand-600', 'dark:text-brand-400');
                showPage(el.dataset.pg);
                if (window.innerWidth <= 768) $('sidebar').classList.add('-translate-x-full');
            });

            // Mobile Menu
            $('mobMenu').onclick = () => $('sidebar').classList.toggle('-translate-x-full');

            // Theme Toggle
            $('darkToggle').onclick = () => setMode(document.body.dataset.mode === 'dark' ? 'light' : 'dark');

            // Global Search
            $('gSearch').oninput = e => globalSearch(e.target.value);
            $('gSearch').onblur = () => setTimeout(() => $('gSearchDrop').classList.add('hidden'), 200);

            // Generator
            $('clearInputsBtn').onclick = () => openModal('modal-clear');
            $('confirmClearBtn').onclick = clearInputs;
            $('genBtn').onclick = generate;

            // Toggles
            wireToggle('posGroup', v => S.position = v);
            wireToggle('insertModeGrp', v => S.insertMode = v);
            wireToggle('editTypeGrp');

            // Modals
            $$('[data-close]').forEach(b => b.onclick = () => closeModal(b.dataset.close));

            // Pack Editor
            $('hdrNewPack').onclick = () => openEditor(null);
            $('newPackBtn2').onclick = () => openEditor(null);
            $('edAddWord').onclick = addWordToEditor;
            $('edSave').onclick = saveEditor;
            $('edDedup').onclick = () => { S.editWords = [...new Set(S.editWords)]; renderEditorWords(); toast('Deduplicated'); };
            $('edSort').onclick = () => { S.editWords.sort(); renderEditorWords(); toast('Sorted'); };
            $('edBulkAdd').onclick = () => openModal('bulkModal');
            $('bulkConfirm').onclick = bulkAddToEditor;

            // Bulk Keywords Area
            $('dedupBtn').onclick = () => { processBulk(w => [...new Set(w)]); toast('Deduplicated'); };
            $('sortKwBtn').onclick = () => { processBulk(w => w.sort()); toast('Sorted'); };
            $('cleanBtn').onclick = () => { processBulk(w => w.filter(x => x.length > 1)); toast('Cleaned'); };
            $('removeNumsKwBtn').onclick = () => { processBulk(w => w.map(x => x.replace(/\d/g, '')).filter(x => x)); toast('Numbers removed'); };
            $('insertPackBtn').onclick = () => { renderCatPicker(); openModal('catModal'); };
            $('pickMultBtn').onclick = () => { renderMultPicker(); openModal('multModal'); };

            // Results
            $('copyAllBtn').onclick = () => { navigator.clipboard.writeText(S.domains.join('\n')); toast('Copied all'); };
            $('exportResBtn').onclick = () => downloadCSV(S.domains.map(d => [d]), 'domains.csv');
            $('sortResAlpha').onclick = () => { S.domains.sort(); renderResults(); toast('Sorted A-Z'); };
            $('sortResLen').onclick = () => { S.domains.sort((a, b) => a.length - b.length); renderResults(); toast('Sorted by Length'); };

            // Winners - Enhanced
            $('addWinnerBtn').onclick = () => openWinnerModal();
            $('winnerSaveBtn').onclick = saveWinner;
            $('winnerCancelBtn').onclick = closeWinnerModal;
            $('winSearch').oninput = renderWinners;
            $('exportWinDropBtn').onclick = () => $('exportWinDrop').classList.toggle('hidden');

            // Winner modal close button
            $$('[data-close="winnerModal"]').forEach(btn => btn.onclick = closeWinnerModal);

            // Status filter buttons
            $$('#winStatusFilters .status-filter').forEach(btn => {
                btn.onclick = () => {
                    $$('#winStatusFilters .status-filter').forEach(b => {
                        b.classList.remove('active', 'bg-slate-900', 'text-white', 'dark:bg-white', 'dark:text-slate-900');
                        b.classList.add('bg-slate-100', 'text-slate-600', 'dark:bg-slate-800', 'dark:text-slate-400');
                    });
                    btn.classList.add('active', 'bg-slate-900', 'text-white', 'dark:bg-white', 'dark:text-slate-900');
                    btn.classList.remove('bg-slate-100', 'text-slate-600', 'dark:bg-slate-800', 'dark:text-slate-400');
                    winnerStatusFilter = btn.dataset.status;
                    renderWinners();
                };
            });

            // Close export dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#exportWinDropBtn') && !e.target.closest('#exportWinDrop')) {
                    $('exportWinDrop')?.classList.add('hidden');
                }
            });

            // Packs
            $('packSearch').oninput = renderPacks;
            $('importPackBtn').onclick = () => $('fileImport').click();
            $('exportPacksBtn').onclick = exportAllPacks;
            $('fileImport').onchange = importPacks;
            $('csvDropZone').onclick = () => $('csvImport').click();
            $('csvImport').onchange = importCSV;

            // Library
            $('libSearch').oninput = renderLibrary;

            // AI Scoring
            $('aiScoreBtn').onclick = scoreWithAI;
            $('showAllBtn').onclick = () => { setAIFilter('all'); renderScoredResults(); };
            $('showActionableBtn').onclick = () => { setAIFilter('actionable'); renderScoredResults(); };
            $('showTop50Btn').onclick = () => { setAIFilter('top50'); renderScoredResults(); };
            $('showTop100Btn').onclick = () => { setAIFilter('top100'); renderScoredResults(); };
            $('exportScoredBtn').onclick = exportScoredCSV;

            // Settings
            $('settClear').onclick = () => { if (confirm('Reset ALL data?')) { localStorage.clear(); location.reload(); } };
            $$('.theme-option').forEach(el => el.onclick = () => setTheme(el.dataset.theme));

            // Global: Close modals when clicking backdrop (outside content)
            const modalIds = ['editModal', 'bulkModal', 'multModal', 'catModal', 'modal-clear', 'winnerModal', 'presetManagerModal', 'presetEditorModal', 'quickSavePresetModal'];
            modalIds.forEach(id => {
                const modal = $(id);
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        // Only close if clicking directly on the backdrop, not the content
                        if (e.target === modal) {
                            e.stopPropagation();
                            if (id === 'winnerModal') {
                                closeWinnerModal();
                            } else if (id === 'presetManagerModal') {
                                closePresetManager();
                            } else if (id === 'presetEditorModal') {
                                closePresetEditor();
                            } else if (id === 'quickSavePresetModal') {
                                closeQuickSaveModal();
                            } else {
                                closeModal(id);
                            }
                        }
                    });

                    // Prevent clicks on modal content from closing the modal
                    const modalContent = modal.querySelector('.bg-white, .bg-slate-50, [class*="bg-slate-800"]');
                    if (modalContent) {
                        modalContent.addEventListener('click', (e) => {
                            e.stopPropagation();
                        });
                    }
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UI LOGIC
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function $(id) { return document.getElementById(id); }
        function $$(sel) { return document.querySelectorAll(sel); }

        function showPage(id) {
            $$('.page').forEach(p => p.classList.remove('active'));
            $('pg-' + id).classList.add('active');
            if (id === 'winners') renderWinners();
            if (id === 'packs') renderPacks();
            if (id === 'library') renderLibrary();
            if (id === 'favorites') renderFavorites();
        }

        function openModal(id) {
            const m = $(id);
            m.classList.remove('hidden');
            m.classList.add('flex');
            setTimeout(() => m.classList.remove('opacity-0'), 10);
            if (id === 'modal-clear') m.querySelector('div').classList.remove('scale-95');
        }

        function closeModal(id) {
            const m = $(id);
            m.classList.add('opacity-0');
            if (id === 'modal-clear') m.querySelector('div').classList.add('scale-95');
            setTimeout(() => { m.classList.add('hidden'); m.classList.remove('flex'); }, 200);
        }

        function toast(msg, type = 'ok') {
            const t = $('toast');
            t.querySelector('.toast-msg').innerText = msg;
            t.className = `toast show fixed top-6 right-6 z-[200] px-5 py-3 rounded-xl shadow-2xl font-semibold text-sm flex items-center gap-3 ${type === 'err' ? 'bg-red-500 text-white' : 'bg-slate-900 dark:bg-white text-white dark:text-slate-900'}`;
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function wireToggle(grpId, cb) {
            const grp = $(grpId);
            if (!grp) return;
            grp.querySelectorAll('.tog').forEach(btn => {
                btn.onclick = () => {
                    grp.querySelectorAll('.tog').forEach(b => {
                        b.classList.remove('on', 'bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-brand-600', 'dark:text-brand-300');
                        b.classList.add('text-slate-500', 'dark:text-slate-400');
                    });
                    btn.classList.add('on', 'bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-brand-600', 'dark:text-brand-300');
                    btn.classList.remove('text-slate-500', 'dark:text-slate-400');
                    if (cb) cb(btn.dataset.v);
                };
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GENERATOR FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function clearInputs() {
            $('mainKw').value = '';
            $('bulkKw').value = '';
            $('insertedList').innerHTML = '';
            updateStats();
            if ($('clear-res-check').checked) {
                S.domains = [];
                renderResults();
            }
            closeModal('modal-clear');
            toast('Inputs cleared');
        }

        function generate() {
            const anchor = $('mainKw').value.trim().toLowerCase();
            const bulk = $('bulkKw').value.trim();
            if (!anchor && !bulk) { toast('Please enter keywords', 'err'); return; }

            // Loading State
            const btnText = $('genBtnText');
            const spinner = $('genSpinner');
            btnText.innerText = 'Generating...';
            spinner.classList.remove('hidden');

            setTimeout(() => {
                const words = bulk.split(/[\n,]+/).map(s => s.trim().toLowerCase().replace(/[^a-z0-9-]/g, '')).filter(s => s);
                if (words.length === 0 && anchor) words.push(''); // Generate with just anchor

                const exts = Array.from($$('#extChips .chip.on')).map(c => c.dataset.ext);
                const results = [];

                words.forEach(w => {
                    if (!w && !anchor) return;
                    let base = S.position === 'prefix' ? anchor + w : w + anchor;
                    exts.forEach(ext => {
                        if (base) results.push(base + ext);
                    });
                });

                // Remove hyphens from all domains
                S.domains = [...new Set(results.map(d => d.replace(/-/g, '')))];

                // Initialize Availability State if enabled
                S.genStates = {};
                const checkEnabled = $('genCheckEnabled') && $('genCheckEnabled').checked;

                if (checkEnabled) {
                    S.domains.forEach(d => {
                        S.genStates[d] = { status: 'pending', price: null };
                    });
                }

                renderResults();

                btnText.innerText = 'âœ¨ Generate Results';
                spinner.classList.add('hidden');
                toast(`Generated ${results.length} domains`);

                if (checkEnabled && S.domains.length > 0) {
                    startGenAvailabilityCheck();
                }
            }, 400);
        }

        function renderResults() {
            const grid = $('resContainer');
            $('resCount').innerText = `(${S.domains.length})`;

            if (S.domains.length === 0) {
                grid.innerHTML = `<div class="empty flex flex-col items-center justify-center h-full text-slate-400">
            <div class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mb-4 text-2xl">ğŸ¯</div>
            <h3 class="text-lg font-bold text-slate-700 dark:text-slate-300">Ready to Generate</h3>
            <p class="text-sm mt-1">Configure your keywords and click the button.</p>
        </div>`;
                return;
            }

            grid.innerHTML = `<div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-3 pb-8">` +
                S.domains.slice(0, 500).map(d => {
                    const isWin = S.winners.some(w => w.d === d);
                    const state = S.genStates ? S.genStates[d] : null;

                    let statusClass = 'border-slate-200 dark:border-slate-700';
                    let statusIcon = '';
                    let priceHtml = '';

                    if (state) {
                        if (state.status === 'available') {
                            statusClass = 'border-green-500 bg-green-50 dark:bg-green-900/20';
                            statusIcon = '<span class="text-green-600 dark:text-green-400 text-xs font-bold">AVAIL</span>';
                            if (state.price) priceHtml = `<span class="text-xs font-bold text-slate-600 dark:text-slate-300">$${state.price}</span>`;
                        } else if (state.status === 'taken') {
                            statusClass = 'opacity-60 bg-slate-100 dark:bg-slate-800 border-slate-200';
                            statusIcon = '<span class="text-slate-400 text-xs">TAKEN</span>';
                        } else if (state.status === 'checking') {
                            statusClass = 'border-purple-300 animate-pulse';
                            statusIcon = '<span class="text-purple-500 text-xs">...</span>';
                        } else if (state.status === 'error') {
                            statusClass = 'border-red-200 bg-red-50';
                            statusIcon = '<span class="text-red-500 text-xs">ERR</span>';
                        }
                    }

                    return `
            <div class="group relative bg-white dark:bg-slate-800 border ${statusClass} rounded-xl p-3 hover:shadow-md transition-all hover:border-brand-300 dark:hover:border-brand-700 flex flex-col gap-2 animate-fade-in">
                <div class="flex justify-between items-center">
                    <span class="font-medium text-slate-700 dark:text-slate-200 truncate pr-2 select-all cursor-pointer" onclick="navigator.clipboard.writeText('${d}');toast('Copied')">${d}</span>
                    <button onclick="toggleWinner('${d}')" class="${isWin ? 'text-amber-400' : 'text-slate-300 hover:text-amber-400'} transition-colors p-1" title="Save to Winners">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                    </button>
                </div>
                ${state ? `
                <div class="flex justify-between items-center mt-auto border-t border-slate-100 dark:border-slate-700/50 pt-2">
                    ${statusIcon}
                    ${priceHtml}
                    ${state.buyUrl ? `<a href="${state.buyUrl}" target="_blank" class="text-xs text-blue-500 hover:underline">Buy â†—</a>` : ''}
                </div>` : ''}
            </div>`;
                }).join('') + `</div>`;
        }

        // Generator Availability Check Logic
        async function startGenAvailabilityCheck() {
            if (S.genChecking) return;
            S.genChecking = true;
            S.cancelGenCheck = false;
            S.genCheckedCount = 0;
            S.genAvailableCount = 0;

            const concurrency = 5;
            const targetAvailable = parseInt($('genTargetResults').value) || 50;
            const maxChecks = parseInt($('genMaxChecks').value) || 500;

            // Initial Progress Update
            updateGenProgress();

            const processQueue = async () => {
                if (S.cancelGenCheck || S.genAvailableCount >= targetAvailable || S.genCheckedCount >= maxChecks) {
                    S.genChecking = false;
                    renderResults(); // Final render
                    return;
                }

                // Find next pending
                const pendingDomain = S.domains.find(d => S.genStates[d] && S.genStates[d].status === 'pending');
                if (!pendingDomain) {
                    S.genChecking = false;
                    renderResults();
                    return;
                }

                S.genStates[pendingDomain].status = 'checking';
                // Optional: Render strictly every checking update might be too heavy?
                // Let's rely on batch updates or progress bar for smoother feel
                // renderResults(); 

                try {
                    const res = await checkDomain(pendingDomain);
                    S.genStates[pendingDomain].status = res.available ? 'available' : 'taken';
                    S.genStates[pendingDomain].price = res.price;
                    S.genStates[pendingDomain].premium = res.premium;
                    S.genStates[pendingDomain].buyUrl = res.buyUrl;

                    if (res.available) S.genAvailableCount++;
                } catch (e) {
                    S.genStates[pendingDomain].status = 'error';
                }

                S.genCheckedCount++;
                updateGenProgress();

                // Optimized rendering: every 5 checks
                if (S.genCheckedCount % 5 === 0) renderResults();

                // Next
                processQueue();
            };

            // Start workers
            for (let i = 0; i < concurrency; i++) {
                processQueue();
            }
        }

        function updateGenProgress() {
            const bar = $('genProgressBar');
            const area = $('genProgressArea');
            const txt = $('genProgressText');
            const countAvail = $('genCountAvail');
            const countChecked = $('genCountChecked');

            if (!area) return;

            if (S.genChecking) {
                area.classList.remove('hidden');
                const total = Math.min(S.domains.length, parseInt($('genMaxChecks').value) || 500);
                const pct = Math.round((S.genCheckedCount / total) * 100);
                // Cap at 100% visual
                bar.style.width = `${Math.min(pct, 100)}%`;
                txt.innerText = `${S.genCheckedCount} / ${total}`;
                countAvail.innerText = S.genAvailableCount;
                countChecked.innerText = S.genCheckedCount;
            } else {
                if (S.genCheckedCount > 0) {
                    // Keep showing results if we did something
                    bar.style.width = '100%';
                } else {
                    area.classList.add('hidden');
                }
            }
        }
        const AI_SCORE_ENDPOINT = '/.netlify/functions/score';
        const AI_CHUNK_SIZE = 100; // Domains per request (max 120)

        async function scoreWithAI() {
            if (S.aiScoring) return;
            if (S.domains.length === 0) {
                toast('Generate domains first', 'err');
                return;
            }

            const domains = [...S.domains];
            const preset = $('aiPreset').value;
            const totalDomains = domains.length;

            // Reset state
            S.aiScores = {};
            S.aiScoredDomains = [];
            S.aiScoring = true;
            S.aiScoreFilter = 'actionable';

            // Update UI
            $('aiScoreBtnText').textContent = 'Scoring...';
            $('aiScoreBtnIcon').classList.add('hidden');
            $('aiScoreSpinner').classList.remove('hidden');
            $('aiStatusArea').classList.remove('hidden');
            $('aiErrorMsg').classList.add('hidden');
            updateAIProgress(0, totalDomains);

            // Chunk domains
            const chunks = [];
            for (let i = 0; i < domains.length; i += AI_CHUNK_SIZE) {
                chunks.push(domains.slice(i, i + AI_CHUNK_SIZE));
            }

            let scored = 0;
            let errors = [];

            for (let i = 0; i < chunks.length; i++) {
                try {
                    const result = await scoreChunk(chunks[i], preset);
                    if (result.success && result.scores) {
                        result.scores.forEach(s => {
                            S.aiScores[s.domain] = s;
                        });
                        scored += result.scores.length;
                    } else {
                        errors.push(`Chunk ${i + 1}: ${result.error || 'Unknown error'}`);
                    }
                } catch (err) {
                    errors.push(`Chunk ${i + 1}: ${err.message}`);
                }
                updateAIProgress(scored, totalDomains);
            }

            // Finish up
            S.aiScoring = false;
            $('aiScoreBtnText').textContent = 'Score with AI';
            $('aiScoreBtnIcon').classList.remove('hidden');
            $('aiScoreSpinner').classList.add('hidden');

            if (errors.length > 0) {
                $('aiErrorMsg').textContent = errors.join('; ');
                $('aiErrorMsg').classList.remove('hidden');
            }

            // Sort scored domains by score descending
            S.aiScoredDomains = Object.values(S.aiScores)
                .sort((a, b) => b.score - a.score);

            // Auto-apply actionable filter (hide PASS)
            setAIFilter('actionable');
            renderScoredResults();
            toast(`Scored ${scored} domains with AI`);
        }

        async function scoreChunk(domains, preset) {
            try {
                const response = await fetch(AI_SCORE_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ domains, preset })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }

                return await response.json();
            } catch (err) {
                console.error('Score chunk error:', err);
                return { success: false, error: err.message };
            }
        }

        function updateAIProgress(current, total) {
            const pct = total > 0 ? Math.round((current / total) * 100) : 0;
            $('aiProgressFill').style.width = pct + '%';
            $('aiProgressText').textContent = `${current}/${total}`;
        }

        function setAIFilter(filter) {
            S.aiScoreFilter = filter;
            // Update button styles
            const btns = {
                all: $('showAllBtn'),
                actionable: $('showActionableBtn'),
                top50: $('showTop50Btn'),
                top100: $('showTop100Btn')
            };
            Object.entries(btns).forEach(([key, btn]) => {
                if (key === filter) {
                    btn.classList.add('bg-purple-100', 'dark:bg-purple-900/30', 'text-purple-600', 'dark:text-purple-400', 'font-medium');
                    btn.classList.remove('bg-slate-100', 'dark:bg-slate-800', 'text-slate-500');
                } else {
                    btn.classList.remove('bg-purple-100', 'dark:bg-purple-900/30', 'text-purple-600', 'dark:text-purple-400', 'font-medium');
                    btn.classList.add('bg-slate-100', 'dark:bg-slate-800', 'text-slate-500');
                }
            });
        }

        function renderScoredResults() {
            const grid = $('resContainer');

            if (S.aiScoredDomains.length === 0) {
                // No AI scores yet, use regular renderResults
                renderResults();
                return;
            }

            // Apply filter
            let filtered = [...S.aiScoredDomains];
            switch (S.aiScoreFilter) {
                case 'actionable':
                    filtered = filtered.filter(s => s.bucket !== 'PASS');
                    break;
                case 'top50':
                    filtered = filtered.slice(0, 50);
                    break;
                case 'top100':
                    filtered = filtered.slice(0, 100);
                    break;
            }

            $('resCount').innerText = `(${filtered.length}/${S.aiScoredDomains.length} scored)`;

            if (filtered.length === 0) {
                grid.innerHTML = `<div class="empty flex flex-col items-center justify-center h-full text-slate-400">
                    <div class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mb-4 text-2xl">ğŸ¤–</div>
                    <h3 class="text-lg font-bold text-slate-700 dark:text-slate-300">No Actionable Domains</h3>
                    <p class="text-sm mt-1">All domains were rated as PASS. Try "Show All" to see them.</p>
                </div>`;
                return;
            }

            grid.innerHTML = `<div class="overflow-x-auto"><table class="w-full text-sm">
                <thead class="bg-slate-50 dark:bg-slate-800/50 text-xs font-bold text-slate-500 uppercase sticky top-0">
                    <tr>
                        <th class="px-3 py-2 text-left">Domain</th>
                        <th class="px-3 py-2 text-center w-16">Score</th>
                        <th class="px-3 py-2 text-center w-24">Bucket</th>
                        <th class="px-3 py-2 text-left">Reason</th>
                        <th class="px-3 py-2 text-left w-28">Use Case</th>
                        <th class="px-3 py-2 text-center w-16">â˜…</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
                    ${filtered.map(s => {
                const isWin = S.winners.some(w => w.d === s.domain);
                const bucketClass = getBucketClass(s.bucket);
                return `
                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                            <td class="px-3 py-2.5">
                                <span class="font-medium text-slate-700 dark:text-slate-200 cursor-pointer hover:text-brand-500" onclick="navigator.clipboard.writeText('${s.domain}');toast('Copied')">${s.domain}</span>
                            </td>
                            <td class="px-3 py-2.5 text-center">
                                <span class="font-bold ${getScoreColor(s.score)}">${s.score.toFixed(1)}</span>
                            </td>
                            <td class="px-3 py-2.5 text-center">
                                <span class="text-xs font-bold px-2 py-1 rounded-full ${bucketClass}">${s.bucket}</span>
                            </td>
                            <td class="px-3 py-2.5 text-slate-500 dark:text-slate-400 text-xs max-w-[200px] truncate" title="${s.reason}">${s.reason}</td>
                            <td class="px-3 py-2.5 text-xs text-slate-400">${s.use_case}</td>
                            <td class="px-3 py-2.5 text-center">
                                <button onclick="toggleWinner('${s.domain}')" class="${isWin ? 'text-amber-400' : 'text-slate-300 hover:text-amber-400'} transition-colors p-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                </button>
                            </td>
                        </tr>`;
            }).join('')}
                </tbody>
            </table></div>`;
        }

        function getBucketClass(bucket) {
            switch (bucket) {
                case 'FAST-FLIP': return 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400';
                case 'HOLD': return 'bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400';
                case 'PASS': return 'bg-slate-100 dark:bg-slate-800 text-slate-500';
                default: return 'bg-slate-100 text-slate-500';
            }
        }

        function getScoreColor(score) {
            if (score >= 7) return 'text-emerald-600 dark:text-emerald-400';
            if (score >= 4) return 'text-amber-600 dark:text-amber-400';
            return 'text-slate-400';
        }

        function exportScoredCSV() {
            if (S.aiScoredDomains.length === 0) {
                toast('No scored domains to export', 'err');
                return;
            }

            const headers = ['Domain', 'Score', 'Bucket', 'Reason', 'Use Case'];
            const rows = S.aiScoredDomains.map(s => [
                s.domain,
                s.score.toFixed(1),
                s.bucket,
                `"${(s.reason || '').replace(/"/g, '""')}"`,
                s.use_case
            ]);

            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-scored-domains-${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            toast('Exported scored CSV');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUTOMATION SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const AUTO_SCORE_ENDPOINT = '/.netlify/functions/score';
        const AUTO_AGENT_ENDPOINT = '/.netlify/functions/agent';
        const AUTO_CHUNK_SIZE = 100;
        const UGLY_CLUSTERS = /([bcdfghjklmnpqrstvwxz]{4,})|([aeiou]{4,})|(xx|zz|qq|ww|vv)/i;

        // Automation state
        const AutoState = {
            candidates: [],      // Generated candidates {domain, template, sources}
            scored: [],          // Scored results
            isGenerating: false,
            isScoring: false,
            cancelRequested: false,
            bucketFilters: { 'FAST-FLIP': true, 'HOLD': true, 'PASS': false },
            topN: null           // null = show all, 50 or 100
        };

        // Parse words from textarea
        function parseWords(text) {
            return text.split(/[\n,]+/).map(s => s.trim().toLowerCase().replace(/[^a-z0-9-]/g, '')).filter(s => s);
        }

        // Add singular/plural variants
        function addPlurals(words) {
            const result = new Set(words);
            words.forEach(w => {
                if (w.endsWith('s')) {
                    result.add(w.slice(0, -1)); // Remove trailing s
                } else if (!w.endsWith('ss') && !w.endsWith('x') && !w.endsWith('z')) {
                    result.add(w + 's'); // Add s
                }
            });
            return [...result];
        }

        // Add simple tense variants
        function addTenses(words) {
            const result = new Set(words);
            words.forEach(w => {
                if (w.endsWith('ed')) {
                    result.add(w.slice(0, -2)); // verified -> verif... not great, skip
                } else if (w.endsWith('ing')) {
                    result.add(w.slice(0, -3)); // trust
                } else if (w.endsWith('e')) {
                    result.add(w + 'd'); // secure -> secured
                } else if (w.length > 3 && !w.endsWith('ed')) {
                    result.add(w + 'ed'); // trust -> trusted
                }
            });
            return [...result];
        }

        // Get packs from UI
        function getAutoPacks() {
            const packA = parseWords($('autoPackA').value);
            const packB = parseWords($('autoPackB').value);
            const packC = parseWords($('autoPackC').value);

            return {
                A: $('autoPackAPlural').checked ? ($('autoPackATense').checked ? addTenses(addPlurals(packA)) : addPlurals(packA)) : ($('autoPackATense').checked ? addTenses(packA) : packA),
                B: $('autoPackBPlural').checked ? ($('autoPackBTense').checked ? addTenses(addPlurals(packB)) : addPlurals(packB)) : ($('autoPackBTense').checked ? addTenses(packB) : packB),
                C: $('autoPackCPlural').checked ? ($('autoPackCTense').checked ? addTenses(addPlurals(packC)) : addPlurals(packC)) : ($('autoPackCTense').checked ? addTenses(packC) : packC)
            };
        }

        // Get multipliers from UI
        function getAutoMultipliers() {
            return {
                prefixes: parseWords($('autoPrefixes').value),
                suffixes: parseWords($('autoSuffixes').value)
            };
        }

        // Get selected templates
        function getAutoTemplates() {
            const templates = [];
            if ($('tplAB').checked) templates.push('A+B');
            if ($('tplBA').checked) templates.push('B+A');
            if ($('tplABC').checked) templates.push('A+B+C');
            if ($('tplPrefixAB').checked) templates.push('prefix+A+B');
            if ($('tplABSuffix').checked) templates.push('A+B+suffix');
            if ($('tplPrefixABSuffix').checked) templates.push('prefix+A+B+suffix');
            return templates;
        }

        // Get constraints from UI
        function getAutoConstraints() {
            return {
                maxLen: parseInt($('autoMaxLen').value) || 12,
                noHyphens: $('autoNoHyphens').checked,
                noNumbers: $('autoNoNumbers').checked,
                dedupe: $('autoDedupe').checked,
                avoidUglyClusters: $('autoAvoidUgly').checked,
                banned: parseWords($('autoBanned').value)
            };
        }

        // Apply template to generate combos
        function applyAutoTemplate(template, packs, multipliers) {
            const { A, B, C } = packs;
            const { prefixes, suffixes } = multipliers;
            const results = [];

            switch (template) {
                case 'A+B':
                    for (const a of A) for (const b of B) {
                        results.push({ domain: a + b, template: 'A+B', sources: `A:${a}, B:${b}` });
                    }
                    break;
                case 'B+A':
                    for (const b of B) for (const a of A) {
                        results.push({ domain: b + a, template: 'B+A', sources: `B:${b}, A:${a}` });
                    }
                    break;
                case 'A+B+C':
                    for (const a of A) for (const b of B) for (const c of C) {
                        results.push({ domain: a + b + c, template: 'A+B+C', sources: `A:${a}, B:${b}, C:${c}` });
                    }
                    break;
                case 'prefix+A+B':
                    for (const p of prefixes) for (const a of A) for (const b of B) {
                        results.push({ domain: p + a + b, template: 'prefix+A+B', sources: `pre:${p}, A:${a}, B:${b}` });
                    }
                    break;
                case 'A+B+suffix':
                    for (const a of A) for (const b of B) for (const s of suffixes) {
                        results.push({ domain: a + b + s, template: 'A+B+suffix', sources: `A:${a}, B:${b}, suf:${s}` });
                    }
                    break;
                case 'prefix+A+B+suffix':
                    for (const p of prefixes) for (const a of A) for (const b of B) for (const s of suffixes) {
                        results.push({ domain: p + a + b + s, template: 'prefix+A+B+suffix', sources: `pre:${p}, A:${a}, B:${b}, suf:${s}` });
                    }
                    break;
            }
            return results;
        }

        // Filter candidates
        function filterAutoCandidates(candidates, constraints) {
            const seen = new Set();
            return candidates.filter(c => {
                const d = c.domain.toLowerCase().replace(/[^a-z0-9-]/g, '');
                if (!d) return false;
                if (d.length > constraints.maxLen) return false;
                if (constraints.noHyphens && d.includes('-')) return false;
                if (constraints.noNumbers && /\d/.test(d)) return false;
                if (constraints.avoidUglyClusters && UGLY_CLUSTERS.test(d)) return false;
                for (const b of constraints.banned) {
                    if (b && d.includes(b)) return false;
                }
                if (constraints.dedupe) {
                    if (seen.has(d)) return false;
                    seen.add(d);
                }
                c.domain = d;
                return true;
            });
        }

        // Auto Generate (client-side)
        function autoGenerate() {
            const packs = getAutoPacks();
            const multipliers = getAutoMultipliers();
            const templates = getAutoTemplates();
            const constraints = getAutoConstraints();

            if (packs.A.length === 0 && packs.B.length === 0) {
                toast('Add words to Pack A and B', 'err');
                return;
            }
            if (templates.length === 0) {
                toast('Select at least one template', 'err');
                return;
            }

            AutoState.isGenerating = true;
            AutoState.candidates = [];
            AutoState.scored = [];
            showAutoProgress(true, 0, 1, 'Generating...');

            setTimeout(() => {
                let allCandidates = [];
                templates.forEach(tpl => {
                    const combos = applyAutoTemplate(tpl, packs, multipliers);
                    allCandidates.push(...combos);
                });

                const filtered = filterAutoCandidates(allCandidates, constraints);
                AutoState.candidates = filtered;
                AutoState.isGenerating = false;
                showAutoProgress(false);
                renderAutoResults();
                toast(`Generated ${filtered.length} candidates`);
            }, 100);
        }

        // Score with AI (client-side chunked)
        async function autoScoreAI() {
            if (AutoState.isScoring) return;
            if (AutoState.candidates.length === 0) {
                toast('Generate candidates first', 'err');
                return;
            }

            const mode = $('autoMode').value;
            const domains = AutoState.candidates.map(c => c.domain);

            AutoState.isScoring = true;
            AutoState.cancelRequested = false;
            AutoState.scored = [];

            $('autoScoreText').textContent = 'Scoring...';
            $('autoScoreIcon').classList.add('hidden');
            $('autoScoreSpinner').classList.remove('hidden');
            showAutoProgress(true, 0, domains.length, 'AI Scoring...');

            const chunks = [];
            for (let i = 0; i < domains.length; i += AUTO_CHUNK_SIZE) {
                chunks.push(domains.slice(i, i + AUTO_CHUNK_SIZE));
            }

            let scored = 0;
            const allScores = {};

            for (let i = 0; i < chunks.length && !AutoState.cancelRequested; i++) {
                try {
                    const response = await fetch(AUTO_SCORE_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ domains: chunks[i], preset: mode })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.scores) {
                            data.scores.forEach(s => { allScores[s.domain.replace('.com', '').toLowerCase()] = s; });
                            scored += data.scores.length;
                        }
                    }
                } catch (err) {
                    console.error('Score chunk error:', err);
                }
                updateAutoProgress(scored, domains.length);
            }

            // Merge scores with candidates
            AutoState.scored = AutoState.candidates.map(c => {
                const s = allScores[c.domain] || {};
                return {
                    domain: c.domain,
                    score: parseFloat(s.score) || 0,
                    bucket: s.bucket || 'PASS',
                    reason: s.reason || '',
                    use_case: s.use_case || '',
                    templateUsed: c.template,
                    sources: c.sources
                };
            }).sort((a, b) => b.score - a.score);

            AutoState.isScoring = false;
            $('autoScoreText').textContent = 'AI Score & Shortlist';
            $('autoScoreIcon').classList.remove('hidden');
            $('autoScoreSpinner').classList.add('hidden');
            showAutoProgress(false);
            renderAutoResults();
            toast(`Scored ${scored} domains`);
        }

        // Run AI Agent (server-side full pipeline)
        async function autoRunAgent() {
            if (AutoState.isScoring) return;

            const packs = getAutoPacks();
            const multipliers = getAutoMultipliers();
            const templates = getAutoTemplates();
            const constraints = getAutoConstraints();
            const mode = $('autoMode').value;

            if (packs.A.length === 0 && packs.B.length === 0) {
                toast('Add words to Pack A and B', 'err');
                return;
            }

            AutoState.isScoring = true;
            AutoState.cancelRequested = false;

            $('autoAgentText').textContent = 'Running...';
            $('autoAgentIcon').classList.add('hidden');
            $('autoAgentSpinner').classList.remove('hidden');
            showAutoProgress(true, 0, 100, 'AI Agent processing...');

            try {
                const response = await fetch(AUTO_AGENT_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        task: 'generate_and_score',
                        packs,
                        multipliers,
                        templates,
                        constraints,
                        mode,
                        topK: 100
                    })
                });

                const data = await response.json();

                if (data.success) {
                    AutoState.candidates = data.results.map(r => ({ domain: r.domain, template: r.templateUsed, sources: r.sources }));
                    AutoState.scored = data.results;
                    toast(`Agent returned ${data.count} scored domains (${data.totalGenerated} generated)`);
                } else {
                    toast(data.error || 'Agent error', 'err');
                    $('autoErrorMsg').textContent = data.error || 'Unknown error';
                    $('autoErrorMsg').classList.remove('hidden');
                }
            } catch (err) {
                toast('Agent request failed', 'err');
                console.error('Agent error:', err);
            }

            AutoState.isScoring = false;
            $('autoAgentText').textContent = 'Run AI Agent';
            $('autoAgentIcon').classList.remove('hidden');
            $('autoAgentSpinner').classList.add('hidden');
            showAutoProgress(false);
            renderAutoResults();
        }

        // Progress helpers
        function showAutoProgress(show, current = 0, total = 0, text = '') {
            $('autoProgressArea').classList.toggle('hidden', !show);
            if (show) updateAutoProgress(current, total, text);
        }

        function updateAutoProgress(current, total, text) {
            const pct = total > 0 ? Math.round((current / total) * 100) : 0;
            $('autoProgressFill').style.width = pct + '%';
            $('autoProgressText').textContent = `${current} / ${total}`;
        }

        // Render results
        function renderAutoResults() {
            const container = $('autoResultsContainer');
            const data = AutoState.scored.length > 0 ? AutoState.scored : AutoState.candidates;

            if (data.length === 0) {
                container.innerHTML = `<div class="empty flex flex-col items-center justify-center py-16 text-slate-400">
                    <div class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mb-4 text-2xl">ğŸ¤–</div>
                    <h3 class="text-lg font-bold text-slate-700 dark:text-slate-300">Ready to Generate</h3>
                    <p class="text-sm mt-1">Configure packs & templates, then click Generate.</p>
                </div>`;
                $('autoResCount').textContent = '(0)';
                return;
            }

            // Apply filters
            let filtered = data;
            if (AutoState.scored.length > 0) {
                filtered = data.filter(d => AutoState.bucketFilters[d.bucket]);
            }
            if (AutoState.topN) {
                filtered = filtered.slice(0, AutoState.topN);
            }

            $('autoResCount').textContent = `(${filtered.length}/${data.length})`;

            if (AutoState.scored.length > 0) {
                // Scored table
                container.innerHTML = `<table class="w-full text-sm">
                    <thead class="bg-slate-50 dark:bg-slate-800/50 text-xs font-bold text-slate-500 uppercase sticky top-0">
                        <tr>
                            <th class="px-3 py-2 text-left">Domain</th>
                            <th class="px-3 py-2 text-center w-16">Score</th>
                            <th class="px-3 py-2 text-center w-24">Bucket</th>
                            <th class="px-3 py-2 text-left">Reason</th>
                            <th class="px-3 py-2 text-left w-24">Template</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
                        ${filtered.map(s => `
                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                            <td class="px-3 py-2.5">
                                <span class="font-medium text-slate-700 dark:text-slate-200 cursor-pointer hover:text-purple-500" onclick="navigator.clipboard.writeText('${s.domain}');toast('Copied')">${s.domain}</span>
                            </td>
                            <td class="px-3 py-2.5 text-center">
                                <span class="font-bold ${getScoreColor(s.score)}">${s.score.toFixed(1)}</span>
                            </td>
                            <td class="px-3 py-2.5 text-center">
                                <span class="text-xs font-bold px-2 py-1 rounded-full ${getBucketClass(s.bucket)}">${s.bucket}</span>
                            </td>
                            <td class="px-3 py-2.5 text-slate-500 dark:text-slate-400 text-xs max-w-[200px] truncate" title="${s.reason}">${s.reason}</td>
                            <td class="px-3 py-2.5 text-xs text-slate-400">${s.templateUsed || ''}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>`;
            } else {
                // Unscored list
                container.innerHTML = `<table class="w-full text-sm">
                    <thead class="bg-slate-50 dark:bg-slate-800/50 text-xs font-bold text-slate-500 uppercase sticky top-0">
                        <tr>
                            <th class="px-3 py-2 text-left">Domain</th>
                            <th class="px-3 py-2 text-left">Template</th>
                            <th class="px-3 py-2 text-left">Sources</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
                        ${filtered.slice(0, 500).map(c => `
                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                            <td class="px-3 py-2">
                                <span class="font-medium text-slate-700 dark:text-slate-200 cursor-pointer hover:text-purple-500" onclick="navigator.clipboard.writeText('${c.domain}');toast('Copied')">${c.domain}</span>
                            </td>
                            <td class="px-3 py-2 text-xs text-slate-400">${c.template}</td>
                            <td class="px-3 py-2 text-xs text-slate-400 truncate max-w-[200px]">${c.sources}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>`;
            }
        }

        // Export automation CSV
        function exportAutoCSV() {
            const data = AutoState.scored.length > 0 ? AutoState.scored : AutoState.candidates;
            if (data.length === 0) {
                toast('No data to export', 'err');
                return;
            }

            let csv;
            if (AutoState.scored.length > 0) {
                const headers = ['Domain', 'Score', 'Bucket', 'Reason', 'Use Case', 'Template', 'Sources'];
                const rows = data.map(s => [
                    s.domain,
                    s.score.toFixed(1),
                    s.bucket,
                    `"${(s.reason || '').replace(/"/g, '""')}"`,
                    s.use_case || '',
                    s.templateUsed || '',
                    `"${(s.sources || '').replace(/"/g, '""')}"`
                ]);
                csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            } else {
                const headers = ['Domain', 'Template', 'Sources'];
                const rows = data.map(c => [c.domain, c.template, `"${(c.sources || '').replace(/"/g, '""')}"`]);
                csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            }

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `automation-${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            toast('Exported CSV');
        }

        // Copy domains
        function copyAutoDomains() {
            const data = AutoState.scored.length > 0 ? AutoState.scored : AutoState.candidates;
            if (data.length === 0) {
                toast('No domains to copy', 'err');
                return;
            }
            const text = data.map(d => d.domain).join('\n');
            navigator.clipboard.writeText(text);
            toast(`Copied ${data.length} domains`);
        }



        // Default built-in presets
        /* const DEFAULT_PRESETS = [
            {
                id: 'default_brandable',
                name: 'General Brandable',
                description: 'Short, punchy domain names for startups and SaaS',
                templates: ['A+B', 'B+A'],
                constraints: {
                    maxLen: 10,
                    noHyphens: true,
                    noNumbers: true,
                    dedupe: true,
                    avoidUglyClusters: true
                },
                weights: {
                    brandability: 4.0,
                    pronunciation: 3.0,
                    spelling: 2.0,
                    nativeMeaning: 1.0,
                    buyerIntent: 1.5
                },
                bannedSubstrings: ['sex', 'xxx', 'spam'],
                recommendedPrefixes: ['get', 'try', 'go', 'my'],
                recommendedSuffixes: ['hq', 'hub', 'io', 'app', 'ly'],
                notes: 'Focus on short, memorable names',
                updatedAt: new Date().toISOString()
            },
            {
                id: 'default_finance',
                name: 'Fintech & Lenders',
                description: 'Finance, lending, and payments domain names',
                templates: ['A+B', 'B+A', 'prefix+A+B'],
                constraints: {
                    maxLen: 12,
                    noHyphens: true,
                    noNumbers: true,
                    dedupe: true,
                    avoidUglyClusters: true
                },
                weights: {
                    brandability: 3.0,
                    pronunciation: 2.5,
                    spelling: 2.0,
                    nativeMeaning: 2.0,
                    buyerIntent: 3.5
                },
                bannedSubstrings: ['sex', 'xxx', 'scam', 'fraud'],
                recommendedPrefixes: ['pay', 'fund', 'lend', 'credit'],
                recommendedSuffixes: ['pay', 'capital', 'finance', 'cash'],
                notes: 'Trust-evoking names for financial services',
                updatedAt: new Date().toISOString()
            },
            {
                id: 'default_ai',
                name: 'AI & Tech',
                description: 'Modern AI and technology-focused domains',
                templates: ['A+B', 'B+A', 'A+B+suffix'],
                constraints: {
                    maxLen: 12,
                    noHyphens: true,
                    noNumbers: true,
                    dedupe: true,
                    avoidUglyClusters: true
                },
                weights: {
                    brandability: 3.5,
                    pronunciation: 2.5,
                    spelling: 2.0,
                    nativeMeaning: 1.5,
                    buyerIntent: 2.5
                },
                bannedSubstrings: ['sex', 'xxx'],
                recommendedPrefixes: ['auto', 'smart', 'neural', 'deep'],
                recommendedSuffixes: ['ai', 'bot', 'labs', 'tech', 'mind'],
                notes: 'AI wave and technology terms',
                updatedAt: new Date().toISOString()
            }
        ]; */

















        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WINNERS - Enhanced Domain Tracking
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let winnerEditIdx = null; // null = add new, number = editing index
        let winnerStatusFilter = 'all';

        function toggleWinner(d) {
            const idx = S.winners.findIndex(w => w.d === d);
            if (idx >= 0) {
                S.winners.splice(idx, 1);
                toast('Removed from Winners');
            } else {
                // Add with enhanced structure
                S.winners.push({
                    d,
                    category: '',
                    status: 'Want',
                    price: '',
                    notes: '',
                    date: new Date().toISOString().split('T')[0]
                });
                toast('â˜… Saved to Winners');
            }
            save();
            renderResults();
        }

        function renderWinners() {
            const q = $('winSearch')?.value?.toLowerCase() || '';
            const tbody = $('winnersTable');
            if (!tbody) return;

            // Filter by search and status
            let list = S.winners.filter(w => {
                const matchQ = w.d.toLowerCase().includes(q) ||
                    (w.category || '').toLowerCase().includes(q) ||
                    (w.notes || '').toLowerCase().includes(q);
                const matchStatus = winnerStatusFilter === 'all' || w.status === winnerStatusFilter;
                return matchQ && matchStatus;
            });

            // Update count badge
            const badge = $('winCountBadge');
            if (badge) badge.textContent = `${list.length} domain${list.length !== 1 ? 's' : ''}`;

            if (!list.length) {
                tbody.innerHTML = '';
                $('winEmpty')?.classList.remove('hidden');
                return;
            }
            $('winEmpty')?.classList.add('hidden');

            tbody.innerHTML = list.map((w, i) => {
                const realIdx = S.winners.indexOf(w); // Get real index for updates
                return `
        <tr class="group hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
            <td class="px-6 py-4">
                <span class="font-bold text-slate-900 dark:text-white cursor-pointer hover:text-brand-600" onclick="navigator.clipboard.writeText('${w.d}');toast('Copied')">${w.d}</span>
            </td>
            <td class="px-6 py-4">
                <span class="text-xs px-2 py-1 rounded-md bg-slate-100 dark:bg-slate-800 text-slate-500">${w.category || '-'}</span>
            </td>
            <td class="px-6 py-4">
                <span class="text-xs font-bold uppercase px-2.5 py-1 rounded-full ${getStatusColor(w.status)}">${w.status}</span>
            </td>
            <td class="px-6 py-4 text-sm text-slate-500">${w.price || '-'}</td>
            <td class="px-6 py-4 max-w-[200px]">
                <span class="text-sm text-slate-400 truncate block" title="${(w.notes || '').replace(/"/g, '&quot;')}">${w.notes || '-'}</span>
            </td>
            <td class="px-6 py-4 text-xs text-slate-400">${w.date || '-'}</td>
            <td class="px-6 py-4">
                <div class="flex justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button onclick="openWinnerModal(${realIdx})" class="p-1.5 rounded hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-brand-500" title="Edit">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                    </button>
                    <button onclick="navigator.clipboard.writeText('${w.d}');toast('Copied')" class="p-1.5 rounded hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-brand-500" title="Copy">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                    </button>
                    <button onclick="window.open('tools/comp-analyzer.html?d=${encodeURIComponent(w.d)}', '_blank')" class="p-1.5 rounded hover:bg-purple-50 dark:hover:bg-purple-900/20 text-slate-400 hover:text-purple-500" title="Analyze Comps">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                    </button>
                    <button onclick="deleteWinner(${realIdx})" class="p-1.5 rounded hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-500" title="Delete">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                    </button>
                </div>
            </td>
        </tr>`;
            }).join('');
        }

        function openWinnerModal(idx = null) {
            winnerEditIdx = idx;
            const modal = $('winnerModal');
            const title = $('winnerModalTitle');

            if (idx !== null && S.winners[idx]) {
                // Edit mode
                const w = S.winners[idx];
                title.textContent = 'Edit Domain';
                $('winDomain').value = w.d;
                $('winCategory').value = w.category || '';
                $('winStatus').value = w.status || 'Want';
                $('winPrice').value = w.price || '';
                $('winNotes').value = w.notes || '';
            } else {
                // Add mode
                title.textContent = 'Add Domain';
                $('winDomain').value = '';
                $('winCategory').value = '';
                $('winStatus').value = 'Want';
                $('winPrice').value = '';
                $('winNotes').value = '';
            }

            modal.classList.remove('hidden');
            $('winDomain').focus();
        }

        function closeWinnerModal() {
            $('winnerModal').classList.add('hidden');
            winnerEditIdx = null;
        }

        function saveWinner() {
            const domain = $('winDomain').value.trim();
            if (!domain) {
                toast('Domain is required', 'err');
                return;
            }

            const data = {
                d: domain,
                category: $('winCategory').value.trim(),
                status: $('winStatus').value,
                price: $('winPrice').value.trim(),
                notes: $('winNotes').value.trim(),
                date: new Date().toISOString().split('T')[0]
            };

            if (winnerEditIdx !== null && S.winners[winnerEditIdx]) {
                // Preserve original date when editing
                data.date = S.winners[winnerEditIdx].date || data.date;
                S.winners[winnerEditIdx] = data;
                toast('Domain updated');
            } else {
                // Check for duplicates
                if (S.winners.some(w => w.d.toLowerCase() === domain.toLowerCase())) {
                    toast('Domain already exists', 'err');
                    return;
                }
                S.winners.push(data);
                toast('â˜… Domain added');
            }

            save();
            renderWinners();
            renderResults();
            closeWinnerModal();
        }

        function deleteWinner(idx) {
            if (confirm('Delete this domain?')) {
                S.winners.splice(idx, 1);
                save();
                renderWinners();
                renderResults();
                toast('Domain deleted');
            }
        }

        function getStatusColor(s) {
            switch (s) {
                case 'Owned': return 'text-green-700 bg-green-100 dark:bg-green-900/40 dark:text-green-300';
                case 'Sold': return 'text-slate-600 bg-slate-200 dark:bg-slate-700 dark:text-slate-300';
                case 'Watching': return 'text-amber-700 bg-amber-100 dark:bg-amber-900/40 dark:text-amber-300';
                default: return 'text-brand-700 bg-brand-100 dark:bg-brand-900/40 dark:text-brand-300';
            }
        }

        function exportWinnersCSV() {
            const headers = ['Domain', 'Category', 'Status', 'Price', 'Notes', 'Date'];
            const rows = S.winners.map(w => [w.d, w.category || '', w.status, w.price || '', w.notes || '', w.date || '']);
            downloadCSV([headers, ...rows], 'winners.csv');
            $('exportWinDrop')?.classList.add('hidden');
            toast('Exported as CSV');
        }

        function exportWinnersTXT() {
            const txt = S.winners.map(w => w.d).join('\n');
            const blob = new Blob([txt], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'winners.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            $('exportWinDrop')?.classList.add('hidden');
            toast('Exported as TXT');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PACKS & EDITORS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderPacks() {
            const q = $('packSearch').value.toLowerCase();
            const list = S.packs.filter(p => p.name.toLowerCase().includes(q));

            // Colorful theme palette for pack cards
            const colorThemes = ['orange', 'teal', 'gold', 'coral', 'purple', 'lime', 'blue', 'rose'];

            $('packsGrid').innerHTML = list.map((p, index) => {
                const theme = colorThemes[index % colorThemes.length];
                return `
        <div class="pack-card-${theme} p-5 rounded-2xl shadow-lg cursor-pointer group" onclick="openEditor(${p.id})">
            <div class="flex justify-between items-start mb-3">
                <div class="icon-bg w-12 h-12 rounded-xl flex items-center justify-center font-bold text-xl shadow-sm">
                    ${p.type === 'multiplier' ? 'âš¡' : 'ğŸ“¦'}
                </div>
                <button class="w-8 h-8 rounded-full bg-white/20 hover:bg-white/40 flex items-center justify-center text-lg transition-colors" onclick="toggleFav(event, ${p.id})">
                    ${S.favorites.includes(p.id) ? 'â­' : 'â˜†'}
                </button>
            </div>
            <div class="mb-4">
                <h3 class="font-bold text-lg mb-1">${p.name}</h3>
                <div class="flex items-center gap-2">
                    <span class="text-2xl font-extrabold">${p.words.length}</span>
                    <span class="text-xs font-semibold uppercase opacity-80">words</span>
                </div>
                <p class="text-xs font-medium uppercase tracking-wider opacity-70 mt-1">${p.type}</p>
            </div>
            <div class="flex gap-2 border-t pt-3">
                <button class="text-xs font-bold px-3 py-1.5 rounded-lg bg-white/20 hover:bg-white/40 transition-colors" onclick="clonePack(event, ${p.id})">Clone</button>
                <button class="text-xs font-bold px-3 py-1.5 rounded-lg bg-white/10 hover:bg-red-500/80 transition-colors ml-auto" onclick="delPack(event, ${p.id})">Delete</button>
            </div>
        </div>
    `}).join('');
        }

        function openEditor(id) {
            const p = id ? S.packs.find(x => x.id === id) : { name: '', type: 'multiplier', words: [] };
            S.editing = p;
            S.editWords = [...p.words];
            $('editTitle').innerText = id ? 'Edit Pack' : 'New Pack';
            $('editName').value = p.name;
            const typeBtn = $(p.type === 'multiplier' ? 'multiplier' : 'keyword'); // Logic needs simpler toggle set
            // Simplified Toggle Set for Modal
            $$('#editTypeGrp .tog').forEach(b => {
                b.classList.remove('on', 'bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-brand-600');
                b.classList.add('text-slate-500');
                if (b.dataset.v === p.type) b.classList.add('on', 'bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-brand-600');
            });
            renderEditorWords();
            openModal('editModal');
        }

        function renderEditorWords() {
            $('edWords').innerHTML = S.editWords.map((w, i) => `
        <div class="flex items-center justify-between bg-slate-50 dark:bg-slate-700/50 px-3 py-1.5 rounded-lg border border-slate-100 dark:border-slate-600">
            <span class="text-sm font-mono">${w}</span>
            <button class="text-slate-400 hover:text-red-500" onclick="S.editWords.splice(${i},1);renderEditorWords()">Ã—</button>
        </div>
    `).join('');
        }

        function saveEditor() {
            const name = $('editName').value.trim();
            if (!name) return toast('Name required', 'err');
            const type = document.querySelector('#editTypeGrp .on').dataset.v;

            if (S.editing.id) {
                S.editing.name = name; S.editing.type = type; S.editing.words = S.editWords;
            } else {
                S.packs.push({ id: Date.now(), name, type, words: S.editWords });
            }
            save(); refreshAll(); closeModal('editModal'); toast('Pack saved');
        }

        function addWordToEditor() {
            const w = prompt('Enter word:');
            if (w) { S.editWords.push(w.toLowerCase().trim()); renderEditorWords(); }
        }

        function bulkAddToEditor() {
            const txt = $('bulkInput').value;
            const words = txt.split(/[\n,]+/).map(s => s.trim().toLowerCase()).filter(s => s);
            S.editWords.push(...words);
            $('bulkInput').value = '';
            closeModal('bulkModal');
            renderEditorWords();
            toast(`Added ${words.length} words`);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // LIBRARY & UTILS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderLibrary() {
            const q = $('libSearch').value.toLowerCase();
            const set = new Set();
            S.packs.forEach(p => p.words.forEach(w => set.add(w)));
            const list = Array.from(set).filter(w => w.includes(q)).sort();
            $('libChips').innerHTML = list.map(w => `<span class="px-2 py-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md text-xs cursor-pointer hover:border-brand-500" onclick="navigator.clipboard.writeText('${w}');toast('Copied')">${w}</span>`).join('');
        }

        function renderFavorites() {
            const favs = S.packs.filter(p => S.favorites.includes(p.id));
            const colorThemes = ['orange', 'teal', 'gold', 'coral', 'purple', 'lime', 'blue', 'rose'];

            $('favsGrid').innerHTML = favs.map((p, index) => {
                const theme = colorThemes[index % colorThemes.length];
                return `
        <div class="pack-card-${theme} p-5 rounded-2xl shadow-lg cursor-pointer group" onclick="openEditor(${p.id})">
            <div class="flex justify-between items-start mb-3">
                <div class="icon-bg w-12 h-12 rounded-xl flex items-center justify-center font-bold text-xl shadow-sm">
                    ${p.type === 'multiplier' ? 'âš¡' : 'ğŸ“¦'}
                </div>
                <button class="w-8 h-8 rounded-full bg-white/20 hover:bg-white/40 flex items-center justify-center text-lg transition-colors" onclick="toggleFav(event, ${p.id})">
                    â­
                </button>
            </div>
            <div class="mb-4">
                <h3 class="font-bold text-lg mb-1">${p.name}</h3>
                <div class="flex items-center gap-2">
                    <span class="text-2xl font-extrabold">${p.words.length}</span>
                    <span class="text-xs font-semibold uppercase opacity-80">words</span>
                </div>
                <p class="text-xs font-medium uppercase tracking-wider opacity-70 mt-1">${p.type}</p>
            </div>
            <div class="flex gap-2 border-t pt-3">
                <button class="text-xs font-bold px-3 py-1.5 rounded-lg bg-white/20 hover:bg-white/40 transition-colors" onclick="clonePack(event, ${p.id})">Clone</button>
                <button class="text-xs font-bold px-3 py-1.5 rounded-lg bg-white/10 hover:bg-red-500/80 transition-colors ml-auto" onclick="delPack(event, ${p.id})">Delete</button>
            </div>
        </div>
    `}).join('');
        }

        function refreshAll() {
            updateStats();
            renderPacks();
            renderFavorites();
            renderLibrary();
            renderWinners();
            renderResults();
        }

        function toggleFav(e, id) {
            e.stopPropagation();
            if (S.favorites.includes(id)) S.favorites = S.favorites.filter(x => x !== id);
            else S.favorites.push(id);
            save(); refreshAll();
        }

        function clonePack(e, id) {
            e.stopPropagation();
            const p = S.packs.find(x => x.id === id);
            S.packs.push({ ...p, id: Date.now(), name: p.name + ' (Copy)' });
            save(); refreshAll();
        }

        function delPack(e, id) {
            e.stopPropagation();
            if (confirm('Delete pack?')) {
                S.packs = S.packs.filter(x => x.id !== id);
                save(); refreshAll();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // HELPER LOGIC
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function processBulk(fn) {
            const current = $('bulkKw').value.split('\n').map(s => s.trim()).filter(s => s);
            $('bulkKw').value = fn(current).join('\n');
            updateStats();
        }

        function updateStats() {
            const words = $('bulkKw').value.split('\n').filter(s => s.trim());
            $('kwCount').innerText = words.length;
            $('hdrPacks').innerText = S.packs.length;
            $('packCountBadge').innerText = S.packs.length;
            let total = 0; S.packs.forEach(p => total += p.words.length);
            $('hdrWords').innerText = total;
        }

        function renderCatPicker() {
            $('catGrid').innerHTML = S.packs.map(p => `
        <div class="p-3 bg-slate-50 dark:bg-slate-700 rounded-lg cursor-pointer hover:bg-brand-50 dark:hover:bg-brand-900/30 border border-transparent hover:border-brand-500" onclick="insertPack(${p.id})">
            <div class="font-bold text-sm">${p.name}</div>
            <div class="text-xs text-slate-500">${p.words.length} words</div>
        </div>
    `).join('');
        }

        function insertPack(id) {
            const p = S.packs.find(x => x.id === id);
            const mode = document.querySelector('#insertModeGrp .on').dataset.v;
            const txt = p.words.join('\n');
            if (mode === 'replace') $('bulkKw').value = txt;
            else $('bulkKw').value += '\n' + txt;

            // Add tag to inserted list
            $('insertedList').innerHTML += `<span class="inline-flex items-center gap-1 px-2 py-1 rounded bg-brand-100 text-brand-700 text-xs font-bold"><span onclick="this.parentElement.remove()">Ã—</span> ${p.name}</span>`;

            closeModal('catModal');
            updateStats();
        }

        function renderMultPicker() {
            $('multList').innerHTML = S.packs.filter(p => p.type === 'multiplier').map(p => `
        <div class="mb-4">
            <div class="text-xs font-bold text-slate-400 uppercase mb-2">${p.name}</div>
            <div class="flex flex-wrap gap-2">
                ${p.words.map(w => `<span class="px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded text-sm cursor-pointer hover:bg-brand-500 hover:text-white transition-colors" onclick="$('mainKw').value='${w}';closeModal('multModal')">${w}</span>`).join('')}
            </div>
        </div>
    `).join('');
        }

        function globalSearch(q) {
            if (!q) return $('gSearchDrop').classList.add('hidden');
            $('gSearchDrop').classList.remove('hidden');

            const pRes = S.packs.filter(p => p.name.toLowerCase().includes(q));
            const wRes = S.winners.filter(w => w.d.includes(q));

            let html = '';
            if (pRes.length) html += `<div class="text-xs font-bold text-slate-400 px-3 py-1">PACKS</div>` + pRes.map(p => `<div class="px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer text-sm" onclick="openEditor(${p.id})">ğŸ“¦ ${p.name}</div>`).join('');
            if (wRes.length) html += `<div class="text-xs font-bold text-slate-400 px-3 py-1 mt-2">WINNERS</div>` + wRes.map(w => `<div class="px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer text-sm flex justify-between" onclick="navigator.clipboard.writeText('${w.d}');toast('Copied')"><span>ğŸ† ${w.d}</span><span class="text-xs opacity-50">${w.status}</span></div>`).join('');

            $('gSearchDrop').innerHTML = html || '<div class="p-3 text-sm text-slate-400">No results found</div>';
        }

        function downloadCSV(rows, filename) {
            const csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");
            const link = document.createElement("a");
            link.setAttribute("href", encodeURI(csvContent));
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function setTheme(theme, silent = false) {
            localStorage.setItem('dg_theme', theme);
            document.documentElement.setAttribute('data-theme', theme);
            document.body.setAttribute('data-theme', theme);

            // Update visual selection in settings
            $$('.theme-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.theme === theme) {
                    opt.classList.add('active');
                }
            });

            // Show notification (unless silent)
            if (!silent) {
                toast('Theme updated to ' + theme.charAt(0).toUpperCase() + theme.slice(1));
            }
        }

        function setMode(mode) {
            document.body.dataset.mode = mode;
            localStorage.setItem('dg_mode', mode);
            if (mode === 'dark') document.documentElement.classList.add('dark');
            else document.documentElement.classList.remove('dark');
            $('themeText').innerText = mode === 'dark' ? 'Light Mode' : 'Dark Mode';
            $('darkIco').innerText = mode === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // Chips Logic - Fixed to properly toggle styling
        $$('#extChips .chip').forEach(c => c.onclick = () => {
            if (c.classList.contains('on')) {
                c.classList.remove('on', 'bg-brand-500', 'text-white', 'border-transparent', 'shadow-sm');
                c.classList.add('bg-slate-100', 'dark:bg-slate-800', 'text-slate-500', 'border-slate-200', 'dark:border-slate-700');
            } else {
                c.classList.add('on', 'bg-brand-500', 'text-white', 'border-transparent', 'shadow-sm');
                c.classList.remove('bg-slate-100', 'dark:bg-slate-800', 'text-slate-500', 'border-slate-200', 'dark:border-slate-700');
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MISSING EXPORT/IMPORT FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function exportAllPacks() {
            const data = JSON.stringify(S.packs, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'packs_export.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            toast('Packs exported');
        }

        function importPacks(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (ev) {
                try {
                    const json = JSON.parse(ev.target.result);
                    let packsToProcess = [];

                    // 1. Standard Array: [ {name, words}, ... ]
                    if (Array.isArray(json)) {
                        packsToProcess = json;
                    }
                    // 2. Object wrapper: { packs: [ ... ] }
                    else if (json.packs && Array.isArray(json.packs)) {
                        packsToProcess = json.packs;
                    }
                    // 3. Single Pack Object: { name: "X", words: [...] }
                    else if (typeof json === 'object' && json.name && Array.isArray(json.words)) {
                        packsToProcess = [json];
                    }
                    // 4. Dictionary / Map: { "PackName": ["word1", "word2"], "OtherPack": [...] }
                    else if (typeof json === 'object') {
                        // Iterate keys and try to construct packs
                        Object.entries(json).forEach(([key, val]) => {
                            if (Array.isArray(val) && val.every(v => typeof v === 'string')) {
                                packsToProcess.push({ name: key, words: val, type: 'keyword' });
                            }
                        });

                        // If that failed, fall back to "smart search" for nested arrays of objects
                        if (packsToProcess.length === 0) {
                            const possibleKey = Object.keys(json).find(k => Array.isArray(json[k]) && json[k][0]?.words);
                            if (possibleKey) packsToProcess = json[possibleKey];
                        }
                    }

                    console.log('Found packs to process:', packsToProcess.length, packsToProcess);

                    if (packsToProcess.length > 0) {
                        let mergedCount = 0;
                        let createdCount = 0;
                        let totalWordsAdded = 0;

                        packsToProcess.forEach(p => {
                            if (p.name && p.words && Array.isArray(p.words)) {
                                const cleanName = p.name.trim();
                                // Find existing pack with same name (exclude case sensitivity for matching)
                                const existingPack = S.packs.find(
                                    ep => ep.name.trim().toLowerCase() === cleanName.toLowerCase()
                                );

                                if (existingPack) {
                                    // MERGE
                                    const oldWords = new Set(existingPack.words.map(w => w.toLowerCase()));
                                    const newWords = p.words.filter(w => w && typeof w === 'string').map(w => w.trim());
                                    let addedForThis = 0;

                                    newWords.forEach(w => {
                                        if (!oldWords.has(w.toLowerCase())) {
                                            existingPack.words.push(w);
                                            oldWords.add(w.toLowerCase());
                                            addedForThis++;
                                        }
                                    });

                                    existingPack.words.sort(); // Keep sorted

                                    if (addedForThis > 0) {
                                        mergedCount++;
                                        totalWordsAdded += addedForThis;
                                    }
                                } else {
                                    // CREATE
                                    S.packs.push({
                                        id: Date.now() + Math.random(),
                                        name: cleanName,
                                        type: p.type || 'keyword',
                                        words: p.words.filter(w => w && typeof w === 'string').map(w => w.trim()).sort()
                                    });
                                    createdCount++;
                                    totalWordsAdded += p.words.length;
                                }
                            }
                        });

                        save();
                        refreshAll();

                        if (createdCount === 0 && mergedCount === 0) {
                            toast('No new data found imported (duplicates skipped).');
                        } else {
                            toast(`Success! Created ${createdCount}, Merged ${mergedCount}. (+${totalWordsAdded} words)`);
                        }
                    } else {
                        toast('No recognizable pack format found.', 'err');
                    }
                } catch (err) {
                    console.error('Import Error:', err);
                    toast('Error parsing JSON. Check console.', 'err');
                }
            };
            reader.readAsText(file);
            e.target.value = ''; // Reset input to allow re-importing same file
        }

        function importCSV(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (ev) {
                const lines = ev.target.result.split(/[\n\r]+/).map(l => l.trim()).filter(l => l);
                if (lines.length > 0) {
                    const packName = file.name.replace(/\.(csv|txt)$/i, '') || 'Imported Pack';
                    S.packs.push({
                        id: Date.now(),
                        name: packName,
                        type: 'keyword',
                        words: lines
                    });
                    save();
                    refreshAll();
                    toast(`Created pack "${packName}" with ${lines.length} words`);
                }
            };
            reader.readAsText(file);
            e.target.value = ''; // Reset input
        }

        // Settings Export/Import
        function settingsExportAll() {
            const data = {
                packs: S.packs,
                favorites: S.favorites,
                winners: S.winners
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'supercombinator_backup.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            toast('All data exported');
        }

        function settingsImport() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function (e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function (ev) {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if (data.packs) S.packs = data.packs;
                        if (data.favorites) S.favorites = data.favorites;
                        if (data.winners) S.winners = data.winners;
                        save();
                        refreshAll();
                        toast('Data imported successfully');
                    } catch (err) {
                        toast('Error importing data', 'err');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Wire up settings buttons (add to init)
        $('settExportAll').onclick = settingsExportAll;
        $('settImport').onclick = settingsImport;

        // Modal search filters
        $('catSearch').oninput = function (e) {
            const q = e.target.value.toLowerCase();
            const filtered = S.packs.filter(p => p.name.toLowerCase().includes(q));
            $('catGrid').innerHTML = filtered.map(p => `
        <div class="p-3 bg-slate-50 dark:bg-slate-700 rounded-lg cursor-pointer hover:bg-brand-50 dark:hover:bg-brand-900/30 border border-transparent hover:border-brand-500" onclick="insertPack(${p.id})">
            <div class="font-bold text-sm">${p.name}</div>
            <div class="text-xs text-slate-500">${p.words.length} words</div>
        </div>
    `).join('');
        };

        $('multSearch').oninput = function (e) {
            const q = e.target.value.toLowerCase();
            const filtered = S.packs.filter(p => p.type === 'multiplier' && p.name.toLowerCase().includes(q));
            $('multList').innerHTML = filtered.map(p => `
        <div class="mb-4">
            <div class="text-xs font-bold text-slate-400 uppercase mb-2">${p.name}</div>
            <div class="flex flex-wrap gap-2">
                ${p.words.map(w => `<span class="px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded text-sm cursor-pointer hover:bg-brand-500 hover:text-white transition-colors" onclick="$('mainKw').value='${w}';closeModal('multModal')">${w}</span>`).join('')}
            </div>
        </div>
    `).join('');
        };

        // Drag and drop for CSV zone
        $('csvDropZone').ondragover = function (e) {
            e.preventDefault();
            this.classList.add('border-brand-500', 'bg-brand-50/50');
        };
        $('csvDropZone').ondragleave = function (e) {
            e.preventDefault();
            this.classList.remove('border-brand-500', 'bg-brand-50/50');
        };
        $('csvDropZone').ondrop = function (e) {
            e.preventDefault();
            this.classList.remove('border-brand-500', 'bg-brand-50/50');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];

                // FIX: Detect JSON and route to importPacks
                if (file.name.toLowerCase().endsWith('.json') || file.type === 'application/json') {
                    importPacks({ target: { files: [file] } });
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (ev) {
                    const lines = ev.target.result.split(/[\n\r]+/).map(l => l.trim()).filter(l => l);
                    if (lines.length > 0) {
                        const packName = file.name.replace(/\.(csv|txt)$/i, '') || 'Dropped Pack';
                        S.packs.push({
                            id: Date.now(),
                            name: packName,
                            type: 'keyword',
                            words: lines
                        });
                        save();
                        refreshAll();
                        toast(`Created pack "${packName}" with ${lines.length} words`);
                    }
                };
                reader.readAsText(file);
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUTOMATION PRESETS SYSTEM (Versioned Storage)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const PRESETS_KEY = 'combitator_presets_v1';
        const SELECTED_PRESET_KEY = 'combitator_selected_preset_id';

        const DEFAULT_PRESETS = [
            {
                id: 'preset_brandable',
                name: 'Brandable (General)',
                description: 'Short, punchy names suitable for any startup. High brandability score.',
                templates: ['A+B', 'B+A', 'A+suffix'],
                constraints: { maxLen: 10, noHyphens: true, noNumbers: true, dedupe: true, avoidUgly: true },
                weights: { brandability: 4, pronunciation: 2, spelling: 2, nativeMeaning: 1, buyerIntent: 1 },
                bannedSubstrings: ['cheap', 'free', 'bonus', 'best', 'top', 'pro'],
                recommendedPrefixes: ['get', 'use', 'try', 'go', 'my', 'the'],
                recommendedSuffixes: ['hq', 'app', 'lab', 'io', 'co', 'xyz'],
                notes: 'Focus on short, memorable names. Avoid generic keywords.'
            },
            {
                id: 'preset_lenders',
                name: 'Lenders / Fintech',
                description: 'Trustworthy, professional names for finance and lending.',
                templates: ['A+B', 'prefix+A', 'A+suffix'],
                constraints: { maxLen: 12, noHyphens: true, noNumbers: true, dedupe: true, avoidUgly: true },
                weights: { brandability: 2, pronunciation: 2, spelling: 2, nativeMeaning: 1, buyerIntent: 3 },
                bannedSubstrings: ['scam', 'fake', 'hack', 'free', 'cheap'],
                recommendedPrefixes: ['true', 'smart', 'fast', 'easy', 'first', 'capital'],
                recommendedSuffixes: ['fund', 'cashing', 'money', 'finance', 'credit', 'loans'],
                notes: 'Prioritize trust and financial keywords.'
            },
            {
                id: 'preset_payments',
                name: 'Payments / Processing',
                description: 'Fast, secure sounding names for payment gateways.',
                templates: ['A+B', 'A+suffix'],
                constraints: { maxLen: 11, noHyphens: true, noNumbers: true, dedupe: true, avoidUgly: true },
                weights: { brandability: 3, pronunciation: 2, spelling: 2, nativeMeaning: 0.5, buyerIntent: 2.5 },
                bannedSubstrings: ['slow', 'wait', 'hold', 'stop', 'fraud'],
                recommendedPrefixes: ['pay', 'fast', 'quick', 'swift', 'snap'],
                recommendedSuffixes: ['pay', 'wallet', 'card', 'box', 'send'],
                notes: 'Speed and security are key.'
            }
        ];

        function getAutoPresets() {
            try {
                const stored = localStorage.getItem(PRESETS_KEY);
                if (!stored) return DEFAULT_PRESETS;
                const parsed = JSON.parse(stored);
                // Handle legacy wrapper object vs direct array
                let presets = Array.isArray(parsed) ? parsed : (parsed.presets || DEFAULT_PRESETS);
                // Ensure all have IDs
                presets.forEach(p => { if (!p.id) p.id = generatePresetId(); });
                return presets;
            } catch (e) {
                console.error('Error loading presets:', e);
                return DEFAULT_PRESETS;
            }
        }

        function saveAutoPresets(presets) {
            localStorage.setItem(PRESETS_KEY, JSON.stringify(presets));
            populatePresetDropdown();
        }

        function generatePresetId() {
            return 'preset_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function saveSelectedPresetId(id) {
            localStorage.setItem(SELECTED_PRESET_KEY, id);
        }

        function loadPersistedPreset() {
            const select = $('autoPresetSelect');
            if (!select) return; // Element doesn't exist, skip

            const id = localStorage.getItem(SELECTED_PRESET_KEY);
            if (id) {
                // Check if ID exists in dropdown options
                let index = -1;
                for (let i = 0; i < select.options.length; i++) {
                    // We store index in value, need to check preset ID
                    const presets = getAutoPresets();
                    if (presets[i] && presets[i].id === id) {
                        index = i;
                        break;
                    }
                }

                if (index >= 0) {
                    select.value = index;
                    onPresetSelectChange(true);
                } else if (select.options.length > 0) {
                    select.value = 0;
                    onPresetSelectChange(true);
                }
            } else {
                // Default to first
                if (select.options.length > 0) {
                    select.value = 0;
                    onPresetSelectChange(true);
                }
            }
        }

        function populatePresetDropdown() {
            const presets = getAutoPresets();
            const select = $('autoPresetSelect');
            if (!select) return; // Element doesn't exist, skip
            const currentVal = select.value; // Try to preserve selection

            select.innerHTML = presets.map((p, idx) =>
                `<option value="${idx}">${p.name} (${p.constraints?.maxLen || 12} chars)</option>`
            ).join('');

            // Restore selection if index still valid
            if (currentVal !== '' && currentVal < presets.length) {
                select.value = currentVal;
            } else {
                loadPersistedPreset(); // Or try to load persisted
            }
        }

        function onPresetSelectChange(silent = false) {
            const select = $('autoPresetSelect');
            if (!select) return; // Element doesn't exist, skip
            const idx = select.value;
            if (idx === '') return;
            const presets = getAutoPresets();
            const preset = presets[idx];
            if (preset) applyAutoPreset(preset, silent);
        }

        function applyAutoPreset(preset, silent = false) {
            if (!preset) return;

            // Helper for safe property setting
            function safeSet(id, prop, value) {
                const el = $(id);
                if (el) el[prop] = value;
            }

            // Templates
            const templates = preset.templates || [];
            safeSet('tplAB', 'checked', templates.includes('A+B'));
            safeSet('tplBA', 'checked', templates.includes('B+A'));
            safeSet('tplABC', 'checked', templates.includes('A+B+C'));
            safeSet('tplPreAB', 'checked', templates.includes('prefix+A+B'));
            safeSet('tplABSuf', 'checked', templates.includes('A+B+suffix'));
            safeSet('tplPreABSuf', 'checked', templates.includes('prefix+A+B+suffix'));

            // Constraints
            const c = preset.constraints || {};
            safeSet('autoMaxLen', 'value', c.maxLen || 12);
            safeSet('autoMaxLenValue', 'textContent', c.maxLen || 12);

            // Weights (store them for API call, UI doesn't always show them)
            // We'll trust the preset object when sending to API

            // Banned substrings
            const banned = Array.isArray(preset.bannedSubstrings) ? preset.bannedSubstrings :
                (typeof preset.bannedSubstrings === 'string' ? preset.bannedSubstrings.split(/[\n,]+/).map(s => s.trim()) : []);
            safeSet('autoBanned', 'value', banned.join('\n'));

            // Prefixes/Suffixes
            const prefs = Array.isArray(preset.recommendedPrefixes) ? preset.recommendedPrefixes :
                (typeof preset.recommendedPrefixes === 'string' ? preset.recommendedPrefixes.split(/[\n,]+/).map(s => s.trim()) : []);
            const suffs = Array.isArray(preset.recommendedSuffixes) ? preset.recommendedSuffixes :
                (typeof preset.recommendedSuffixes === 'string' ? preset.recommendedSuffixes.split(/[\n,]+/).map(s => s.trim()) : []);

            // Ideally should update multipliers list or store for Agent
            // For now, toast
            if (!silent) toast(`Applied preset: ${preset.name}`);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PRESET MANAGER UI Logic
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function openPresetManager() {
            renderPresetList();
            const modal = $('presetManagerModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        }

        function closePresetManager() {
            const modal = $('presetManagerModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
            populatePresetDropdown(); // effective refresh
        }

        function renderPresetList(query = '') {
            const presets = getAutoPresets();
            const container = $('presetListContainer');
            const empty = $('presetEmptyState');

            // Skip if elements don't exist
            if (!container) return;

            const filtered = presets.filter(p => {
                const q = query.toLowerCase();
                return (p.name || '').toLowerCase().includes(q) ||
                    (p.description || '').toLowerCase().includes(q);
            });

            if (filtered.length === 0) {
                container.innerHTML = '';
                if (empty) empty.classList.remove('hidden');
                return;
            }

            if (empty) empty.classList.add('hidden');
            container.innerHTML = filtered.map((p, idx) => {
                // Note: idx here refers to filtered index, we need original index for editing
                // But simplified: just use ID lookup or re-find index
                const realIdx = presets.findIndex(xp => xp.id === p.id);
                const lastUpdated = p.lastUpdated ? new Date(p.lastUpdated).toLocaleDateString() : 'N/A';

                return `
                <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-4 border border-slate-100 dark:border-slate-700 hover:border-brand-500 transition-colors group">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="font-bold text-slate-900 dark:text-white flex items-center gap-2">
                                ${p.name}
                                <span class="text-xs font-normal text-slate-500 px-2 py-0.5 rounded bg-slate-200 dark:bg-slate-700">Max ${p.constraints?.maxLen || 12}</span>
                            </div>
                            <div class="text-sm text-slate-500 mt-1 line-clamp-2">${p.description || 'No description'}</div>
                            <div class="text-xs text-slate-400 mt-2">
                                ${p.templates?.length || 0} templates â€¢ Updated ${lastUpdated}
                            </div>
                        </div>
                        <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="openPresetEditor(${realIdx})" class="p-2 text-slate-400 hover:text-brand-500 hover:bg-brand-50 dark:hover:bg-slate-700 rounded-lg" title="Edit">âœï¸</button>
                            <button onclick="duplicatePreset(${realIdx})" class="p-2 text-slate-400 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-slate-700 rounded-lg" title="Duplicate">ğŸ“‹</button>
                            <button onclick="deletePreset(${realIdx})" class="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-slate-700 rounded-lg" title="Delete">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function onPresetSearchInput(e) {
            renderPresetList(e.target.value);
        }

        function deletePreset(idx) {
            const presets = getAutoPresets();
            if (presets.length <= 1) {
                toast('Cannot delete the last preset.', 'err');
                return;
            }
            if (!confirm(`Delete preset "${presets[idx].name}"?`)) return;

            presets.splice(idx, 1);
            saveAutoPresets(presets);
            renderPresetList($('presetSearchInput')?.value || '');
            toast('Preset deleted');
        }

        function duplicatePreset(idx) {
            const presets = getAutoPresets();
            const source = presets[idx];
            const newPreset = JSON.parse(JSON.stringify(source));
            newPreset.id = generatePresetId();
            newPreset.name = `${source.name} (Copy)`;
            newPreset.lastUpdated = new Date().toISOString();

            presets.push(newPreset);
            saveAutoPresets(presets);
            renderPresetList($('presetSearchInput')?.value || '');
            toast('Preset duplicated');
        }

        function resetPresetsToDefaults() {
            if (confirm('Reset all presets to default settings? This will delete custom presets.')) {
                saveAutoPresets(DEFAULT_PRESETS);
                renderPresetList();
                toast('Presets reset to defaults');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PRESET EDITOR Logic
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let editingPresetIndex = null;

        function openPresetEditor(idx = null) {
            // Skip if editor modal doesn't exist
            const modal = $('presetEditorModal');
            if (!modal) return;

            editingPresetIndex = idx;
            const presets = getAutoPresets();
            const isNew = idx === null;

            const p = isNew ? {
                name: 'New Preset',
                description: '',
                templates: ['A+B'],
                constraints: { maxLen: 12, noHyphens: true, noNumbers: true, dedupe: true, avoidUgly: true },
                weights: { brandability: 3, pronunciation: 2, spelling: 2, nativeMeaning: 1.5, buyerIntent: 1.5 },
                bannedSubstrings: [],
                recommendedPrefixes: [],
                recommendedSuffixes: [],
                notes: ''
            } : presets[idx];

            // Helper for safe property setting
            function safeSet(id, prop, value) {
                const el = $(id);
                if (el) el[prop] = value;
            }

            // Populate Form
            safeSet('presetEditorTitle', 'innerText', isNew ? 'â• New Preset' : 'âœï¸ Edit Preset');
            safeSet('editorPresetName', 'value', p.name || '');
            safeSet('editorPresetDesc', 'value', p.description || '');


            // Templates
            const tpls = p.templates || [];
            safeSet('editorTplAB', 'checked', tpls.includes('A+B'));
            safeSet('editorTplBA', 'checked', tpls.includes('B+A'));
            safeSet('editorTplABC', 'checked', tpls.includes('A+B+C'));
            safeSet('editorTplPrefixAB', 'checked', tpls.includes('prefix+A+B'));
            safeSet('editorTplABSuf', 'checked', tpls.includes('A+B+suffix'));
            safeSet('editorTplPreABSuf', 'checked', tpls.includes('prefix+A+B+suffix'));

            // Constraints
            const c = p.constraints || {};
            safeSet('editorNoHyphens', 'checked', c.noHyphens !== false);
            safeSet('editorNoNumbers', 'checked', c.noNumbers !== false);
            safeSet('editorDedupe', 'checked', c.dedupe !== false);
            safeSet('editorAvoidUgly', 'checked', c.avoidUgly !== false);
            safeSet('editorMaxLen', 'value', c.maxLen || 12);
            safeSet('editorMaxLenValue', 'textContent', c.maxLen || 12);

            // Weights
            const w = p.weights || {};
            safeSet('wBrand', 'value', w.brandability || 0);
            safeSet('wPron', 'value', w.pronunciation || 0);
            safeSet('wSpell', 'value', w.spelling || 0);
            safeSet('wMean', 'value', w.nativeMeaning || 0);
            safeSet('wIntent', 'value', w.buyerIntent || 0);
            if (typeof updateWeightLabels === 'function') updateWeightLabels();

            // Text areas
            const banned = Array.isArray(p.bannedSubstrings) ? p.bannedSubstrings :
                (typeof p.bannedSubstrings === 'string' ? p.bannedSubstrings.split(/[\n,]+/) : []);
            safeSet('editorBanned', 'value', banned.join('\n'));

            const prefs = Array.isArray(p.recommendedPrefixes) ? p.recommendedPrefixes :
                (typeof p.recommendedPrefixes === 'string' ? p.recommendedPrefixes.split(/[\n,]+/) : []);
            safeSet('editorPrefixes', 'value', prefs.join(', '));

            const suffs = Array.isArray(p.recommendedSuffixes) ? p.recommendedSuffixes :
                (typeof p.recommendedSuffixes === 'string' ? p.recommendedSuffixes.split(/[\n,]+/) : []);
            safeSet('editorSuffixes', 'value', suffs.join(', '));

            safeSet('editorNotes', 'value', p.notes || '');

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closePresetEditor() {
            const modal = $('presetEditorModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }

        // Helper for safe value retrieval
        function safeGet(id, prop, defaultVal = '') {
            const el = $(id);
            return el ? el[prop] : defaultVal;
        }

        function getPresetFromEditor() {
            // Skip if editor doesn't exist
            if (!$('presetEditorModal')) return null;

            const templates = [];
            if (safeGet('editorTplAB', 'checked', false)) templates.push('A+B');
            if (safeGet('editorTplBA', 'checked', false)) templates.push('B+A');
            if (safeGet('editorTplABC', 'checked', false)) templates.push('A+B+C');
            if (safeGet('editorTplPrefixAB', 'checked', false)) templates.push('prefix+A+B');
            if (safeGet('editorTplABSuf', 'checked', false)) templates.push('A+B+suffix');
            if (safeGet('editorTplPreABSuf', 'checked', false)) templates.push('prefix+A+B+suffix');

            return {
                id: editingPresetIndex !== null ? getAutoPresets()[editingPresetIndex].id : generatePresetId(),
                name: safeGet('editorPresetName', 'value', '').trim() || 'Untitled Preset',
                description: safeGet('editorPresetDesc', 'value', '').trim(),
                lastUpdated: new Date().toISOString(),
                templates: templates,
                constraints: {
                    maxLen: parseInt(safeGet('editorMaxLen', 'value', '12')),
                    noHyphens: safeGet('editorNoHyphens', 'checked', true),
                    noNumbers: safeGet('editorNoNumbers', 'checked', true),
                    dedupe: safeGet('editorDedupe', 'checked', true),
                    avoidUgly: safeGet('editorAvoidUgly', 'checked', true)
                },
                weights: {
                    brandability: parseFloat(safeGet('wBrand', 'value', '0')) || 0,
                    pronunciation: parseFloat(safeGet('wPron', 'value', '0')) || 0,
                    spelling: parseFloat(safeGet('wSpell', 'value', '0')) || 0,
                    nativeMeaning: parseFloat(safeGet('wMean', 'value', '0')) || 0,
                    buyerIntent: parseFloat(safeGet('wIntent', 'value', '0')) || 0
                },
                bannedSubstrings: safeGet('editorBanned', 'value', '').split('\n').map(s => s.trim()).filter(s => s),
                recommendedPrefixes: safeGet('editorPrefixes', 'value', '').split(/[,\n]+/).map(s => s.trim()).filter(s => s),
                recommendedSuffixes: safeGet('editorSuffixes', 'value', '').split(/[,\n]+/).map(s => s.trim()).filter(s => s),
                notes: safeGet('editorNotes', 'value', '').trim()
            };
        }

        function savePresetFromEditor() {
            const preset = getPresetFromEditor();
            if (!preset) return; // Skip if editor not available

            const presets = getAutoPresets();

            if (editingPresetIndex !== null) {
                presets[editingPresetIndex] = preset;
            } else {
                presets.push(preset);
            }

            saveAutoPresets(presets);
            closePresetEditor();
            renderPresetList(safeGet('presetSearchInput', 'value', ''));
            toast('Preset saved successfully');

            // If new, select it
            if (editingPresetIndex === null) {
                saveSelectedPresetId(preset.id);
            }
        }

        function saveAndApplyPreset() {
            savePresetFromEditor();
            closePresetManager();
            onPresetSelectChange(); // Apply newly selected
        }

        // Weight Normalization
        function onWeightSliderChange(e) {
            const changedId = e.target.id;
            const sliders = ['wBrand', 'wPron', 'wSpell', 'wMean', 'wIntent'];
            const vals = sliders.map(id => parseFloat($(id).value));
            const total = vals.reduce((a, b) => a + b, 0);

            // Only normalize if > 10
            if (total > 10.0) {
                // Implementation detail: simplify by just updating label for now
                // or strict normalization (scale others down)
                // For this implementation, let's just update labels
            }
            updateWeightLabels();
        }

        function updateWeightLabels() {
            ['wBrand', 'wPron', 'wSpell', 'wMean', 'wIntent'].forEach(id => {
                const el = $(id);
                // Maybe update a span next to it? For now just tooltips
                el.title = el.value;
            });

            const total = ['wBrand', 'wPron', 'wSpell', 'wMean', 'wIntent']
                .reduce((sum, id) => sum + parseFloat($(id).value || 0), 0);

            // If we had a total indicator, update it
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // IMPORT / EXPORT / QUICKSAVE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function exportAutoPresets() {
            const presets = getAutoPresets();
            const data = {
                version: PRESETS_KEY,
                exportedAt: new Date().toISOString(),
                presets: presets
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `combitator-presets-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function validateAndImportPresets(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (ev) {
                try {
                    const json = JSON.parse(ev.target.result);
                    let newPresets = [];

                    // Support both object wrapper and raw array
                    if (Array.isArray(json)) {
                        newPresets = json;
                    } else if (json.presets && Array.isArray(json.presets)) {
                        newPresets = json.presets;
                    } else {
                        throw new Error('Invalid format: missing presets array');
                    }

                    // Validation & Fixes
                    const Validated = [];
                    newPresets.forEach(p => {
                        if (!p.name) return; // Skip unnamed

                        // Ensure ID
                        if (!p.id) p.id = generatePresetId();

                        // Ensure basic fields
                        if (!p.constraints) p.constraints = { maxLen: 12 };
                        if (p.constraints.maxLen > 16) p.constraints.maxLen = 16;

                        // Normalizing weights if missing
                        if (!p.weights) p.weights = { brandability: 2, pronunciation: 2, spelling: 2, nativeMeaning: 2, buyerIntent: 2 };

                        Validated.push(p);
                    });

                    if (Validated.length === 0) {
                        toast('No valid presets found in file', 'err');
                        return;
                    }

                    const current = getAutoPresets();
                    const merged = [...current, ...Validated];
                    saveAutoPresets(merged);
                    renderPresetList();
                    toast(`Imported ${Validated.length} presets`);

                } catch (err) {
                    console.error(err);
                    toast('Error parsing preset file', 'err');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUTOMATION & AVAILABILITY CHECKING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // State for automation
        S.autoResults = [];
        S.checking = false;
        S.cancelCheck = false;
        S.checkQueue = [];
        S.checkedCount = 0;
        S.availableCount = 0;

        async function autoGenerate() {
            const presetIdx = $('autoPresetSelect').value;
            if (presetIdx === '') { toast('Please select a preset', 'err'); return; }

            const presets = getAutoPresets();
            const preset = presets[presetIdx];
            if (!preset) return;

            // Get inputs
            const mainKw = $('mainKw').value.trim().toLowerCase().replace(/[^a-z0-9]/g, '');
            if (!mainKw) { toast('Please enter a main keyword (top left)', 'err'); return; }

            // UI Update
            const btn = $('autoGenerateBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'ğŸš€ Generating...';
            btn.disabled = true;

            // Generate Domains based on Preset
            // 1. Collect words from packs (Multipliers)
            // Note: In a real app, we might select specific packs. Here we use ALL multipliers for variety.
            const multipliers = S.packs.filter(p => p.type === 'multiplier').flatMap(p => p.words);

            // 2. Generate candidates
            let candidates = new Set();
            const templates = preset.templates || ['A+B'];
            const prefixes = (preset.recommendedPrefixes || []).concat(['get', 'try', 'go', 'use', 'my', 'the']);
            const suffixes = (preset.recommendedSuffixes || []).concat(['app', 'hq', 'io', 'co', 'site']);

            // Helper to add if valid
            const add = (d) => {
                if (!d) return;
                // Constraints
                const maxLen = parseInt($('autoMaxLen').value) || 12;
                if (d.length > maxLen) return;
                if ($('autoNoHyphens').checked && d.includes('-')) return;
                if ($('autoNoNumbers').checked && /\d/.test(d)) return;
                // Banned
                const banned = $('autoBanned').value.split('\n').filter(s => s.trim());
                if (banned.some(b => d.includes(b.trim()))) return;

                candidates.add(d);
            };

            // A = mainKw, B = multiplier/suffix/prefix
            // Logic: Mix mainKw with multipliers and affixes

            // Speed optimization: limit multipliers if too many
            const safeMults = multipliers.length > 200 ? multipliers.sort(() => 0.5 - Math.random()).slice(0, 200) : multipliers;

            templates.forEach(tpl => {
                if (tpl === 'A+B') {
                    safeMults.forEach(m => add(mainKw + m));
                }
                if (tpl === 'B+A') {
                    safeMults.forEach(m => add(m + mainKw));
                }
                if (tpl === 'A+suffix') {
                    suffixes.forEach(s => add(mainKw + s));
                }
                if (tpl === 'prefix+A') {
                    prefixes.forEach(p => add(p + mainKw));
                }
                if (tpl === 'prefix+A+B') {
                    prefixes.forEach(p => {
                        safeMults.slice(0, 50).forEach(m => add(p + mainKw + m));
                    });
                }
                if (tpl === 'A+B+suffix') {
                    suffixes.forEach(s => {
                        safeMults.slice(0, 50).forEach(m => add(mainKw + m + s));
                    });
                }
            });

            // Convert to array and shuffle/sort
            let results = Array.from(candidates);
            if ($('autoAvoidUgly').checked) {
                // Simple heuristic: avoid 3 consonants in a row (unless valid word)
                // results = results.filter(d => !/[bcdfghjklmnpqrstvwxyz]{4,}/.test(d)); 
            }

            results = results.sort(() => 0.5 - Math.random()); // Shuffle

            // Limit to Max Checks
            const maxChecks = parseInt($('autoMaxChecks').value) || 500;
            results = results.slice(0, maxChecks);

            // Populate Check Queue
            S.autoResults = results.map(d => ({
                domain: d + '.com', // Default to .com for now, or allow TLD selection?
                status: 'pending', // pending, available, taken, error
                price: null,
                checked: false
            }));

            // Initial Render
            renderAutoResults();

            btn.innerHTML = originalText;
            btn.disabled = false;

            // Start Checking if enabled
            if (results.length > 0) {
                startAvailabilityCheck();
            } else {
                toast('No domains generated. Try different settings.', 'err');
            }
        }

        function renderAutoResults() {
            const grid = $('autoResultsGrid');
            const countEl = $('autoResCount');
            if (!grid) return;

            if (countEl) countEl.innerText = S.autoResults.length;

            if (S.autoResults.length === 0) {
                grid.innerHTML = '<div class="col-span-full py-12 text-center text-slate-400">Generated domains will appear here...</div>';
                return;
            }

            // Render limit to avoid freezing
            const limit = 200;
            const toRender = S.autoResults.slice(0, limit);

            grid.innerHTML = toRender.map(r => {
                let statusClass = 'border-slate-200 dark:border-slate-700';
                let statusIcon = '';
                let priceHtml = '';

                if (r.status === 'available') {
                    statusClass = 'border-green-500 bg-green-50 dark:bg-green-900/20';
                    statusIcon = '<span class="text-green-600 dark:text-green-400 text-xs font-bold">AVAIL</span>';
                    if (r.price) priceHtml = `<span class="text-xs font-bold text-slate-600 dark:text-slate-300">$${r.price}</span>`;
                } else if (r.status === 'taken') {
                    statusClass = 'opacity-60 bg-slate-100 dark:bg-slate-800 border-slate-200';
                    statusIcon = '<span class="text-slate-400 text-xs">TAKEN</span>';
                } else if (r.status === 'checking') {
                    statusClass = 'border-purple-300 animate-pulse';
                    statusIcon = '<span class="text-purple-500 text-xs">...</span>';
                } else if (r.status === 'error') {
                    statusClass = 'border-red-200 bg-red-50';
                    statusIcon = '<span class="text-red-500 text-xs">ERR</span>';
                }

                // Is it a winner? (Check matches against winners list)
                const isWin = S.winners.some(w => w.d === r.domain);

                return `
                <div class="group relative p-3 rounded-lg border ${statusClass} transition-all hover:shadow-sm flex flex-col gap-2">
                    <div class="flex justify-between items-start">
                        <div class="font-mono text-sm font-bold text-slate-700 dark:text-slate-200 break-all cursor-pointer hover:text-purple-600" onclick="navigator.clipboard.writeText('${r.domain}');toast('Copied')">
                            ${r.domain}
                        </div>
                        <button onclick="toggleWinner('${r.domain}')" class="${isWin ? 'text-amber-400' : 'text-slate-300 hover:text-amber-400'} transition-colors" title="Save">
                            â˜…
                        </button>
                    </div>
                    <div class="flex justify-between items-center mt-auto">
                        ${statusIcon}
                        ${priceHtml}
                        ${r.buyUrl ? `<a href="${r.buyUrl}" target="_blank" class="text-xs text-blue-500 hover:underline">Buy â†—</a>` : ''}
                    </div>
                </div>`;
            }).join('');

            if (S.autoResults.length > limit) {
                grid.innerHTML += `<div class="col-span-full text-center text-xs text-slate-400 py-2">Showing first ${limit} of ${S.autoResults.length} results. Export to see all.</div>`;
            }
        }

        async function startAvailabilityCheck() {
            if (S.checking) return;
            S.checking = true;
            S.cancelCheck = false;
            S.checkedCount = 0;
            S.availableCount = 0;

            const concurrency = 5;
            const targetAvailable = parseInt($('autoTargetResults').value) || 50;

            // Update UI
            // Show progress bar

            const processQueue = async () => {
                if (S.cancelCheck || S.availableCount >= targetAvailable) {
                    S.checking = false;
                    renderAutoResults(); // Final render
                    return;
                }

                // Find next pending
                const pendingIdx = S.autoResults.findIndex(r => r.status === 'pending');
                if (pendingIdx === -1) {
                    S.checking = false;
                    renderAutoResults();
                    return;
                }

                const item = S.autoResults[pendingIdx];
                item.status = 'checking';
                renderAutoResults(); // Update specific row? Too slow. result-specific update better.

                try {
                    const res = await checkDomain(item.domain);
                    item.status = res.available ? 'available' : 'taken';
                    item.price = res.price;
                    item.premium = res.premium;
                    item.buyUrl = res.buyUrl;

                    if (res.available) S.availableCount++;
                } catch (e) {
                    item.status = 'error';
                }

                S.checkedCount++;
                updateProgress(); // Update progress bar

                // Optimized rendering: only re-render every X items or on finish
                if (S.checkedCount % 5 === 0) renderAutoResults();

                // Next
                processQueue();
            };

            // Start workers
            for (let i = 0; i < concurrency; i++) {
                processQueue();
            }
        }

        async function checkDomain(domain) {
            try {
                const res = await fetch('/.netlify/functions/check-domain', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ domain })
                });
                return await res.json();
            } catch (e) {
                console.error(e);
                return { available: false, error: true };
            }
        }

        function updateProgress() {
            const bar = $('autoProgressBar');
            const area = $('autoProgressArea');
            const txt = $('autoProgressText');
            const countAvail = $('autoCountAvail');
            const countChecked = $('autoCountChecked');

            if (!area) return;

            if (S.checking) {
                area.classList.remove('hidden');
                const total = S.autoResults.length;
                const pct = Math.round((S.checkedCount / total) * 100);
                bar.style.width = `${pct}%`;
                txt.innerText = `${S.checkedCount} / ${total}`;
                countAvail.innerText = S.availableCount;
                countChecked.innerText = S.checkedCount;
            } else {
                // Keep showing results summary but maybe hide bar functionality?
                // For now, keep it visible if we have results
                bar.style.width = '100%';
                // area.classList.add('hidden'); 
            }
        }

        // Stubs for missing funcs
        function autoScoreAI() { toast('AI Scoring coming soon!'); }
        function autoRunAgent() { toast('AI Agent coming soon!'); }
        function copyAutoDomains() {
            const text = S.autoResults.filter(r => r.status === 'available').map(r => r.domain).join('\n');
            navigator.clipboard.writeText(text);
            toast('Copied available domains');
        }
        function exportAutoCSV() {
            const rows = S.autoResults.map(r => [r.domain, r.status, r.price || '']);
            downloadCSV(rows, 'auto-domains.csv');
        }

        // Stub functions for missing weight slider features
        function onWeightSliderChange() {
            // Stub - weight slider functionality not yet implemented
        }
        function updateWeightLabels() {
            // Stub - weight label update functionality not yet implemented
        }

        // Quick Save Modal
        function openQuickSaveModal() {
            // Check if automation settings exist
            // For now just prompt for name using standard prompt or specific modal
            // We have a quickSavePresetModal?
            // Assuming simplified flow for now or use modal if we have HTML
            const name = prompt("Name for new preset:");
            if (!name) return;

            // Gather current settings from UI
            const presets = getAutoPresets();
            // ... construct preset from UI values ...
            // Simplified for now since we need to read ALL UI fields
            // Reuse getPresetFromEditor logic but from main UI

            toast('Preset saved (Quick Save)');
        }

        // Stub functions for quickSavePresetModal (modal HTML not present)
        function closeQuickSaveModal() {
            // Stub - modal HTML not present, uses prompt() instead
        }
        function confirmQuickSavePreset() {
            // Stub - modal HTML not present, uses prompt() instead
        }
        function importAutoPresetsValidated(e) {
            // Alias for validateAndImportPresets
            validateAndImportPresets(e);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUTOMATION EVENT HANDLERS (null-safe)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Helper for safe event binding
        function safeOn(id, event, handler) {
            const el = $(id);
            if (el) el[event] = handler;
        }

        safeOn('autoGenerateBtn', 'onclick', autoGenerate);
        safeOn('autoScoreBtn', 'onclick', autoScoreAI);
        safeOn('autoAgentBtn', 'onclick', autoRunAgent);

        // Preset dropdown and buttons
        if ($('autoPresetSelect')) {
            $('autoPresetSelect').onchange = function () {
                onPresetSelectChange();
                const idx = $('autoPresetSelect').value;
                if (idx !== '') {
                    const presets = getAutoPresets();
                    if (presets[idx]) saveSelectedPresetId(presets[idx].id);
                }
            };
        }
        safeOn('autoManagePresetsBtn', 'onclick', openPresetManager);
        safeOn('autoSaveAsPresetBtn', 'onclick', openQuickSaveModal);

        // Preset Manager modal buttons
        safeOn('presetManagerClose', 'onclick', closePresetManager);
        safeOn('presetManagerDoneBtn', 'onclick', closePresetManager);
        safeOn('presetNewBtn', 'onclick', () => openPresetEditor(null));
        safeOn('presetImportBtn', 'onclick', () => { if ($('presetImportInput')) $('presetImportInput').click(); });
        safeOn('presetExportBtn', 'onclick', exportAutoPresets);
        safeOn('presetResetBtn', 'onclick', resetPresetsToDefaults);
        safeOn('presetSearchInput', 'oninput', onPresetSearchInput);
        safeOn('presetImportInput', 'onchange', importAutoPresetsValidated);

        // Preset Editor modal buttons
        safeOn('presetEditorClose', 'onclick', closePresetEditor);
        safeOn('presetEditorCancelBtn', 'onclick', closePresetEditor);
        safeOn('presetEditorSaveBtn', 'onclick', savePresetFromEditor);
        safeOn('presetEditorSaveApplyBtn', 'onclick', saveAndApplyPreset);
        safeOn('editorMaxLen', 'oninput', (e) => { if ($('editorMaxLenValue')) $('editorMaxLenValue').textContent = e.target.value; });

        // Weights slider auto-normalization
        document.querySelectorAll('.weight-slider').forEach(slider => {
            slider.oninput = onWeightSliderChange;
        });

        // Quick Save Preset modal buttons (optional, may not exist)
        safeOn('quickSavePresetCancelBtn', 'onclick', closeQuickSaveModal);
        safeOn('quickSavePresetConfirmBtn', 'onclick', confirmQuickSavePreset);

        // Results buttons
        safeOn('autoCopyBtn', 'onclick', copyAutoDomains);
        safeOn('autoExportBtn', 'onclick', exportAutoCSV);
        safeOn('autoTop50Btn', 'onclick', () => { AutoState.topN = 50; renderAutoResults(); });
        safeOn('autoTop100Btn', 'onclick', () => { AutoState.topN = 100; renderAutoResults(); });

        // Cancel button
        safeOn('autoCancelBtn', 'onclick', () => { AutoState.cancelRequested = true; });

        // Max length slider
        safeOn('autoMaxLen', 'oninput', (e) => { if ($('autoMaxLenValue')) $('autoMaxLenValue').textContent = e.target.value; });

        // Bucket filter buttons
        $$('#autoBucketFilters .bucket-filter').forEach(btn => {
            btn.onclick = () => {
                const bucket = btn.dataset.bucket;
                AutoState.bucketFilters[bucket] = !AutoState.bucketFilters[bucket];
                btn.classList.toggle('opacity-50', !AutoState.bucketFilters[bucket]);
                btn.classList.toggle('hidden-bucket', !AutoState.bucketFilters[bucket]);
                renderAutoResults();
            };
        });


        // Initialize presets dropdown on load and restore selected preset
        populatePresetDropdown();
        loadPersistedPreset();

        // Initialize on DOM ready
        init();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NETLIFY IDENTITY - AUTH STATE MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Auth state object
        const AuthState = {
            user: null,
            winnersLoaded: false
        };

        // Update UI based on auth state
        function updateAuthUI(user, silent = false) {
            const loginBtn = $('loginBtn');
            const userInfo = $('userInfo');
            const userEmail = $('userEmail');
            const winnersAuthOverlay = $('winnersAuthOverlay');
            const winnersContent = $('winnersContent');

            if (user) {
                // Logged in
                AuthState.user = user;
                if (loginBtn) loginBtn.classList.add('hidden');
                if (userInfo) userInfo.classList.remove('hidden');
                if (userEmail) userEmail.textContent = user.email || 'Authenticated';
                if (winnersAuthOverlay) winnersAuthOverlay.classList.add('hidden');
                if (winnersContent) winnersContent.classList.remove('hidden');

                // Fetch winners from protected API
                if (!AuthState.winnersLoaded) {
                    fetchProtectedWinners(silent);
                }
            } else {
                // Logged out
                AuthState.user = null;
                AuthState.winnersLoaded = false;
                if (loginBtn) loginBtn.classList.remove('hidden');
                if (userInfo) userInfo.classList.add('hidden');
                if (winnersAuthOverlay) winnersAuthOverlay.classList.remove('hidden');
                if (winnersContent) winnersContent.classList.add('hidden');

                // Clear winners table
                const winnersTable = $('winnersTable');
                if (winnersTable) winnersTable.innerHTML = '';
            }
        }

        // Fetch winners from protected Netlify Function
        async function fetchProtectedWinners(silent = false) {
            const user = netlifyIdentity.currentUser();
            if (!user) {
                if (!silent) toast('Please log in to view winners', 'err');
                return;
            }

            try {
                // Get fresh JWT token
                const token = await user.jwt();

                const response = await fetch('/.netlify/functions/winners', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to fetch winners');
                }

                const data = await response.json();
                AuthState.winnersLoaded = true;

                // Render winners to table
                if (data.winners && Array.isArray(data.winners)) {
                    renderProtectedWinners(data.winners);
                    if (!silent) toast(`Loaded ${data.winners.length} winners`);
                }
            } catch (err) {
                console.error('Failed to fetch winners:', err);
                toast(err.message || 'Failed to load winners', 'err');
            }
        }

        // Render winners from API to table
        function renderProtectedWinners(winners) {
            const tbody = $('winnersTable');
            const emptyState = $('winEmpty');
            const countBadge = $('winCountBadge');

            if (!tbody) return;

            if (winners.length === 0) {
                tbody.innerHTML = '';
                if (emptyState) emptyState.classList.remove('hidden');
                if (countBadge) countBadge.textContent = '0 domains';
                return;
            }

            if (emptyState) emptyState.classList.add('hidden');
            if (countBadge) countBadge.textContent = `${winners.length} domains`;

            tbody.innerHTML = winners.map((w, i) => `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
                    <td class="px-6 py-4">
                        <div class="font-bold text-slate-800 dark:text-white">${w.domain || '-'}</div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full text-xs font-medium">${w.category || 'Uncategorized'}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded-full text-xs font-medium">${w.status || 'Want'}</span>
                    </td>
                    <td class="px-6 py-4 text-slate-600 dark:text-slate-400">${w.price || '-'}</td>
                    <td class="px-6 py-4 text-slate-500 dark:text-slate-400 text-xs max-w-xs truncate">${w.notes || ''}</td>
                    <td class="px-6 py-4 text-slate-400 text-xs">${w.date || '-'}</td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="navigator.clipboard.writeText('${w.domain}');toast('Copied!')" 
                            class="text-slate-400 hover:text-brand-500 transition-colors p-1" title="Copy">
                            ğŸ“‹
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Netlify Identity event handlers
        if (typeof netlifyIdentity !== 'undefined') {
            // On initial page load
            netlifyIdentity.on('init', user => {
                updateAuthUI(user, true); // Silent on init
            });

            // On login
            netlifyIdentity.on('login', user => {
                updateAuthUI(user);
                netlifyIdentity.close();
                toast('Logged in as ' + (user.email || 'user'));
            });

            // On logout
            netlifyIdentity.on('logout', () => {
                updateAuthUI(null);
                toast('Logged out');
            });

            // Handle redirect after email confirmation
            if (window.location.hash === '#confirmation_token') {
                netlifyIdentity.open();
            }
        }

    </script>
</body>

</html>